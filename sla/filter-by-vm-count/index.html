<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Filter By VM Count &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href="/stylesheets/application.css?1447607916" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1447607916" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'>
<h1>
<a href="/"><img id="logo" class="logo is-svg" alt="oVirt" src="/images/logo.svg?1447607917" />
</a></h1>
</section>
<div id='access'>
<nav role='navigation'>
<ul class='nav nav-pills'>
<li class='nav-link-home' role='menuitem'>
<a href='/'>Home</a>
</li>

<li class='nav-link-download' role='menuitem'>
<a href='/download/'>Download</a>
</li>

<li class='nav-link-documentation' role='menuitem'>
<a href='/documentation/'>Documentation</a>
</li>

<li class='nav-link-community' role='menuitem'>
<a href='/community/'>Community</a>
</li>

<li class='nav-link-develop' role='menuitem'>
<a href='/develop/'>Develop</a>
</li>

<li class='nav-link-search' role='menuitem'>
<a href='/search/'>Search</a>
</li>

</ul>
</nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<section class='container content' id='content'>
<div class='alert alert-warning'>
<div class='pull-right'>
<a>Hover for more info</a>
</div>
<div class='frontmatter-metadata'>
<table class='metadata'>
<caption>Frontmatter Metadata</caption>
<tr>
<th>title</th>
<td>Filter By VM Count</td>
</tr>
<tr>
<th>authors</th>
<td>nslomian</td>
</tr>
<tr>
<th>wiki_title</th>
<td>Filter By VM Count</td>
</tr>
<tr>
<th>wiki_revision_count</th>
<td>2</td>
</tr>
<tr>
<th>wiki_last_updated</th>
<td>2013-10-20</td>
</tr>
</table>
</div>
Original Wiki page:
<a href='http://ovirt.org/Filter_By_VM_Count' target='_blank'>
Filter By VM Count
</a>
</div>

<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="filter-by-vm-count">Filter By VM Count</h1>

<p>This filter only returns host ids of hosts with less running VMs then the specified maximum.</p>

<pre class="highlight plaintext"><code>     class max_vms(): `   `**`returns` `only` `hosts` `with` `less` `running` `vms` `then` `the` `maximum`**&#x000A;     #What are the values this module will accept, used to present&#x000A;     #the user with options&#x000A;     properties_validation = 'maximum_vm_count=[0-9]*'&#x000A;     def _get_connection(self):&#x000A;         #open a connection to the rest api&#x000A;         connection = None&#x000A;         try:&#x000A;             connection = API(url='`[`http://host:port`](http://host:port)`',&#x000A;                              username='user@domain', password='')&#x000A;         except BaseException as ex:&#x000A;             #letting the external proxy know there was an error&#x000A;             print &gt;&gt; sys.stderr, ex&#x000A;             return None&#x000A;         return connection&#x000A;     def _get_hosts(self, host_ids, connection):&#x000A;         #get all the hosts with the given ids&#x000A;         engine_hosts = connection.hosts.list(&#x000A;             query=" or ".join(["id=%s" % u for u in host_ids]))&#x000A;         return engine_hosts `   def do_filter(self, hosts_ids, vm_id, args_map): //&lt;-- `**`This` `is` `the` `function` `that` `will` `be` `called` `by` `the` `external` `scheduler` `proxy`**&#x000A;         conn = self._get_connection()&#x000A;         if conn is None:&#x000A;             return&#x000A;         #get our parameters from the map&#x000A;         maximum_vm_count = int(args_map.get('maximum_vm_count', 100))&#x000A;         engine_hosts = self._get_hosts(hosts_ids, conn)&#x000A;         #iterate over them and decide which to accept&#x000A;         accepted_host_ids = []&#x000A;         for engine_host in engine_hosts:&#x000A;             if(engine_host and&#x000A;                     engine_host.summary.active &lt; maximum_vm_count):&#x000A;                 accepted_host_ids.append(engine_host.id)&#x000A;         print accepted_host_ids&#x000A;</code></pre>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="/privacy/">Privacy policy</a></li>
<li><a target="_blank" href="/about/">About</a></li>
<li><a target="_blank" href="/disclaimers/">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2015 oVirt
<div class='last-modified'>
Page last modified
Mon 22 Jun 2015 10:08 UTC
</div>
</footer>


<script src="/javascripts/application.js?1447607928" type="text/javascript"></script>

<!-- eloqua -->
<script src='http://www.redhat.com/j/elqNow/elqCfg.js' type='text/javascript'></script>
<script src='http://www.redhat.com/j/elqNow/elqImg.js' type='text/javascript'></script>

</body>
</html>
