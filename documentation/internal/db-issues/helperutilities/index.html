<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
HelperUtilities &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href="/stylesheets/application.css?1447687441" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1447687441" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'>
<h1>
<a href="/"><img id="logo" class="logo is-svg" alt="oVirt" src="/images/logo.svg?1447687442" />
</a></h1>
</section>
<div id='access'>
<nav role='navigation'>
<ul class='nav nav-pills'>
<li class='nav-link-home' role='menuitem'>
<a href='/'>Home</a>
</li>

<li class='nav-link-download' role='menuitem'>
<a href='/download/'>Download</a>
</li>

<li class='nav-link-documentation' role='menuitem'>
<a href='/documentation/'>Documentation</a>
</li>

<li class='nav-link-community' role='menuitem'>
<a href='/community/'>Community</a>
</li>

<li class='nav-link-develop' role='menuitem'>
<a href='/develop/'>Develop</a>
</li>

<li class='nav-link-search' role='menuitem'>
<a href='/search/'>Search</a>
</li>

</ul>
</nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<section class='container content' id='content'>
<div class='alert alert-warning'>
<div class='pull-right'>
<a>Hover for more info</a>
</div>
<div class='frontmatter-metadata'>
<table class='metadata'>
<caption>Frontmatter Metadata</caption>
<tr>
<th>title</th>
<td>HelperUtilities</td>
</tr>
<tr>
<th>authors</th>
<td>emesika</td>
</tr>
<tr>
<th>wiki_title</th>
<td>OVirt-DB-Issues/HelperUtilities</td>
</tr>
<tr>
<th>wiki_revision_count</th>
<td>13</td>
</tr>
<tr>
<th>wiki_last_updated</th>
<td>2014-10-29</td>
</tr>
</table>
</div>
Original Wiki page:
<a href='http://ovirt.org/OVirt-DB-Issues/HelperUtilities' target='_blank'>
OVirt-DB-Issues/HelperUtilities
</a>
</div>

<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="helper-utilities">Helper Utilities</h1>

<h2 id="fkvalidator">fkvalidator</h2>

<p><strong>fkvalidaor.sh</strong> is a script that must be run on a customer database before an upgrade
The utility checks that all data inside the database is consistent and does not break any FK constraint
<strong>fkvalidaor.sh</strong> lists the found problems and can fix those problem is the <strong>-f</strong> switch is used</p>

<h3 id="usage">Usage</h3>

<p>Usage: fkvalidator.sh [-h] [-s SERVERNAME [-p PORT]] [-d DATABASE] [-u USERNAME] [-l LOGFILE] [-f] [-v]</p>

<pre class="highlight plaintext"><code>   -s SERVERNAME - The database servername for the database  (def. localhost)&#x000A;   -p PORT       - The database port for the database        (def. 5432)&#x000A;   -d DATABASE   - The database name                         (def. engine)&#x000A;   -u USERNAME   - The admin username for the database.&#x000A;   -l LOGFILE    - The logfile for capturing output          (def. fkvalidator.sh.log)&#x000A;   -f            - Fix the non consistent data by removing it from DB.&#x000A;   -v            - Turn on verbosity                         (WARNING: lots of output)&#x000A;   -h            - This help text.&#x000A;</code></pre>

<h2 id="taskcleaner">taskcleaner</h2>

<p><strong>taskcleaner.sh</strong> is a utility for clean async tasks and related Job Steps/Compensation data.
The utility enables to:
<strong>Display</strong></p>

<pre class="highlight plaintext"><code>   All async tasks&#x000A;   Only Zombie tasks&#x000A;</code></pre>

<p><strong>Delete</strong></p>

<pre class="highlight plaintext"><code>   All tasks&#x000A;   All Zombie tasks&#x000A;   A task related to a given task id&#x000A;   A Zombie task related to a given task id&#x000A;   All tasks related to a given command id&#x000A;   All Zombie tasks related to a given command id&#x000A;</code></pre>

<p>Flags may be added (-C, -J) to specify if Job Steps &amp; Compensation data should be cleaned as well.</p>

<h3 id="usage-1">Usage</h3>

<pre class="highlight plaintext"><code>   Usage: taskcleaner.sh [-h] [-s server] [-p PORT]] [-d DATABASE] [-u USERNAME] [-l LOGFILE] [-t taskId] [-c commandId]&#x000A;   [-z] [-R] [-C][-J] [-q] [-v]&#x000A;   -s SERVERNAME - The database servername for the database (def.localhost)&#x000A;   -p PORT - The database port for the database (def. 5432)&#x000A;   -d DATABASE - The database name (def.engine)&#x000A;   -u USERNAME - The admin username for the database.&#x000A;   -l LOGFILE - The logfile for capturing output (def.taskcleaner.sh.log)&#x000A;   -t TASK_ID - Removes a task by its Task ID.&#x000A;   -c COMMAND_ID - Removes all tasks related to the given Command Id.&#x000A;   -z - Removes/Displays a Zombie task.&#x000A;   -R - Removes all Zombie tasks.&#x000A;   -C - Clear related compensation entries.&#x000A;   -J - Clear related Job Steps.&#x000A;   -q - Quite mode, do not prompt for confirmation.&#x000A;   -v - Turn on verbosity (WARNING: lots of output)&#x000A;   -h - Help text.&#x000A;</code></pre>

<h2 id="unlockentity">unlock_entity</h2>

<p><strong>unlock_entity.sh</strong> is a utility for unlocing <strong>VM</strong> , <strong>Template</strong> and/or their associated <strong>Disks</strong> or a specific <strong>Disk</strong>
<strong>VM</strong> , <strong>Template</strong> are given by thier names while a specific disk is given by its <strong>UUID</strong></p>

<h3 id="usage-2">Usage</h3>

<pre class="highlight plaintext"><code>   Usage: ./unlock_entity.sh [options] [ENTITIES]&#x000A;     -h            - This help text.&#x000A;     -v            - Turn on verbosity                         (WARNING: lots of output)&#x000A;     -l LOGFILE    - The logfile for capturing output          (def. )&#x000A;     -s HOST       - The database servername for the database  (def. localhost)&#x000A;     -p PORT       - The database port for the database        (def. 5432)&#x000A;     -u USER       - The username for the database             (def. engine)&#x000A;     -d DATABASE   - The database name                         (def. engine)&#x000A;     -t TYPE       - The object type {vm | template | disk | snapshot}&#x000A;     -r            - Recursive, unlocks all disks under the selected vm/template.&#x000A;     -q            - Query db and display a list of the locked entites.&#x000A;     ENTITIES      - The list of object names in case of vm/template, UUIDs in case of a disk&#x000A;     NOTE: This utility access the database and should have the&#x000A;           corresponding credentals.&#x000A;           In case that a password is used to access the database PGPASSWORD&#x000A;           or PGPASSFILE should be set.&#x000A;     Example:&#x000A;         $ PGPASSWORD=xxxxxx ./unlock_entity.sh -t disk -q&#x000A;</code></pre>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="/privacy/">Privacy policy</a></li>
<li><a target="_blank" href="/about/">About</a></li>
<li><a target="_blank" href="/disclaimers/">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2015 oVirt
<div class='last-modified'>
Page last modified
Mon 22 Jun 2015 10:11 UTC
</div>
</footer>


<script src="/javascripts/application.js?1447687452" type="text/javascript"></script>

<!-- eloqua -->
<script src='http://www.redhat.com/j/elqNow/elqCfg.js' type='text/javascript'></script>
<script src='http://www.redhat.com/j/elqNow/elqImg.js' type='text/javascript'></script>

</body>
</html>
