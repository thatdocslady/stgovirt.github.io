<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Building oVirt engine &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href="/stylesheets/application.css?1447687441" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1447687441" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'>
<h1>
<a href="/"><img id="logo" class="logo is-svg" alt="oVirt" src="/images/logo.svg?1447687442" />
</a></h1>
</section>
<div id='access'>
<nav role='navigation'>
<ul class='nav nav-pills'>
<li class='nav-link-home' role='menuitem'>
<a href='/'>Home</a>
</li>

<li class='nav-link-download' role='menuitem'>
<a href='/download/'>Download</a>
</li>

<li class='nav-link-documentation' role='menuitem'>
<a href='/documentation/'>Documentation</a>
</li>

<li class='nav-link-community' role='menuitem'>
<a href='/community/'>Community</a>
</li>

<li class='nav-link-develop' role='menuitem'>
<a href='/develop/'>Develop</a>
</li>

<li class='nav-link-search' role='menuitem'>
<a href='/search/'>Search</a>
</li>

</ul>
</nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<section class='container content' id='content'>
<div class='alert alert-warning'>
<div class='pull-right'>
<a>Hover for more info</a>
</div>
<div class='frontmatter-metadata'>
<table class='metadata'>
<caption>Frontmatter Metadata</caption>
<tr>
<th>title</th>
<td>Building oVirt engine</td>
</tr>
<tr>
<th>category</th>
<td>draft-documentation</td>
</tr>
<tr>
<th>authors</th>
<td>abonas, alonbl, amuller, amureini, apevec, asaf, djorm, dneary, doron, dougsland, gwei3, ichristo, jhernand, jumper45, laravot, lhornyak, lpeer, mbetak, mburns, moolit, moti, ofrenkel, ovedo, quaid, rmiddle, sgordon, sgtpepper, shireesh, vered, yair zaslavsky, ykaul</td>
</tr>
<tr>
<th>wiki_category</th>
<td>Draft documentation</td>
</tr>
<tr>
<th>wiki_title</th>
<td>Building oVirt engine</td>
</tr>
<tr>
<th>wiki_revision_count</th>
<td>237</td>
</tr>
<tr>
<th>wiki_last_updated</th>
<td>2013-06-25</td>
</tr>
</table>
</div>
Original Wiki page:
<a href='http://ovirt.org/Building_oVirt_engine' target='_blank'>
Building oVirt engine
</a>
</div>

<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="building-ovirt-engine">Building oVirt engine</h1>

<p><span class="label label-warning"><big>ATTENTION: This page is obsoleted for &gt;=ovirt-engine-3.3 by <a href="/engine/engine-development-environment/">oVirt Engine Development Environment</a></big></span></p>

<h2 id="introduction">Introduction</h2>

<p>Follow these instructions to successfully build the oVirt Engine project. Installation and configuration of all required tools to complete the build is also covered. For instructions on obtaining and building VDSM, the package required to turn existing systems into oVirt Nodes, see <a href="/vdsm/developers/">Vdsm Developers</a>. Alternatively some binary VDSM builds are available <a href="http://fsimonce.fedorapeople.org/vdsm/">here</a>.</p>

<pre class="highlight plaintext"><code>  #&gt; at the beginning of the command stands for execution as root.&#x000A;  $&gt; at the beginning of the command stands for execution as user.&#x000A;</code></pre>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>Linux based operating system with support for OpenJDK 1.7.0, Maven 3 and PostgreSQL 8.4.8 (or higher).</li>
  <li>An Internet connection.</li>
</ol>

<p>Note that while this guide was written and tested using Fedora, other Linux Distributions can and have been used to build the ovirt-engine project. Where distribution specific packaging commands are specified in this guide - use the syntax that applies to your distribution.</p>

<h2 id="installing-build-tools">Installing Build Tools</h2>

<h3 id="installing-openjdk">Installing OpenJDK</h3>

<p>The supported Java development and runtime environments for the ovirt-engine project are provieded by OpenJDK 1.7.0. Install the java-1.7.0-openjdk-devel package to obtain OpenJDK 1.7.0:</p>

<p><strong>Fedora</strong></p>

<pre class="highlight plaintext"><code>  #&gt; yum install -y java-1.7.0-openjdk-devel&#x000A;</code></pre>

<p><strong>Debian</strong></p>

<pre class="highlight plaintext"><code>  #&gt; apt-get install openjdk-7-jdk&#x000A;</code></pre>

<p>Use the 'alternatives' command to verify that 'javac' is correctly linked to the openjdk-1.7.0 instance of the Java compiler:</p>

<pre class="highlight plaintext"><code>  $&gt; alternatives --display javac&#x000A;  javac - status is auto.&#x000A;   link currently points to /usr/lib/jvm/java-1.7.0-openjdk.x86_64/bin/javac&#x000A;  ...&#x000A;</code></pre>

<p>If the link does not point to the correct instance of the Java compiler, then you must update it. For example:</p>

<pre class="highlight plaintext"><code>  $&gt; alternatives --set javac /usr/lib/jvm/java-1.7.0-openjdk.x86_64/bin/javac&#x000A;</code></pre>

<h3 id="installing-git">Installing git</h3>

<p>The ovirt-engine source code is stored in a GIT repository. As such, GIT is required to obtain the latest source code.</p>

<p><strong>Fedora</strong></p>

<pre class="highlight plaintext"><code>  #&gt; yum install -y git&#x000A;</code></pre>

<p><strong>Debian</strong></p>

<pre class="highlight plaintext"><code>  #&gt; apt-get install git&#x000A;</code></pre>

<h3 id="installing-maven">Installing maven</h3>

<p>oVirt engine is using maven version 3.0.x. Building with maven 2 is not supported and in fact will not work.
 <strong>Fedora</strong></p>

<pre class="highlight plaintext"><code>  #&gt; yum install -y maven&#x000A;</code></pre>

<p><strong>Debian</strong></p>

<pre class="highlight plaintext"><code>  #&gt; apt-get install maven&#x000A;</code></pre>

<p><strong>Other</strong></p>

<p>If your operating system doesn't have a package for maven 3 you can download it from the <a href="http://maven.apache.org/download.cgi">maven web site</a> and install it manually. First uncompress the downloaded file to your preferred directory, for example to your home directory:</p>

<pre class="highlight plaintext"><code>$&gt; cd&#x000A;$&gt; wget ftp://ftp.mirrorservice.org/sites/ftp.apache.org/maven/maven-3/3.0.5/binaries/apache-maven-3.0.5-bin.tar.gz&#x000A;$&gt; tar xvf apache-maven-3.0.5-bin.tar.gz&#x000A;</code></pre>

<p>Make sure that the maven <em>bin</em> directory is the first in your path, otherwise you will be using the version of maven provided by your operating system:</p>

<pre class="highlight plaintext"><code>$&gt; PATH=$HOME/apache-maven-3.0.5/bin:$PATH&#x000A;$&gt; export PATH&#x000A;</code></pre>

<p>Please validate mvn is in the path and that it is version 3 or greater:</p>

<pre class="highlight plaintext"><code>$&gt; mvn -version&#x000A;Apache Maven 3.0.5 (r01de14724cdef164cd33c7c8c2fe155faf9602da; 2013-02-19 14:51:28+0100)&#x000A;...&#x000A;</code></pre>

<h5 id="maven-personal-settings">Maven personal settings</h5>

<p>Create your ~/.m2/ directory</p>

<pre class="highlight plaintext"><code>  $&gt; mkdir ~/.m2&#x000A;</code></pre>

<p>Use the following command to create maven settings file:</p>

<pre class="highlight plaintext"><code>  $&gt; cat &gt; ~/.m2/settings.xml &lt;&lt;"EOT"&#x000A;  &lt;settings xmlns="http://maven.apache.org/POM/4.0.0"&#x000A;            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;            xsi:schemaLocation="http://maven.apache.org/POM/4.0.0&#x000A;                                http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;&#x000A;&#x000A;  &lt;!--**************************** PROFILES ****************************--&gt;&#x000A;&#x000A;          &lt;activeProfiles&gt;&#x000A;                          &lt;activeProfile&gt;oVirtEnvSettings&lt;/activeProfile&gt;&#x000A;          &lt;/activeProfiles&gt;&#x000A;&#x000A;          &lt;profiles&gt;&#x000A;                  &lt;profile&gt;&#x000A;                          &lt;id&gt;oVirtEnvSettings&lt;/id&gt;&#x000A;                          &lt;properties&gt;                               &#x000A;                             &lt;jbossHome&gt;${env.JBOSS_HOME}&lt;/jbossHome&gt;&#x000A;                             &lt;JAVA_HOME&gt;${env.JAVA_HOME}&lt;/JAVA_HOME&gt;&#x000A;                          &lt;/properties&gt;&#x000A;                  &lt;/profile&gt;&#x000A;           &lt;/profiles&gt;&#x000A;  &lt;/settings&gt;&#x000A;  EOT&#x000A;</code></pre>

<ul>
  <li>Do not omit the active-profiles element in the above xml, it is crucial.</li>
  <li>If your JDK installation resides in a different path , please specify it instead of the provided path at JAVA_HOME.</li>
  <li>Please note that in order to use the {env.XXX} terms in maven's settings.xml,you need to set those variables in your environment.</li>
</ul>

<p>Assuming you're using bash, one of the ways to set them is to add them to .bashrc file that is located in user's home directory.</p>

<p>Example for variables in this file:</p>

<pre class="highlight plaintext"><code>   export JAVA_HOME=/usr/lib/jvm/java-1.7.0-openjdk.x86_64&#x000A;   export JBOSS_HOME=/usr/share/jboss-as&#x000A;   export PATH=$HOME/apache-maven-3.0.5/bin:$PATH&#x000A;   &#x000A;</code></pre>

<h2 id="installing-jboss-as">Installing JBoss AS</h2>

<h3 id="manually-from-zips">Manually (From Zips)</h3>

<pre class="highlight plaintext"><code>      $&gt; cd /usr/share&#x000A;      $&gt; wget http://download.jboss.org/jbossas/7.1/jboss-as-7.1.1.Final/jboss-as-7.1.1.Final.tar.gz&#x000A;      $&gt; tar -zxvf jboss-as-7.1.1.Final.tar.gz --no-same-owner&#x000A;      $&gt; ln -s /usr/share/jboss-as-7.1.1.Final /usr/share/jboss-as&#x000A;      $&gt; # Change the JBOSS_HOME environment variable to the new location&#x000A;      $&gt; su - -c 'chmod -R 777 /usr/share/jboss-as'&#x000A;      $&gt; # Change the Jboss home in ~/.m2/settings.xml file to point to the new location&#x000A;</code></pre>

<p>Make sure that it runs:</p>

<pre class="highlight plaintext"><code>      $&gt; /usr/share/jboss-as/bin/standalone.sh&#x000A;</code></pre>

<p>Make sure that you have write access to $JBOSS_HOME/standalone/deployments, to which oVirt-engine will be deployed. Fedora 18 with OpenJDK Runtime Environment fedora-2.3.5 has an issue with the LogManager when running standalone.sh. Downgrading to 2.3.3 solved the issue.</p>

<h3 id="automatically-from-rpms">Automatically (From RPMs)</h3>

<p>CURRENTLY WE DON'T HAVE RPM FOR JBOSS AS 7.1.1, SO USE THE ZIPPED VERSION</p>

<h3 id="troubleshooting">Troubleshooting</h3>

<ol>
  <li>Some useful JAVA_OPTS, these can be manually added to the <em>standalone.conf</em> script as required:
    <ol>
      <li>-Xmx512m - maximum Java heap size of 512m</li>
      <li>-Xdebug - include debugging</li>
    </ol>
  </li>
  <li>Run with -b 0.0.0.0 to have it bind to all IP addresses</li>
  <li>Make sure you've nothing bound to port 8080 or 8009
    <ol>
      <li>Other relevant ports JBoss may require are: 8443/8083/1090/4457</li>
    </ol>
  </li>
  <li>For external connections, make sure your FW allows 8080 incoming traffic</li>
  <li>If your machine has an selinux policy installed, make sure it will not block JBoss</li>
  <li>JBoss will bind to your host's name. Make sure it's resolvable by adding it to /etc/hosts or by any other method.</li>
  <li>
    <p>During development you may encounter a situation in which you work with the deployed application, but it does not behave as expected. In this case, you should remove the current deployment:</p>

    <p>  $&gt; cd $JBOSS_HOME/standalone
    $&gt; rm -rf deployments/engine.ear 
    $&gt; rm -rf deployments/engine.ear.deployed 
    $&gt; rm -rf tmp
    $&gt; rm -rf data (should be done only in development environment)
   </p>
  </li>
</ol>

<h2 id="installing-postgresql">Installing PostgreSQL</h2>

<p><a href="/documentation/installing-postgresql-db/">Installing_PostgreSQL_DB</a></p>

<h2 id="building-ovirt-engine-from-source">Building oVirt-engine from source</h2>

<h3 id="clone-ovirt-engine-codebase">Clone oVirt-engine codebase</h3>

<p>Choose a directory in which to store the oVirt source and 'cd' to it. Use git to clone the ovirt-engine repository into the current working directory:</p>

<pre class="highlight plaintext"><code>  $&gt; git clone git://gerrit.ovirt.org/ovirt-engine&#x000A;</code></pre>

<p>For further instructions let $OVIRT_HOME be <your_chosen_source_location>/ovirt-engine</your_chosen_source_location></p>

<p><strong>Note:</strong> the above cloning is for read only. If you want to contribute, you might want to skip to <a href="#Code_contribution:_Gerrit">#Code contribution: Gerrit</a> before moving to the next steps.</p>

<h3 id="creating-the-database">Creating the database</h3>

<p>Change into your git repository.</p>

<pre class="highlight plaintext"><code>  $&gt; cd $OVIRT_HOME/backend/manager/dbscripts&#x000A;</code></pre>

<p>Then run the following command to create the database (make sure you're not doing this at root):</p>

<pre class="highlight plaintext"><code>  $&gt; ./create_db_devel.sh -u postgres&#x000A;&#x000A;  Note: In case create_db_devel keeps asking for postgres password, create the following file:&#x000A;  $ echo "*:*:*:postgres:YOUR_POSTGRES_PASSWORD" &gt; ~/.pgpass &#x000A;  $ chmod 0600 ~/.pgpass&#x000A;</code></pre>

<p>On some installations you will receive an error message about uuid-ossp.sql not being found. This is an open issue. <a href="https://bugzilla.redhat.com/750626">https://bugzilla.redhat.com/750626</a></p>

<p>To work around the issue, edit the file $OVIRT_HOME/backend/manager/dbscripts_postgres/create_db.sh and change the references to uuid-ossp.sql to point to the right location.</p>

<h3 id="build">Build</h3>

<p>Note that on most modern distributions, the 'mvn' binary refers to Maven 3. In order to use Maven 2 you have to use mvn2. If in doubt, run 'mvn –version' and/or 'mvn2 –version' to confirm the version of Maven in use. If you only want to build virt-engine-core and REST API:</p>

<pre class="highlight plaintext"><code>   $&gt; cd $OVIRT_HOME&#x000A;   $&gt; mvn clean install&#x000A;</code></pre>

<p>In order to compile web-admin and user-portal, in addition to the api and engine, do the following:</p>

<pre class="highlight plaintext"><code>   $&gt; cd $OVIRT_HOME&#x000A;   $&gt; mvn clean install -Pgwt-admin,gwt-user&#x000A;</code></pre>

<p>Notes:
# Compiling web-admin and user-portal takes (a long) time. Please visit <a href="/documentation/draft/advanced-engine-build-notes/#GWT_Compilation_Configuration">GWT Compilation Configuration</a> if you want to speed the web compilation process during development time
# Make sure you run this with your user, and not as 'root'. Running as root will result in a missing settings.xml file in the 'root' home directory</p>

<ol>
  <li>In order to skip the execution of the unit tests and only compile and package ovirt, add the option: -DskipTests=true to the mvn/mvn2 build command</li>
  <li>You can reduce the build time and memory consumption - look at the temp section at the end.</li>
  <li>
    <p>If you receive "java.lang.OutOfMemoryError: PermGen space" error, use the MAVEN_OPTS environment variable to set a higher heap and permanent generation stack size, then try again:</p>

    <p>$&gt; export MAVEN_OPTS="-XX:MaxPermSize=128m"</p>
  </li>
</ol>

<p>For advanced build notes, please visit <a href="/documentation/draft/advanced-engine-build-notes/">Advanced oVirt Engine Build Notes</a></p>

<h3 id="deploy">Deploy</h3>

<p>The first deployment of the application to JBoss AS container should use the setup profile:</p>

<pre class="highlight plaintext"><code>  $&gt; cd $OVIRT_HOME/ear&#x000A;  $&gt; mvn clean install -Pdep,setup&#x000A;</code></pre>

<p>There is an issue with the dep and setup_postgres profiles getting in the way of each other. The setup_postgres profile prevents the quartz.jar deployment to the JBoss server. Therefore, after this step completes, run:</p>

<pre class="highlight plaintext"><code>  $&gt; cd $OVIRT_HOME/ear&#x000A;  $&gt; mvn clean install -Pdep&#x000A;</code></pre>

<p>From this point on, every time you deploy you can simply run:</p>

<pre class="highlight plaintext"><code>  $&gt; cd $OVIRT_HOME/ear&#x000A;  $&gt; mvn clean install -Pdep&#x000A;</code></pre>

<p>Since postgres is already set up.</p>

<h2 id="copying-vdsm-bootstrap-files">Copying vdsm bootstrap files</h2>

<p>In case you like to do a full bootstrap installation (InstallVds = True into the database), the following steps are required. Otherwise, ignore them.</p>

<pre class="highlight plaintext"><code>      #&gt; su - -c 'mkdir -p /usr/share/jboss-as/standalone/deployments/engine.ear/components.war/vds'&#x000A;      #&gt; git clone git://gerrit.ovirt.org/vdsm&#x000A;      #&gt; cd vdsm&#x000A;      #&gt; ./autogen.sh --system &amp;&amp; make&#x000A;      #&gt; cp vdsm_reg/deployUtil.py /usr/share/jboss-as/standalone/deployments/engine.ear/components.war/vds&#x000A;      #&gt; cp vds_bootstrap/vds_bootstrap_complete.py /usr/share/jboss-as/standalone/deployments/engine.ear/components.war/vds&#x000A;      #&gt; cp vds_bootstrap/vds_bootstrap.py /usr/share/jboss-as/standalone/deployments/engine.ear/components.war/vds&#x000A;      #&gt; psql engine postgres -c "update vdc_options set option_value = 'http://YOUR_ENGINE_HOST_HERE:8080/Components/vds' where option_name = 'VdcBootStrapUrl';"&#x000A;</code></pre>

<h2 id="deploying-engine-config--engine-manage-domains">Deploying engine-config &amp; engine-manage-domains</h2>

<pre class="highlight plaintext"><code>  $&gt; cd $OVIRT_HOME&#x000A;  $&gt; make create_dirs&#x000A;  $&gt; make install_tools (As of 06.02.2013 this target doesn't actually exist)&#x000A;  $&gt; make install_config&#x000A;</code></pre>

<h2 id="testing">Testing</h2>

<p>Assuming JBoss is not running, start it:</p>

<pre class="highlight plaintext"><code>      #&gt; service jboss-as start (or restart if you already started above for tests)&#x000A;      #&gt; ps ax | grep java&#x000A;</code></pre>

<p>or</p>

<pre class="highlight plaintext"><code>  $&gt; /usr/share/jboss-as/bin/standalone.sh&#x000A;</code></pre>

<p>Use username <strong>admin@internal</strong> and password <strong>letmein!</strong></p>

<p>Note: Make sure $OVIRT_HOME/backend/manager/conf/engine.conf.defaults exists and has the following two lines:</p>

<pre class="highlight plaintext"><code>  ENGINE_USR=username&#x000A;  ENGINE_ETC=/etc/ovirt-engine&#x000A;</code></pre>

<p>Then add the following line to your ~/.bashrc file:</p>

<pre class="highlight plaintext"><code>  export ENGINE_DEFAULTS=$OVIRT_HOME/backend/manager/conf/engine.conf.defaults&#x000A;</code></pre>

<p>Accessing the RESTful API:</p>

<pre class="highlight plaintext"><code>  wget -O - --debug --auth-no-challenge --http-user=admin@internal --http-password='letmein!' head='Accept: application/xml' http://&lt;server name&gt;:&lt;port&gt;/api/&#x000A;</code></pre>

<p>(by default, the port is 8700).</p>

<p>or from the browser</p>

<pre class="highlight plaintext"><code>  http://&lt;server name&gt;:&lt;port&gt;/api&#x000A;</code></pre>

<p>Accessing web-admin:
 http://<server name="">:<port>/webadmin</port></server></p>

<p>Accessing user-portal
 http://<server name="">:<port>/UserPortal</port></server></p>

<h2 id="setting-public-key-environment-recommended-to-ovirt-node-environment">Setting Public Key environment (recommended to oVirt Node environment)</h2>

<p>Follow this page: <a href="wiki/Engine_Node_Integration#Engine_core_machine">http://www.ovirt.org/wiki/Engine_Node_Integration#Engine_core_machine</a></p>

<h2 id="enable-8443-ssl-into-jboss">Enable 8443 (SSL) into Jboss</h2>

<pre class="highlight plaintext"><code>  $ cd /usr/share/jboss-as/&#x000A;  $ keytool -genkey -alias jboss -keyalg RSA -keysize 1024 -keystore .keystore -validity 3650  (Keep in mind the password to the next step)&#x000A;  $ chown jboss-as:jboss-as .keystore&#x000A;  $ /usr/share/jboss-as/bin/jboss-admin.sh --connect (CLI will open)&#x000A;&#x000A;  [standalone@localhost:9999 /] (type the below command)&#x000A;  /subsystem=web/connector=https:add(socket-binding=https, scheme=https, protocol="HTTP/1.1", ssl = {"name"=&gt;"ssl", "key-alias"=&gt;"jboss", "password"=&gt;"PASSWORD_PROVIDED_ABOVE","certificate-key-file"=&gt;".keystore"})&#x000A;  [standalone@localhost:9999 /] exit&#x000A;&#x000A;  # service jboss-as restart &#x000A;</code></pre>

<p>For additional info: <a href="https://docs.jboss.org/author/display/AS7/Admin+Guide#AdminGuide-HTTPSConnectors">https://docs.jboss.org/author/display/AS7/Admin+Guide#AdminGuide-HTTPSConnectors</a></p>

<h2 id="i-have-made-changes-to-ovirt-engine-code-how-can-i-deploy-it">I have made changes to ovirt engine code. How can I deploy it?</h2>

<p>The following builds the engine, rebuilds the admin console and then creates the ear and deploys it to jboss:</p>

<pre class="highlight plaintext"><code>      #&gt; mvn clean install -Pgwt-admin -DskipTests &amp;&amp; cd ear &amp;&amp; mvn clean install -Pdep&#x000A;      #&gt; service jboss-as restart&#x000A;</code></pre>

<h2 id="advanced-features">Advanced features</h2>

<ul>
  <li>Registering an oVirt Node
    <ul>
      <li>By default, development setup works with hosts based on base distro's, such as Fedora.</li>
      <li>In order to be able to work with oVirt Node, you'll need to setup a Public Key environment.</li>
      <li>More details on Engine and oVirt Node integration can be found in <a href="/node/engine-node-integration/">Engine_Node_Integration</a>.</li>
    </ul>
  </li>
</ul>

<h2 id="code-contribution-gerrit">Code contribution: Gerrit</h2>

<ul>
  <li>Code contribution to the oVirt-engine is done via Gerrit.
* More details can be found in <a href="/documentation/internal/working-with-gerrit/">Working_with_oVirt_Gerrit</a>.</li>
  <li>All changes (patches) to the engine project are sent to the engine-patches mailing list (usually automatically by gerrit).
* please subscribe to <a href="http://lists.ovirt.org/mailman/listinfo/engine-patches">engine-patches mailing list</a></li>
</ul>

<h2 id="getting-the-latest">Getting the latest</h2>

<p>If you have a working development environment and after a while you want
to update the code (take the latest):</p>

<ol>
  <li>git fetch -v</li>
  <li>git rebase origina/master</li>
  <li>Compile the code</li>
  <li>
    <p>Upgrade your DB schema</p>

    <p>$&gt; cd $OVIRT_HOME/backend/manager/dbscripts/
  $&gt; ./upgrade.sh -u postgres</p>
  </li>
</ol>

<h2 id="is-there-an-ide">Is there an IDE?</h2>

<p>Yes! Take a look at <a href="/engine/building/ide/">Building_Ovirt_Engine/IDE</a></p>

<h2 id="more-information">More information</h2>

<ul>
  <li><a href="https://wiki.gentoo.org/wiki/OVirt">Engine setup on Gentoo</a></li>
  <li><a href="/distributions/debian/ubuntu/">Ovirt build on debian/ubuntu</a></li>
</ul>

<h2 id="troubleshooting-1">Troubleshooting</h2>

<h3 id="host-non-responsive">Host Non-Responsive</h3>

<ul>
  <li>Make sure you have both vdsm and ovirt-engine with ssl disabled or enabled.</li>
  <li>If you have enabled ssl anytime and want reset to ssl=false, you must reconfigure vdsm and start the daemon again.</li>
</ul>

<p>Example setting ssl false:</p>

<ul>
  <li>
    <p>(ovirt Node side)</p>

    <p> $ vi /etc/vdsm/vdsm.conf
   ssl = false
   
   $ /lib/systemd/systemd-vdsmd reconfigure
   $ sudo service vdsmd start</p>
  </li>
  <li>
    <p>(ovirt Engine side)</p>

    <p> $ psql engine -U postgres -c "UPDATE vdc_options set option_value = 'false' where option_name = 'SSLEnabled'"
   $ psql engine -U postgres -c "UPDATE vdc_options set option_value = 'false' where option_name = 'UseSecureConnectionWithServers'"
   $ sudo service jboss-as restart</p>
  </li>
</ul>

<h3 id="install-failed">Install Failed</h3>

<p>Actions:</p>

<ul>
  <li>
    <p>Host side:</p>

    <p> Look at /tmp/vds* files</p>
  </li>
  <li>
    <p>Engine side:</p>

    <p> Look at /usr/share/jboss-as/standalone/log/engine/engine.log</p>
  </li>
  <li>
    <p>Have you created /var/lock/ovirt-engine/.openssl.exclusivelock with 777 perm ?</p>
  </li>
</ul>

<h3 id="logs">Logs</h3>

<ul>
  <li>
    <p>(oVirt Node)</p>

    <p> /var/log/vdsm/vdsm.log
   /var/log/vdsm-reg/vdsm-reg.log</p>
  </li>
  <li>
    <p>(Fedora/Any other distro)</p>

    <p> /tmp/vds* (bootstrap)
   /var/log/vdsm/vdsm.log
   /var/log/vdsm-reg/vdsm-reg.log</p>
  </li>
  <li>
    <p>(oVirt Engine side)</p>

    <p> /usr/share/jboss-as/standalone/log/server.log
   /usr/share/jboss-as/standalone/log/engine/engine.log</p>
  </li>
  <li>
    <p>(spice)</p>

    <p> Run firefox setting SPICEC_LOG_LEVEL
   # SPICEC_LOG_LEVEL=0 firefox
   Afer that, check the file: ~/.spicec/spicec.log</p>
  </li>
</ul>

<h3 id="webadmin-error">Webadmin error</h3>

<ul>
  <li>
    <p>If clean 'mvn install' succeeded, with admin GWT build, but when running webadmin there is an error:</p>

    <p>java.lang.NoClassDefFoundError: Could not initialize class org.ovirt.engine.ui.frontend.server.gwt.plugin.PluginDataManager$Holder..
   copy as root: backend/manager/conf/engine.conf.defaults.in to /usr/share/ovirt-engine/conf/engine.conf.defaults (create dirs if needed)</p>
  </li>
</ul>

<p><a href="/documentation/draft-documentation/">Category:Draft documentation</a> <category:engine> [Category:How to](Category:How to)</category:engine></p>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="/privacy/">Privacy policy</a></li>
<li><a target="_blank" href="/about/">About</a></li>
<li><a target="_blank" href="/disclaimers/">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2015 oVirt
<div class='last-modified'>
Page last modified
Wed 11 Nov 2015 18:11 UTC
</div>
</footer>


<script src="/javascripts/application.js?1447687452" type="text/javascript"></script>

<!-- eloqua -->
<script src='http://www.redhat.com/j/elqNow/elqCfg.js' type='text/javascript'></script>
<script src='http://www.redhat.com/j/elqNow/elqImg.js' type='text/javascript'></script>

</body>
</html>
