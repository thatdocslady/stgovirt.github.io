<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
DraftInstallationGuide &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href="/stylesheets/application.css?1447687441" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1447687441" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'>
<h1>
<a href="/"><img id="logo" class="logo is-svg" alt="oVirt" src="/images/logo.svg?1447687442" />
</a></h1>
</section>
<div id='access'>
<nav role='navigation'>
<ul class='nav nav-pills'>
<li class='nav-link-home' role='menuitem'>
<a href='/'>Home</a>
</li>

<li class='nav-link-download' role='menuitem'>
<a href='/download/'>Download</a>
</li>

<li class='nav-link-documentation' role='menuitem'>
<a href='/documentation/'>Documentation</a>
</li>

<li class='nav-link-community' role='menuitem'>
<a href='/community/'>Community</a>
</li>

<li class='nav-link-develop' role='menuitem'>
<a href='/develop/'>Develop</a>
</li>

<li class='nav-link-search' role='menuitem'>
<a href='/search/'>Search</a>
</li>

</ul>
</nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<section class='container content' id='content'>
<div class='alert alert-warning'>
<div class='pull-right'>
<a>Hover for more info</a>
</div>
<div class='frontmatter-metadata'>
<table class='metadata'>
<caption>Frontmatter Metadata</caption>
<tr>
<th>title</th>
<td>DraftInstallationGuide</td>
</tr>
<tr>
<th>category</th>
<td>documentation</td>
</tr>
<tr>
<th>authors</th>
<td>bproffitt</td>
</tr>
<tr>
<th>wiki_title</th>
<td>DraftInstallationGuide</td>
</tr>
<tr>
<th>wiki_revision_count</th>
<td>17</td>
</tr>
<tr>
<th>wiki_last_updated</th>
<td>2014-07-10</td>
</tr>
</table>
</div>
Original Wiki page:
<a href='http://ovirt.org/DraftInstallationGuide' target='_blank'>
DraftInstallationGuide
</a>
</div>

<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="draft-installation-guide">Draft Installation Guide</h1>

<p><strong>Abstract</strong></p>

<p>A comprehensive guide to installing oVirt 3.4.</p>

<h2 id="chapter-1-installing-ovirt">⁠Chapter 1. Installing oVirt</h2>

<h3 id="workflow-progress---installing-ovirt">Workflow Progress - Installing oVirt</h3>

<p><img alt="" title="images/1191.png" src="/images/images/1191.png" /></p>

<h3 id="installing-ovirt">Installing oVirt</h3>

<p><em>Overview</em>'</p>

<p>oVirt can be installed under one of two arrangements - a standard setup in which oVirt is installed on an independent physical machine or virtual machine, or a self-hosted engine setup in which oVirt runs on a virtual machine that oVirt itself controls.</p>

<div class="alert alert-info">
  <p><strong>Important:</strong> While the prerequisites for and basic configuration of oVirt itself are the same for both standard and self-hosted engine setups, the process for setting up a self-hosted engine is different from that of a standard setup.</p>

</div>
<p><strong>Prerequisites</strong></p>

<p>Before installing oVirt, you must ensure that you meet all the prerequisites. To complete installation of oVirt successfully, you must also be able to determine:</p>

<ol>
  <li>The ports to be used for HTTP and HTTPS communication. The defaults ports are <code>80</code> and <code>443</code> respectively.</li>
  <li>The fully qualified domain name (FQDN) of the system on which oVirt is to be installed.</li>
  <li>The password you use to secure the oVirt administration account.</li>
  <li>The location of the database server to be used. You can use the setup script to install and configure a local database server or use an existing remote database server. To use a remote database server you must know:
    <ul>
      <li>The host name of the system on which the remote database server exists.</li>
      <li>The port on which the remote database server is listening.</li>
      <li>That the <code>uuid-ossp</code> extension had been loaded by the remote database server.</li>
    </ul>

    <p>You must also know the user name and password of a user that is known to the remote database server. The user must have permission to create databases in PostgreSQL.</p>
  </li>
  <li>The organization name to use when creating oVirt's security certificates.</li>
  <li>The storage type to be used for the initial data center attached to oVirt. The default is NFS.</li>
  <li>The path to use for the ISO share, if oVirt is being configured to provide one. The display name, which will be used to label the domain in oVirt also needs to be provided.</li>
  <li>The firewall rules, if any, present on the system that need to be integrated with the rules required for oVirt to function.</li>
</ol>

<p><strong>Configuration</strong></p>

<p>Before installation is completed the values selected are displayed for confirmation. Once the values have been confirmed they are applied and oVirt is ready for use.</p>

<p>⁠</p>

<p><strong>Example 1.1. Completed Installation</strong></p>

<pre class="highlight plaintext"><code>--== CONFIGURATION PREVIEW ==--&#x000A;&#x000A;Engine database name                    : engine&#x000A;Engine database secured connection      : False&#x000A;Engine database host                    : localhost&#x000A;Engine database user name               : engine&#x000A;Engine database host name validation    : False&#x000A;Engine database port                    : 5432&#x000A;NFS setup                               : True&#x000A;PKI organization                        : Your Org&#x000A;Application mode                        : both&#x000A;Firewall manager                        : iptables&#x000A;Update Firewall                         : True&#x000A;Configure WebSocket Proxy               : True&#x000A;Host FQDN                               : Your Manager's FQDN&#x000A;NFS export ACL                          : 0.0.0.0/0.0.0.0(rw)&#x000A;NFS mount point                         : /var/lib/exports/iso&#x000A;Datacenter storage type                 : nfs&#x000A;Configure local Engine database         : True&#x000A;Set application as default page         : True&#x000A;Configure Apache SSL                    : True&#x000A;&#x000A;Please confirm installation settings (OK, Cancel) [OK]:&#x000A;</code></pre>

<div class="alert alert-info">
  <p><strong>Note:</strong> Automated installations are created by providing <code>engine-setup</code> with an answer file. An answer file contains answers to the questions asked by the setup command.</p>

</div>
<ul>
  <li>
    <p>To create an answer file, use the <em><code>--generate-answer</code></em> parameter to specify a path and file name with which to create the answer file. When this option is specified, the <code>engine-setup</code> command records your answers to the questions in the setup process to the answer file.
    # engine-setup –generate-answer=[ANSWER_FILE]</p>
  </li>
  <li>
    <p>To use an answer file for a new installation, use the <em><code>--config-append</code></em> parameter to specify the path and file name of the answer file to be used. The <code>engine-setup</code> command will use the answers stored in the file to complete the installation.
    # engine-setup –config-append=[ANSWER_FILE]</p>
  </li>
</ul>

<p>Run <code>engine-setup --help</code> for a full list of parameters.</p>

<div class="alert alert-info">
  <p><strong>Note:</strong> Offline installation requires the creation of a software repository local to your oVirt environment. This software repository must contain all of the packages required to install oVirt, Red Hat Enterprise Linux virtualization hosts, and Red Hat Enterprise Linux virtual machines. To create such a repository, see the <em>Installing Red Hat Enterprise Virtualization Offline</em> technical brief, available at <a href="https://access.redhat.com/knowledge/techbriefs/installing-red-hat-enterprise-virtualization-offline-rhev-30"><a href="https://access.redhat.com/knowledge/techbriefs/installing-red-hat-enterprise-virtualization-offline-rhev-30">https://access.redhat.com/knowledge/techbriefs/installing-red-hat-enterprise-virtualization-offline-rhev-30</a></a>.</p>

</div>
<p>### Installing oVirt</p>

<h4 id="configuring-an-offline-repository-for-ovirt-installation">Configuring an Offline Repository for oVirt Installation</h4>

<p>This task documents the creation of an offline repository containing all packages needed to install a oVirt environment. Follow these steps to create a repository you can use to install oVirt components on systems without a direct connection to Red Hat Network.</p>

<ol>
  <li>
    <p><strong>Install Red Hat Enterprise Linux</strong>
Install Red Hat Enterprise Linux 6 Server on a system that has access to Red Hat Network. This system downloads all required packages, and distribute them to your offline system(s).</p>

    <p><strong>Important</strong></p>

    <p>Ensure that the system used has a large amount of free disk space available. This procedure downloads a large number of packages, and requires up to 1.5 GB of free disk space.</p>
  </li>
  <li>
    <p><strong>Register Red Hat Enterprise Linux</strong>
Register the system with Red Hat Network (RHN) using either Subscription Manager or RHN Classic.</p>

    <ul>
      <li>
        <p><strong>Subscription Manager</strong>
Use the <code>subscription-manager</code> command as <code>root</code> with the <em><code>register</code></em> parameter.</p>

<pre class="highlight plaintext"><code># subscription-manager register&#x000A;</code></pre>
      </li>
      <li>
        <p><strong>RHN Classic</strong>
Use the <code>rhn_register</code> command as <code>root</code>.</p>

<pre class="highlight plaintext"><code># rhn_register&#x000A;</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Add required channel subscriptions</strong>
Subscribe the system for all channels listed in the <em>Red Hat Enterprise Virtualization - Installation Guide</em>.</p>

    <ul>
      <li><strong>Subscription Manager</strong></li>
      <li><strong>RHN Classic</strong></li>
    </ul>
  </li>
  <li>
    <p><strong>Configure File Transfer Protocol (FTP) access</strong>
Servers that are not connected to the Internet can access the software repository using File Transfer Protocol (FTP). To create the FTP repository you must install and configure vsftpd, while logged in to the system as the <code>root</code> user:</p>

    <ol>
      <li>
        <p><strong>Install vsftpd</strong>
Install the vsftpd package.</p>

<pre class="highlight plaintext"><code># yum install vsftpd&#x000A;</code></pre>
      </li>
      <li>
        <p><strong>Start vsftpd</strong>
Start the <code>vsftpd</code> daemon.</p>

<pre class="highlight plaintext"><code># chkconfig vsftpd on    service vsftpd start&#x000A;</code></pre>
      </li>
      <li>
        <p><strong>Create sub-directory</strong>
Create a sub-directory inside the <code>/var/ftp/pub/</code> directory. This is where the downloaded packages will be made available.</p>

<pre class="highlight plaintext"><code># mkdir /var/ftp/pub/rhevrepo&#x000A;</code></pre>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>Download packages</strong>
Once the FTP server has been configured, you must use the <code>reposync</code> command to download the packages to be shared. It downloads all packages from all configured software repositories. This includes repositories for all Red Hat Network channels the system is subscribed to, and any locally configured repositories.</p>

    <ol>
      <li>
        <p>As the <code>root</code> user, change into the <code>/var/ftp/pub/rhevrepo</code> directory.
    # cd /var/ftp/pub/rhevrepo</p>
      </li>
      <li>
        <p>Run the <code>reposync</code> command.
    # reposync –plugins .</p>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>Create local repository metadata</strong>
Use the <code>createrepo</code> command to create repository metadata for each of the sub-directories where packages were downloaded under <code>/var/ftp/pub/rhevrepo</code>.</p>

<pre class="highlight plaintext"><code># for DIR in `find /var/ftp/pub/rhevrepo -maxdepth 1 -mindepth 1 -type d`; do createrepo $DIR; done;&#x000A;</code></pre>
  </li>
  <li>
    <p><strong>Create repository configuration files</strong>
Create a <code>yum</code> configuration file, and copy it to the <code>/etc/yum.repos.d/</code> directory on client systems that you want to connect to this software repository. Ensure that the system hosting the repository is connected to the same network as the client systems where the packages are to be installed.</p>

    <p>The configuration file can be created manually, or using a script. If using a script, then before running it you must replace <code>ADDRESS</code> in the <em><code>baseurl</code></em> with the IP address or Fully Qualified Domain Name (FQDN) of the system hosting the repository. The script must be run on this system and then distributed to the client machines. For example:</p>

<pre class="highlight shell"><code><span class="c">#!/bin/sh</span>&#x000A;&#x000A;<span class="nv">REPOFILE</span><span class="o">=</span>&amp;quot;/etc/yum.repos.d/rhev.repo&amp;quot;&#x000A;&#x000A;<span class="k">for </span>DIR <span class="k">in</span> <span class="sb">`</span>find /var/ftp/pub/rhevrepo -maxdepth 1 -mindepth 1 -type d<span class="sb">`</span>; <span class="k">do  &#x000A;    </span><span class="nb">echo</span> -e &amp;quot;[<span class="sb">`</span>basename <span class="nv">$DIR</span><span class="sb">`</span><span class="o">]</span>&amp;quot;   &amp;gt; <span class="nv">$REPOFILE</span>  &#x000A;    <span class="nb">echo</span> -e &amp;quot;name<span class="o">=</span><span class="sb">`</span>basename <span class="nv">$DIR</span><span class="sb">`</span>&amp;quot; &amp;gt;&amp;gt; <span class="nv">$REPOFILE</span> &#x000A;    <span class="nb">echo</span> -e &amp;quot;baseurl<span class="o">=</span>ftp://ADDRESS/pub/rhevrepo/<span class="sb">`</span>basename <span class="nv">$DIR</span><span class="sb">`</span>&amp;quot; &amp;gt;&amp;gt; <span class="nv">$REPOFILE</span>   &#x000A;    <span class="nb">echo</span> -e &amp;quot;enabled<span class="o">=</span>1&amp;quot; &amp;gt;&amp;gt; <span class="nv">$REPOFILE</span>  &#x000A;    <span class="nb">echo</span> -e &amp;quot;gpgcheck<span class="o">=</span>0&amp;quot; &amp;gt;&amp;gt; <span class="nv">$REPOFILE</span> &#x000A;    <span class="nb">echo</span> -e &amp;quot;<span class="se">\n</span>&amp;quot; &amp;gt;&amp;gt; <span class="nv">$REPOFILE</span>&#x000A;<span class="k">done</span>;&#x000A;</code></pre>
  </li>
  <li>
    <p><strong>Copy the repository configuration file to client system</strong>
Copy the repository configuration file to the <code>/etc/yum.repos.d/</code> directory on every system that you want to connect to this software repository. For example: oVirt system(s), all Red Hat Enterprise Linux virtualization hosts, and all Red Hat Enterprise Linux virtual machines.</p>
  </li>
</ol>

<p>Now that your client systems have been configured to use your local repository, you can proceed with management server, virtualization host, and virtual machine installation as documented in the oVirt product documentation. Instead of installing packages from Red Hat Network, you can install them from your newly created local repository.</p>

<div class="alert alert-info">
  <p><strong>Note:</strong> You can also provide the software repository created here to client systems using removable media, such as a portable USB drive. To do this, first create the repository using the steps provided, and then:</p>

  <ol>
    <li>Recursively copy the <code>/var/ftp/pub/rhevrepo</code> directory, and all its contents, to the removable media.</li>
    <li>Modify the <code>/etc/yum.repos.d/rhev.repo</code> file, replacing the <code>baseurl</code> values with the path to which the removable media will be mounted on the client systems. For example <code>file:///media/disk/rhevrepo/</code>.
&lt;/div&gt;</li>
  </ol>

  <div class="alert alert-info">
    <p><strong>Note:</strong> As updated packages are released to Red Hat Network - addressing security issues, fixing bugs, and adding enhancements - you must update your local repository. To do this, repeat the procedure for synchronizing and sharing the channels. Adding the <em><code>--newest-only</code></em> parameter to the <code>reposync</code> command ensures that it only retrieves the newest version of each available package. Once the repository is updated you must ensure it is available to each of your client systems and then run <code>yum update</code> on it.</p>

  </div>
  <p>#### Installing oVirt Packages</p>

  <p><strong>Summary</strong></p>

  <p>Before you can configure and use oVirt, you must install the rhevm package and dependencies.</p>

  <p><strong>Procedure 1.1. Installing oVirt Packages</strong></p>

  <ol>
    <li>
      <p>To ensure all packages are up to date, run the following command on the machine where you are installing oVirt:
    # yum update</p>
    </li>
    <li>
      <p>Run the following command to install the rhevm package and dependencies.
    # yum install rhevm</p>

      <p><strong>Note</strong></p>

      <p>The rhevm-doc package is installed as a dependency of the rhevm package, and provides a local copy of the Red Hat Enterprise Virtualization documentation suite. This documentation is also used to provide context sensitive help links from the Administration and User Portals. You can run the following commands to search for translated versions of the documentation:</p>

<pre class="highlight plaintext"><code># yum search rhevm-doc&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have installed the rhevm package and dependencies.</p>

  <h4 id="configuring-ovirt"> Configuring oVirt</h4>

  <p>After you have installed the rhevm package and dependencies, you must configure oVirt using the <code>engine-setup</code> command. This command asks you a series of questions and, after you provide the required values for all questions, applies that configuration and starts the <code>ovirt-engine</code> service.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> The <code>engine-setup</code> command guides you through several distinct configuration stages, each comprising several steps that require user input. Suggested configuration defaults are provided in square brackets; if the suggested value is acceptable for a given step, press <strong>Enter</strong> to accept that value.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 1.2. Configuring oVirt</strong></p>

  <ol>
    <li>
      <p><strong>Packages</strong>
The <code>engine-setup</code> command checks to see if it is performing an upgrade or an installation, and whether any updates are available for the packages linked to oVirt. No user input is required at this stage.</p>

<pre class="highlight plaintext"><code>[ INFO  ] Checking for product updates...&#x000A;[ INFO  ] No product updates found&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Network Configuration</strong>
A reverse lookup is performed on the host name of the machine on which oVirt is being installed. The host name is detected automatically, but you can correct this host name if it is incorrect or if you are using virtual hosts. There must be forward and reverse lookup records for the provided host name in DNS, especially if you will also install the reports server.</p>

<pre class="highlight plaintext"><code>Host fully qualified DNS name of this server [autodetected host name]:&#x000A;</code></pre>

      <p>The <code>engine-setup</code> command checks your firewall configuration and offers to modify that configuration for you to open the ports used by oVirt for external communication such as TCP ports 80 and 443. If you do not allow the <code>engine-setup</code> command to modify your firewall configuration, then you must manually open the ports used by oVirt.</p>

<pre class="highlight plaintext"><code>Do you want Setup to configure the firewall? (Yes, No) [Yes]:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Database Configuration</strong>
You can use either a local or remote PostgreSQL database. The <code>engine-setup</code> command can configure your database automatically (including adding a user and a database), or it can use values that you supply.</p>

<pre class="highlight plaintext"><code>Where is the database located? (Local, Remote) [Local]: &#x000A;Setup can configure the local postgresql server automatically for the engine to run. This may conflict with existing applications.&#x000A;Would you like Setup to automatically configure postgresql and create Engine database, or prefer to perform that manually? (Automatic, Manual) [Automatic]:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>oVirt Engine Configuration</strong>
Select <strong>Gluster</strong>, <strong>Virt</strong>, or <strong>Both</strong>:</p>

<pre class="highlight plaintext"><code>Application mode (Both, Virt, Gluster) [Both]:&#x000A;</code></pre>

      <p><strong>Both</strong> offers the greatest flexibility.</p>

      <p>Choose the initial data center storage type. You can have many data centers in your environment, each with a different type of storage; this is the storage type of your first data center:</p>

<pre class="highlight plaintext"><code>Default storage type: (NFS, FC, ISCSI, POSIXFS) [NFS]:&#x000A;</code></pre>

      <p>Set a password for the automatically created administrative user of oVirt:</p>

<pre class="highlight plaintext"><code>Engine admin password:&#x000A;Confirm engine admin password:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>PKI Configuration</strong>
oVirt uses certificates to communicate securely with its hosts. You provide the organization name for the certificate. This certificate can also optionally be used to secure https communications with oVirt.</p>

<pre class="highlight plaintext"><code>Organization name for certificate [autodetected domain-based name]:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Apache Configuration</strong>
By default, external SSL (HTTPS) communication with oVirt is secured with the self-signed certificate created in the PKI configuration stage to securely communicate with hosts. Another certificate may be chosen for external HTTPS connections, without affecting how oVirt communicates with hosts.</p>

<pre class="highlight plaintext"><code>Setup can configure apache to use SSL using a certificate issued from the internal CA.&#x000A;Do you wish Setup to configure that, or prefer to perform that manually? (Automatic, Manual) [Automatic]:&#x000A;</code></pre>

      <p>oVirt uses the Apache web server to present a landing page to users. The <code>engine-setup</code> command can make the landing page of oVirt the default page presented by Apache.</p>

<pre class="highlight plaintext"><code>Setup can configure the default page of the web server to present the application home page. This may conflict with existing applications.&#x000A;Do you wish to set the application as the default web page of the server? (Yes, No) [Yes]:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>System Configuration</strong>
The <code>engine-setup</code> command can create an NFS share on oVirt to use as an ISO storage domain. Hosting the ISO domain locally to oVirt simplifies keeping some elements of your environment up to date.</p>

<pre class="highlight plaintext"><code>Configure an NFS share on this server to be used as an ISO Domain? (Yes, No) [Yes]: &#x000A;Local ISO domain path [/var/lib/exports/iso]: &#x000A;Local ISO domain ACL [0.0.0.0/0.0.0.0(rw)]: &#x000A;Local ISO domain name [ISO_DOMAIN]:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Websocket Proxy Server Configuration</strong>
The <code>engine-setup</code> command can optionally configure a websocket proxy server for allowing users to connect to virtual machines via the noVNC or HTML 5 consoles.</p>

<pre class="highlight plaintext"><code>Configure WebSocket Proxy on this machine? (Yes, No) [Yes]:&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Miscellaneous Configuration</strong>
You can use the <code>engine-setup</code> command to allow a proxy server to broker transactions from the Red Hat Access plug-in.</p>

<pre class="highlight plaintext"><code>Would you like transactions from the Red Hat Access Plugin sent from the RHEV Manager to be brokered through a proxy server? (Yes, No) [No]:&#x000A;&#x000A;[ INFO  ] Stage: Setup validation&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuration Preview</strong>
Check the configuration preview to confirm the values you entered before they are applied. If you choose to proceed, <code>engine-setup</code> configures oVirt using those values.</p>

<pre class="highlight plaintext"><code>Engine database name                    : engine&#x000A;Engine database secured connection      : False&#x000A;Engine database host                    : localhost&#x000A;Engine database user name               : engine&#x000A;Engine database host name validation    : False&#x000A;Engine database port                    : 5432&#x000A;NFS setup                               : True&#x000A;PKI organization                        : Your Org&#x000A;Application mode                        : both&#x000A;Firewall manager                        : iptables&#x000A;Update Firewall                         : True&#x000A;Configure WebSocket Proxy               : True&#x000A;Host FQDN                               : Your Manager's FQDN&#x000A;NFS export ACL                          : 0.0.0.0/0.0.0.0(rw)&#x000A;NFS mount point                         : /var/lib/exports/iso&#x000A;Datacenter storage type                 : nfs&#x000A;Configure local Engine database         : True&#x000A;Set application as default page         : True&#x000A;Configure Apache SSL                    : True&#x000A;&#x000A;Please confirm installation settings (OK, Cancel) [OK]:&#x000A;</code></pre>

      <p>When your environment has been configured, the <code>engine-setup</code> command displays details about how to access your environment and related security details.</p>
    </li>
    <li>
      <p><strong>Clean Up and Termination</strong>
The <code>engine-setup</code> command cleans up any temporary files created during the configuration process, and outputs the location of the log file for oVirt configuration process.</p>

<pre class="highlight plaintext"><code>[ INFO  ] Stage: Clean up&#x000A;          Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-installation-date.log&#x000A;[ INFO  ] Stage: Pre-termination&#x000A;[ INFO  ] Stage: Termination&#x000A;[ INFO  ] Execution of setup completed successfully&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>oVirt has been configured and is running on your server. You can log in to the Administration Portal as the <code>admin@internal</code> user to continue configuring oVirt. Furthermore, the <code>engine-setup</code> command saves your answers to a file that can be used to reconfigure oVirt using the same values.</p>

  <h4 id="preparing-a-postgresql-database-for-use-with-ovirt"> Preparing a PostgreSQL Database for Use with oVirt</h4>

  <p><strong>Summary</strong></p>

  <p>You can manually configure a database server to host the database used by oVirt. The database can be hosted either locally on the machine on which oVirt is installed, or remotely on another machine.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> The database must be prepared prior to running the <code>engine-setup</code> command.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 1.3. Preparing a PostgreSQL Database for use with oVirt</strong></p>

  <ol>
    <li>
      <p>Run the following commands to initialize the PostgreSQL database, start the <code>postgresql</code> service and ensure this service starts on boot:
    # service postgresql initdb
    # service postgresql start
    # chkconfig postgresql on</p>
    </li>
    <li>
      <p>Create a user for oVirt to use when it writes to and reads from the database, and a database in which to store data about the oVirt environment. You must perform this step on both local and remote databases. Use the <strong>psql</strong> terminal as the <code>postgres</code> user.
    # su - postgres
    $ psql            <br />
    postgres=# create role [user name] with login encrypted password '[password]';
    postgres=# create database [database name] owner [user name] template template0 encoding 'UTF8' lc_collate 'en_US.UTF-8' lc_ctype 'en_US.UTF-8';</p>
    </li>
    <li>
      <p>Run the following commands to connect to the new database and add the <code>plpgsql</code> language:
    postgres=# \c [database name]
    CREATE LANGUAGE plpgsql;</p>
    </li>
    <li>Ensure the database can be accessed remotely by enabling client authentication. Edit the <code>/var/lib/pgsql/data/pg_hba.conf</code> file, and add the following in accordance with the location of the database:
      <ul>
        <li>
          <p>For local databases, add the two following lines immediately underneath the line starting with <code>Local</code> at the bottom of the file:
    host    [database name]    [user name]    0.0.0.0/0  md5
    host    [database name]    [user name]    ::0/0      md5</p>
        </li>
        <li>
          <p>For remote databases, add the following line immediately underneath the line starting with <code>Local</code> at the bottom of the file, replacing <em>X.X.X.X</em> with the IP address of oVirt:
    host    [database name]    [user name]    X.X.X.X/32   md5</p>
        </li>
      </ul>
    </li>
    <li>
      <p>Allow TCP/IP connections to the database. You must perform this step for remote databases. Edit the <code>/var/lib/pgsql/data/postgresql.conf</code> file and add the following line:
    listen_addresses='*'</p>

      <p>This example configures the <code>postgresql</code> service to listen for connections on all interfaces. You can specify an interface by giving its IP address.</p>
    </li>
    <li>Restart the <code>postgresql</code> service. This step is required on both local and remote manually configured database servers.
    # service postgresql restart</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have manually configured a PostgreSQL database to use with oVirt.</p>

  <h4 id="configuring-ovirt-to-use-a-manually-configured-local-or-remote-postgresql-database"> Configuring oVirt to Use a Manually Configured Local or Remote PostgreSQL Database</h4>

  <p><strong>Summary</strong></p>

  <p>During the database configuration stage of configuring oVirt using the <code>engine-setup</code> script, you can choose to use a manually configured database. You can select to use a locally or remotely installed PostgreSQL database.</p>

  <p>⁠</p>

  <p><strong>Procedure 1.4. Configuring oVirt to use a Manually Configured Local or Remote PostgreSQL Database</strong></p>

  <ol>
    <li>
      <p>During configuration of oVirt, the <code>engine-setup</code> command prompts you to decide where your database is located:
    Where is the database located? (Local, Remote) [Local]:</p>

      <p>The steps involved in manually configuring oVirt to use local or remotely hosted databases are the same. However, to use a remotely hosted database you must provide the host name of the remote database server and the port on which it is listening.</p>
    </li>
    <li>
      <p>When prompted, enter <code>Manual</code> to manually configure the database:
    Would you like Setup to automatically configure postgresql, or prefer to perform that manually? (Automatic, Manual) [Automatic]: Manual</p>
    </li>
    <li>
      <p>If you are using a remotely hosted database, supply the <code>engine-setup</code> command with the host name of your database server and the port on which it is listening:
    Database host [localhost]:
    Database port [5432]:</p>
    </li>
    <li>
      <p>For both local and remotely hosted databases, you must select whether or not your database uses a secured connection. You must also enter the name of the database you configured, the user oVirt can use to access the database, and the password of that user.
    Database secured connection (Yes, No) [No]: 
    Database name [engine]: 
    Database user [engine]: 
    Database password:</p>

      <p><strong>Note</strong></p>

      <p>Using a secured connection to your database requires you to also have manually configured secured database connections.</p>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured oVirt to use a manually configured database. The <code>engine-setup</code> command continues with the rest of your environment configuration.</p>

  <h4 id="connecting-to-the-administration-portal"> Connecting to the Administration Portal</h4>

  <p><strong>Summary</strong></p>

  <p>Access the Administration Portal using a web browser.</p>

  <p>⁠</p>

  <p><strong>Procedure 1.5. Connecting to the Administration Portal</strong></p>

  <ol>
    <li>Open a supported web browser.</li>
    <li>
      <p>Navigate to <code>https://[your-manager-fqdn]/ovirt-engine</code>, replacing <em>[your-manager-fqdn]</em> with the fully qualified domain name that you provided during installation to open the login screen.
<strong>Important</strong></p>

      <p>The first time that you connect to the Administration Portal, you are prompted to trust the certificate being used to secure communications between your browser and the web server.</p>
    </li>
    <li>Enter your <strong>User Name</strong> and <strong>Password</strong>. If you are logging in for the first time, use the user name <code>admin</code> in conjunction with the administrator password that you specified during installation.</li>
    <li>Select the domain against which to authenticate from the <strong>Domain</strong> drop-down list. If you are logging in using the internal <code>admin</code> user name, select the <code>internal</code> domain.</li>
    <li>You can view the Administration Portal in multiple languages. The default selection will be chosen based on the locale settings of your web browser. If you would like to view the Administration Portal in a language other than the default, select your preferred language from the list.</li>
    <li>Click <strong>Login</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have logged into the Administration Portal.</p>

  <h4 id="removing-ovirt"> Removing oVirt</h4>

  <p><strong>Summary</strong></p>

  <p>You can use the <code>engine-cleanup</code> command to remove specific components or all components of oVirt. ⁠</p>

  <p><strong>Procedure 1.6. Removing oVirt</strong></p>

  <ol>
    <li>
      <p>Run the following command on the machine on which oVirt is installed:
    # engine-cleanup</p>
    </li>
    <li>You are prompted whether to remove all oVirt components:
      <ul>
        <li>
          <p>Type <code>Yes</code> and press <strong>Enter</strong> to remove all components:
    Do you want to remove all components? (Yes, No) [Yes]:</p>
        </li>
        <li>
          <p>Type <code>No</code> and press <strong>Enter</strong> to select the components to remove. You can select whether to retain or remove each component individually:
    Do you want to remove Engine database content? All data will be lost (Yes, No) [No]: 
    Do you want to remove PKI keys? (Yes, No) [No]: 
    Do you want to remove PKI configuration? (Yes, No) [No]: 
    Do you want to remove Apache SSL configuration? (Yes, No) [No]:</p>
        </li>
      </ul>
    </li>
    <li>You are given another opportunity to change your mind and cancel the removal of oVirt. If you choose to proceed, the <code>ovirt-engine</code> service is stopped, and your environment's configuration is removed in accordance with the options you selected.
    During execution engine service will be stopped (OK, Cancel) [OK]:
    ovirt-engine is about to be removed, data will be lost (OK, Cancel) [Cancel]:OK</li>
  </ol>

  <div class="alert alert-info">
    <p><strong>Note:</strong> A backup of the engine database and a compressed archive of the PKI keys and configuration are always automatically created. These files are saved under <code>/var/lib/ovirt-engine/backups/</code>, and include the date and <code>engine-</code> and <code>engine-pki-</code> in their file names, respectively.</p>

  </div>
  <p><strong>Result</strong></p>

  <p>The configuration files of your environment have been removed according to your selections when you ran <code>engine-cleanup</code>.</p>

  <p>You can now safely remove the oVirt packages using the <code>yum</code> command.</p>

<pre class="highlight plaintext"><code># yum remove rhevm* vdsm-bootstrap&#x000A;</code></pre>

  <h2 id="chapter-2-the-self-hosted-engine">⁠Chapter 2. The Self-Hosted Engine</h2>

  <h3 id="about-the-self-hosted-engine">About the Self-Hosted Engine</h3>

  <p>A self-hosted engine is a virtualized environment in which the engine, or Manager, runs on a virtual machine on the hosts managed by that engine. The virtual machine is created as part of the host configuration, and the engine is installed and configured in parallel to that host configuration process, referred to in these procedures as the deployment.</p>

  <p>The virtual machine running the engine is created to be highly available. This means that if the host running the virtual machine goes into maintenance mode, or fails unexpectedly, the virtual machine will be migrated automatically to another host in the environment.</p>

  <p>The primary benefit of the self-hosted engine is that it requires less hardware to deploy an instance of oVirt as the engine runs as a virtual machine, not on physical hardware. Additionally, the engine is configured to be highly available automatically, rather than requiring a separate cluster.</p>

  <p>The self-hosted engine currently only runs on Red Hat Enterprise Linux 6.5 hosts. oVirt Nodes and older versions of Red Hat Enterprise Linux are not recommended for use with a self-hosted engine.</p>

  <h3 id="limitations-of-the-self-hosted-engine">Limitations of the Self-Hosted Engine</h3>

  <p>At present there are two main limitations of the self-hosted engine configuration:</p>

  <ul>
    <li>An NFS storage domain is required for the configuration. NFS is the only supported file system for the self-hosted engine.</li>
    <li>The host and hosted engine must use Red Hat Enterprise Linux 6.5 or above. oVirt Nodes are not supported.</li>
  </ul>

  <h3 id="installing-the-self-hosted-engine">Installing the Self-Hosted Engine</h3>

  <p><strong>Error</strong></p>

  <p>Topic 25551 failed Injection processing and is not included in this build.</p>

  <p>Please review the compiler error for <a href="#TagErrorXRef25551">Topic ID 25551</a> for more detailed information.</p>

  <h3 id="configuring-the-self-hosted-engine">Configuring the Self-Hosted Engine</h3>

  <p><strong>Summary</strong></p>

  <p>When package installation is complete, oVirt must be configured. The <code>hosted-engine</code> deployment script is provided to assist with this task. The script asks you a series of questions, and configures your environment based on your answers. When the required values have been provided, the updated configuration is applied and oVirt services are started.</p>

  <p>The <code>hosted-engine</code> deployment script guides you through several distinct configuration stages. The script suggests possible configuration defaults in square brackets. Where these default values are acceptable, no additional input is required.</p>

  <p>This procedure requires a new Red Hat Enterprise Linux 6.5 host with the ovirt-hosted-engine-setup package installed. This host is referred to as 'Host-HE1', with a fully qualified domain name (FQDN) of <code>Host-HE1.example.com</code> in this procedure.</p>

  <p>The hosted engine, the virtual machine created during configuration of Host-HE1 to manage the environment, is referred to as 'my-engine'. You will be prompted by the <code>hosted-engine</code> deployment script to access this virtual machine multiple times to install an operating system and to configure the engine.</p>

  <p>All steps in this procedure are to be conducted as the <code>root</code> user for the specified machine.</p>

  <p>⁠</p>

  <p><strong>Procedure 2.1. Configuring the Self-Hosted Engine</strong></p>

  <ol>
    <li>
      <p><strong>Initiating Hosted Engine Deployment</strong>
Begin configuration of the self-hosted environment by deploying the <code>hosted-engine</code> customization script on Host_HE1. To escape the script at any time, use the <strong>CTRL</strong>+<strong>D</strong> keyboard combination to abort deployment.</p>

<pre class="highlight plaintext"><code># hosted-engine --deploy&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring Storage</strong>
Select the version of NFS and specify the full address, using either the FQDN or IP address, and path name of the shared storage domain. Choose the storage domain and storage data center names to be used in the environment.</p>

<pre class="highlight plaintext"><code>During customization use CTRL-D to abort.&#x000A;Please specify the storage you would like to use (nfs3, nfs4)[nfs3]: &#x000A;Please specify the full shared storage connection path to use (example: host:/path): storage.example.com:/hosted_engine/nfs&#x000A;[ INFO  ] Installing on first host&#x000A;Please provide storage domain name. [hosted_storage]: &#x000A;Local storage datacenter name is an internal name and currently will not be shown in engine's admin UI.Please enter local datacenter name [hosted_datacenter]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Network</strong>
The script detects possible network interface controllers (NICs) to use as a management bridge for the environment. It then checks your firewall configuration and offers to modify it for console (SPICE or VNC) access HostedEngine-VM. Provide a pingable gateway IP address, to be used by the <code>ovirt-ha-agent</code> to help determine a host's suitability for running HostedEngine-VM.</p>

<pre class="highlight plaintext"><code>Please indicate a nic to set rhevm bridge on: (eth1, eth0) [eth1]:&#x000A;iptables was detected on your computer, do you wish setup to configure it? (Yes, No)[Yes]: &#x000A;Please indicate a pingable gateway IP address [X.X.X.X]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Virtual Machine</strong>
The script creates a virtual machine to be configured as oVirt, the hosted engine referred to in this procedure as HostedEngine-VM. Specify the boot device and, if applicable, the path name of the installation media, the CPU type, the number of virtual CPUs, and the disk size. Specify a MAC address for the HostedEngine-VM, or accept a randomly generated one. The MAC address can be used to update your DHCP server prior to installing the operating system on the virtual machine. Specify memory size and console connection type for the creation of HostedEngine-VM.</p>

<pre class="highlight plaintext"><code>Please specify the device to boot the VM from (cdrom, disk, pxe) [cdrom]: &#x000A;The following CPU types are supported by this host:&#x000A;          - model_Penryn: Intel Penryn Family&#x000A;          - model_Conroe: Intel Conroe Family&#x000A;Please specify the CPU type to be used by the VM [model_Penryn]: &#x000A;Please specify the number of virtual CPUs for the VM [Defaults to minimum requirement: 2]: &#x000A;Please specify the disk size of the VM in GB [Defaults to minimum requirement: 25]: &#x000A;You may specify a MAC address for the VM or accept a randomly generated default [00:16:3e:77:b2:a4]: &#x000A;Please specify the memory size of the VM in MB [Defaults to minimum requirement: 4096]: &#x000A;Please specify the console type you would like to use to connect to the VM (vnc, spice) [vnc]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Hosted Engine</strong>
Specify the name for Host-HE1 to be identified in the oVirt environment, and the password for the <code>admin@internal</code> user to access the Administrator Portal. Provide the FQDN for HostedEngine-VM; this procedure uses the FQDN <em>HostedEngine-VM.example.com</em>. Finally, provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications.</p>

<pre class="highlight plaintext"><code>Enter the name which will be used to identify this host inside the Administrator Portal [hosted_engine_1]: Host-HE1&#x000A;Enter 'admin@internal' user password that will be used for accessing the Administrator Portal: &#x000A;Confirm 'admin@internal' user password: &#x000A;Please provide the FQDN for the engine you would like to use. This needs to match the FQDN that you will use for the engine installation within the VM: HostedEngine-VM.example.com&#x000A;Please provide the name of the SMTP server through which we will send notifications [localhost]: &#x000A;Please provide the TCP port number of the SMTP server [25]: &#x000A;Please provide the email address from which notifications will be sent [root@localhost]: &#x000A;Please provide a comma-separated list of email addresses which will get notifications [root@localhost]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuration Preview</strong>
Before proceeding, the <code>hosted-engine</code> script displays the configuration values you have entered, and prompts for confirmation to proceed with these values.</p>

<pre class="highlight plaintext"><code>Bridge interface                   : eth1&#x000A;Engine FQDN                        : HostedEngine-VM.example.com&#x000A;Bridge name                        : rhevm&#x000A;SSH daemon port                    : 22&#x000A;Firewall manager                   : iptables&#x000A;Gateway address                    : X.X.X.X&#x000A;Host name for web application      : Host-HE1&#x000A;Host ID                            : 1&#x000A;Image size GB                      : 25&#x000A;Storage connection                 : storage.example.com:/hosted_engine/nfs&#x000A;Console type                       : vnc&#x000A;Memory size MB                     : 4096&#x000A;MAC address                        : 00:16:3e:77:b2:a4&#x000A;Boot type                          : pxe&#x000A;Number of CPUs                     : 2&#x000A;CPU Type                           : model_Penryn&#x000A;&#x000A;Please confirm installation settings (Yes, No)[No]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Creating HostedEngine-VM</strong>
The script creates a virtual machine to be HostedEngine-VM and provides connection details. You must install an operating system on HostedEngine-VM before the <code>hosted-engine</code> script can proceed on Host-HE1.</p>

<pre class="highlight plaintext"><code>[ INFO  ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf'&#x000A;[ INFO  ] Stage: Transaction setup&#x000A;[ INFO  ] Stage: Misc configuration&#x000A;[ INFO  ] Stage: Package installation&#x000A;[ INFO  ] Stage: Misc configuration&#x000A;[ INFO  ] Configuring libvirt&#x000A;[ INFO  ] Generating VDSM certificates&#x000A;[ INFO  ] Configuring VDSM&#x000A;[ INFO  ] Starting vdsmd&#x000A;[ INFO  ] Waiting for VDSM hardware info&#x000A;[ INFO  ] Creating Storage Domain&#x000A;[ INFO  ] Creating Storage Pool&#x000A;[ INFO  ] Connecting Storage Pool&#x000A;[ INFO  ] Verifying sanlock lockspace initialization&#x000A;[ INFO  ] Initializing sanlock lockspace&#x000A;[ INFO  ] Initializing sanlock metadata&#x000A;[ INFO  ] Creating VM Image&#x000A;[ INFO  ] Disconnecting Storage Pool&#x000A;[ INFO  ] Start monitoring domain&#x000A;[ INFO  ] Configuring VM&#x000A;[ INFO  ] Updating hosted-engine configuration&#x000A;[ INFO  ] Stage: Transaction commit&#x000A;[ INFO  ] Stage: Closing up&#x000A;[ INFO  ] Creating VM&#x000A;You can now connect to the VM with the following command:&#x000A;    /usr/bin/remote-viewer vnc://localhost:5900&#x000A;Use temporary password &amp;quot;3042QHpX&amp;quot; to connect to vnc console.&#x000A;Please note that in order to use remote-viewer you need to be able to run graphical applications.&#x000A;This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding).&#x000A;Otherwise you can run the command from a terminal in your preferred desktop environment.&#x000A;If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command:&#x000A;virsh -c qemu+tls://Test/system console HostedEngine&#x000A;If you need to reboot the VM you will need to start it manually using the command:&#x000A;hosted-engine --vm-start&#x000A;You can then set a temporary password using the command:&#x000A;hosted-engine --add-console-password&#x000A;The VM has been started.  Install the OS and shut down or reboot it.  To continue please make a selection:&#x000A;&#x000A;          (1) Continue setup - VM installation is complete&#x000A;          (2) Reboot the VM and restart installation&#x000A;          (3) Abort setup&#x000A;&#x000A;          (1, 2, 3)[1]:&#x000A;</code></pre>

      <p>Using the naming convention of this procedure, connect to the virtual machine using VNC with the following command:</p>

<pre class="highlight plaintext"><code>/usr/bin/remote-viewer vnc://Host-HE1.example.com:5900&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Installing the Virtual Machine Operating System</strong>
Connect to HostedEngine-VM, the virtual machine created by the hosted-engine script, and install a Red Hat Enterprise Linux 6.5 operating system. Ensure the machine is rebooted once installation has completed.</p>
    </li>
    <li>
      <p><strong>Synchronizing the Host and the Virtual Machine</strong>
Return to Host-HE1 and continue the <code>hosted-engine</code> deployment script by selecting option 1:</p>

<pre class="highlight plaintext"><code>(1) Continue setup - VM installation is complete&#x000A;&#x000A; Waiting for VM to shut down...&#x000A;[ INFO  ] Creating VM&#x000A;You can now connect to the VM with the following command:&#x000A;    /usr/bin/remote-viewer vnc://localhost:5900&#x000A;Use temporary password &amp;quot;3042QHpX&amp;quot; to connect to vnc console.&#x000A;Please note that in order to use remote-viewer you need to be able to run graphical applications.&#x000A;This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding).&#x000A;Otherwise you can run the command from a terminal in your preferred desktop environment.&#x000A;If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command:&#x000A;virsh -c qemu+tls://Test/system console HostedEngine&#x000A;If you need to reboot the VM you will need to start it manually using the command:&#x000A;hosted-engine --vm-start&#x000A;You can then set a temporary password using the command:&#x000A;hosted-engine --add-console-password&#x000A;Please install and setup the engine in the VM.&#x000A;You may also be interested in subscribing to &amp;quot;agent&amp;quot; RHN/Satellite channel and installing rhevm-guest-agent-common package in the VM.&#x000A;To continue make a selection from the options below:&#x000A;          (1) Continue setup - engine installation is complete&#x000A;          (2) Power off and restart the VM&#x000A;          (3) Abort setup&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Installing oVirt</strong>
Connect to HostedEngine-VM, subscribe to the appropriate oVirt channels, ensure that the most up-to-date versions of all installed packages are in use, and install the rhevm packages.</p>

<pre class="highlight plaintext"><code># yum upgrade&#x000A;&#x000A;# yum install rhevm&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring oVirt</strong>
Configure the engine on HostedEngine-VM:</p>

<pre class="highlight plaintext"><code># engine-setup&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Synchronizing the Host and oVirt</strong>
Return to Host-HE1 and continue the <code>hosted-engine</code> deployment script by selecting option 1:</p>

<pre class="highlight plaintext"><code>(1) Continue setup - engine installation is complete&#x000A;&#x000A;[ INFO  ] Engine replied: DB Up!Welcome to Health Status!&#x000A;[ INFO  ] Waiting for the host to become operational in the engine. This may take several minutes...&#x000A;[ INFO  ] Still waiting for VDSM host to become operational...&#x000A;[ INFO  ] The VDSM Host is now operational&#x000A;          Please shutdown the VM allowing the system to launch it as a monitored service.&#x000A;          The system will wait until the VM is down.&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Shutting Down HostedEngine-VM</strong>
Shutdown HostedEngine-VM.</p>

<pre class="highlight plaintext"><code># shutdown now&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Setup Confirmation</strong>
Return to Host-HE1 to confirm it has detected that HostedEngine-VM is down.</p>

<pre class="highlight plaintext"><code>[ INFO  ] Enabling and starting HA services&#x000A;          Hosted Engine successfully set up&#x000A;[ INFO  ] Stage: Clean up&#x000A;[ INFO  ] Stage: Pre-termination&#x000A;[ INFO  ] Stage: Termination&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>When the <code>hosted-engine</code> deployment script completes successfully, oVirt is configured and running on your server. In contrast to a bare-metal Manager installation, the hosted engine Manager has already configured the data center, cluster, host (Host-HE1), storage domain, and virtual machine of the hosted engine (HostedEngine-VM). You can log in as the <strong>admin@internal</strong> user to continue configuring oVirt and add further resources.</p>

  <p>Link your oVirt to a directory server so you can add additional users to the environment. oVirt supports directory services from Red Hat Directory Services (RHDS), IdM, and Active Directory. Add a directory server to your environment using the <code>engine-manage-domains</code> command.</p>

  <p>The <code>ovirt-host-engine-setup</code> script also saves the answers you gave during configuration to a file, to help with disaster recovery. If a destination is not specified using the <code>--generate-answer=&amp;lt;file&amp;gt;</code> argument, the answer file is generated at <code>/etc/ovirt-hosted-engine/answers.conf</code>.</p>

  <h3 id="migrating-to-a-self-hosted-environment">Migrating to a Self-Hosted Environment</h3>

  <p><strong>Summary</strong></p>

  <p>Deploy a hosted-engine environment and migrate an existing instance of oVirt. The <code>hosted-engine</code> deployment script is provided to assist with this task. The script asks you a series of questions, and configures your environment based on your answers. When the required values have been provided, the updated configuration is applied and oVirt services are started.</p>

  <p>The <code>hosted-engine</code> deployment script guides you through several distinct configuration stages. The script suggests possible configuration defaults in square brackets. Where these default values are acceptable, no additional input is required.</p>

  <p>This procedure requires a new Red Hat Enterprise Linux 6.5 host with the ovirt-hosted-engine-setup package installed. This host is referred to as 'Host-HE1', with a fully qualified domain name (FQDN) of <code>Host-HE1.example.com</code> in this procedure.</p>

  <p>Your original oVirt is referred to as 'BareMetal-Manager', with an FQDN of <code>Manager.example.com</code>, in this procedure. You are required to access and make changes on BareMetal-Manager during this procedure.</p>

  <p>The hosted engine, the virtual machine created during configuration of Host-HE1 and used to manage the environment, is referred to as 'HostedEngine-VM' in this procedure. The <code>hosted-engine</code> deployment script prompts you to access this virtual machine multiple times to install an operating system and to configure the engine.</p>

  <p>All steps in this procedure are to be conducted as the <code>root</code> user for the specified machine.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> The engine running on BareMetal-Manager must be the same version as will be installed on HostedEngine-VM. As the hosted engine feature is only available on oVirt version 3.3.0 and later, any previous version of oVirt running on BareMetal-Manager must be upgraded. Upgrade the engine version on BareMetal-Manager before creating the backup with the <code>engine-backup</code> command.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 2.2. Migrating to a Self-Hosted Environment</strong></p>

  <ol>
    <li>
      <p><strong>Initiating Hosted Engine Deployment</strong>
Begin configuration of the self-hosted environment by deploying the <code>hosted-engine</code> customization script on Host_HE1. To escape the script at any time, use the <strong>CTRL</strong>+<strong>D</strong> keyboard combination to abort deployment.</p>

<pre class="highlight plaintext"><code># hosted-engine --deploy&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring Storage</strong>
Select the version of NFS and specify the full address, using either the FQDN or IP address, and path name of the shared storage domain. Choose the storage domain and storage data center names to be used in the environment.</p>

<pre class="highlight plaintext"><code>During customization use CTRL-D to abort.&#x000A;Please specify the storage you would like to use (nfs3, nfs4)[nfs3]: &#x000A;Please specify the full shared storage connection path to use (example: host:/path): storage.example.com:/hosted_engine/nfs&#x000A;[ INFO  ] Installing on first host&#x000A;Please provide storage domain name. [hosted_storage]: &#x000A;Local storage datacenter name is an internal name and currently will not be shown in engine's admin UI.Please enter local datacenter name [hosted_datacenter]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Network</strong>
The script detects possible network interface controllers (NICs) to use as a management bridge for the environment. It then checks your firewall configuration and offers to modify it for console (SPICE or VNC) access HostedEngine-VM. Provide a pingable gateway IP address, to be used by the <code>ovirt-ha-agent</code> to help determine a host's suitability for running HostedEngine-VM.</p>

<pre class="highlight plaintext"><code>Please indicate a nic to set rhevm bridge on: (eth1, eth0) [eth1]:&#x000A;iptables was detected on your computer, do you wish setup to configure it? (Yes, No)[Yes]: &#x000A;Please indicate a pingable gateway IP address [X.X.X.X]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Virtual Machine</strong>
The script creates a virtual machine to be configured as oVirt, the hosted engine referred to in this procedure as HostedEngine-VM. Specify the boot device and, if applicable, the path name of the installation media, the CPU type, the number of virtual CPUs, and the disk size. Specify a MAC address for the HostedEngine-VM, or accept a randomly generated one. The MAC address can be used to update your DHCP server prior to installing the operating system on the virtual machine. Specify memory size and console connection type for the creation of HostedEngine-VM.</p>

<pre class="highlight plaintext"><code>Please specify the device to boot the VM from (cdrom, disk, pxe) [cdrom]: &#x000A;The following CPU types are supported by this host:&#x000A;          - model_Penryn: Intel Penryn Family&#x000A;          - model_Conroe: Intel Conroe Family&#x000A;Please specify the CPU type to be used by the VM [model_Penryn]: &#x000A;Please specify the number of virtual CPUs for the VM [Defaults to minimum requirement: 2]: &#x000A;Please specify the disk size of the VM in GB [Defaults to minimum requirement: 25]: &#x000A;You may specify a MAC address for the VM or accept a randomly generated default [00:16:3e:77:b2:a4]: &#x000A;Please specify the memory size of the VM in MB [Defaults to minimum requirement: 4096]: &#x000A;Please specify the console type you want to use to connect to the VM (vnc, spice) [vnc]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Hosted Engine</strong>
Specify the name for Host-HE1 to be identified in the oVirt environment, and the password for the <code>admin@internal</code> user to access the Administrator Portal. Provide the FQDN for HostedEngine-VM; this procedure uses the FQDN <em>Manager.example.com</em>. Finally, provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications.</p>

      <p><strong>Important</strong></p>

      <p>The FQDN provided for the engine (<em>Manager.example.com</em>) must be the same FQDN provided when BareMetal-Manager was initially set up.</p>

<pre class="highlight plaintext"><code>Enter the name which will be used to identify this host inside the Administrator Portal [hosted_engine_1]: Host-HE1&#x000A;Enter 'admin@internal' user password that will be used for accessing the Administrator Portal: &#x000A;Confirm 'admin@internal' user password: &#x000A;Please provide the FQDN for the engine you want to use. This needs to match the FQDN that you will use for the engine installation within the VM: Manager.example.com&#x000A;Please provide the name of the SMTP server through which we will send notifications [localhost]: &#x000A;Please provide the TCP port number of the SMTP server [25]: &#x000A;Please provide the email address from which notifications will be sent [root@localhost]: &#x000A;Please provide a comma-separated list of email addresses which will get notifications [root@localhost]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuration Preview</strong>
Before proceeding, the <code>hosted-engine</code> script displays the configuration values you have entered, and prompts for confirmation to proceed with these values.</p>

<pre class="highlight plaintext"><code>Bridge interface                   : eth1&#x000A;Engine FQDN                        : Manager.example.com&#x000A;Bridge name                        : rhevm&#x000A;SSH daemon port                    : 22&#x000A;Firewall manager                   : iptables&#x000A;Gateway address                    : X.X.X.X&#x000A;Host name for web application      : Host-HE1&#x000A;Host ID                            : 1&#x000A;Image size GB                      : 25&#x000A;Storage connection                 : storage.example.com:/hosted_engine/nfs&#x000A;Console type                       : vnc&#x000A;Memory size MB                     : 4096&#x000A;MAC address                        : 00:16:3e:77:b2:a4&#x000A;Boot type                          : pxe&#x000A;Number of CPUs                     : 2&#x000A;CPU Type                           : model_Penryn&#x000A;&#x000A;Please confirm installation settings (Yes, No)[No]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Creating HostedEngine-VM</strong>
The script creates the virtual machine to be configured as HostedEngine-VM and provides connection details. You must install an operating system on HostedEngine-VM before the <code>hosted-engine</code> script can proceed on Host-HE1.</p>

<pre class="highlight plaintext"><code>[ INFO  ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf'&#x000A;[ INFO  ] Stage: Transaction setup&#x000A;[ INFO  ] Stage: Misc configuration&#x000A;[ INFO  ] Stage: Package installation&#x000A;[ INFO  ] Stage: Misc configuration&#x000A;[ INFO  ] Configuring libvirt&#x000A;[ INFO  ] Generating VDSM certificates&#x000A;[ INFO  ] Configuring VDSM&#x000A;[ INFO  ] Starting vdsmd&#x000A;[ INFO  ] Waiting for VDSM hardware info&#x000A;[ INFO  ] Creating Storage Domain&#x000A;[ INFO  ] Creating Storage Pool&#x000A;[ INFO  ] Connecting Storage Pool&#x000A;[ INFO  ] Verifying sanlock lockspace initialization&#x000A;[ INFO  ] Initializing sanlock lockspace&#x000A;[ INFO  ] Initializing sanlock metadata&#x000A;[ INFO  ] Creating VM Image&#x000A;[ INFO  ] Disconnecting Storage Pool&#x000A;[ INFO  ] Start monitoring domain&#x000A;[ INFO  ] Configuring VM&#x000A;[ INFO  ] Updating hosted-engine configuration&#x000A;[ INFO  ] Stage: Transaction commit&#x000A;[ INFO  ] Stage: Closing up&#x000A;[ INFO  ] Creating VM&#x000A;You can now connect to the VM with the following command:&#x000A;    /usr/bin/remote-viewer vnc://localhost:5900&#x000A;Use temporary password &amp;quot;5379skAb&amp;quot; to connect to vnc console.&#x000A;Please note that in order to use remote-viewer you need to be able to run graphical applications.&#x000A;This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding).&#x000A;Otherwise you can run the command from a terminal in your preferred desktop environment.&#x000A;If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command:&#x000A;virsh -c qemu+tls://Test/system console HostedEngine&#x000A;If you need to reboot the VM you will need to start it manually using the command:&#x000A;hosted-engine --vm-start&#x000A;You can then set a temporary password using the command:&#x000A;hosted-engine --add-console-password&#x000A;The VM has been started.  Install the OS and shut down or reboot it.  To continue please make a selection:&#x000A;&#x000A;          (1) Continue setup - VM installation is complete&#x000A;          (2) Reboot the VM and restart installation&#x000A;          (3) Abort setup&#x000A;&#x000A;          (1, 2, 3)[1]:&#x000A;</code></pre>

      <p>Using the naming convention of this procedure, connect to the virtual machine using VNC with the following command:</p>

<pre class="highlight plaintext"><code>/usr/bin/remote-viewer vnc://Host-HE1.example.com:5900&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Installing the Virtual Machine Operating System</strong>
Connect to HostedEngine-VM, the virtual machine created by the hosted-engine script, and install a Red Hat Enterprise Linux 6.5 operating system.</p>
    </li>
    <li>
      <p><strong>Synchronizing the Host and the Virtual Machine</strong>
Return to Host-HE1 and continue the <code>hosted-engine</code> deployment script by selecting option 1:</p>

<pre class="highlight plaintext"><code>(1) Continue setup - VM installation is complete&#x000A;&#x000A; Waiting for VM to shut down...&#x000A;[ INFO  ] Creating VM&#x000A;You can now connect to the VM with the following command:&#x000A;    /usr/bin/remote-viewer vnc://localhost:5900&#x000A;Use temporary password &amp;quot;5379skAb&amp;quot; to connect to vnc console.&#x000A;Please note that in order to use remote-viewer you need to be able to run graphical applications.&#x000A;This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding).&#x000A;Otherwise you can run the command from a terminal in your preferred desktop environment.&#x000A;If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command:&#x000A;virsh -c qemu+tls://Test/system console HostedEngine&#x000A;If you need to reboot the VM you will need to start it manually using the command:&#x000A;hosted-engine --vm-start&#x000A;You can then set a temporary password using the command:&#x000A;hosted-engine --add-console-password&#x000A;Please install and setup the engine in the VM.&#x000A;You may also be interested in subscribing to &amp;quot;agent&amp;quot; RHN/Satellite channel and installing rhevm-guest-agent-common package in the VM.&#x000A;To continue make a selection from the options below:&#x000A;          (1) Continue setup - engine installation is complete&#x000A;          (2) Power off and restart the VM&#x000A;          (3) Abort setup&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Installing oVirt</strong>
Connect to HostedEngine-VM, subscribe to the appropriate oVirt channels, ensure that the most up-to-date versions of all installed packages are in use, and install the rhevm packages.</p>

<pre class="highlight plaintext"><code># yum upgrade&#x000A;&#x000A;# yum install rhevm&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Disabling BareMetal-Manager</strong>
Connect to BareMetal-Manager, the Manager of your established oVirt environment, and stop the engine and prevent it from running.</p>

<pre class="highlight plaintext"><code># service ovirt-engine stop&#x000A;# service ovirt-engine disable&#x000A;# chkconfig ovirt-engine off&#x000A;</code></pre>

      <p><strong>Note</strong></p>

      <p>Though stopping BareMetal-Manager from running is not obligatory, it is recommended as it ensures no changes will be made to the environment after the backup has been created. Additionally, it prevents BareMetal-Manager and HostedEngine-VM from simultaneously managing existing resources.</p>
    </li>
    <li>
      <p><strong>Updating DNS</strong>
Update your DNS so that the FQDN of the oVirt environment correlates to the IP address of HostedEngine-VM and the FQDN previously provided when configuring the <code>hosted-engine</code> deployment script on Host-HE1. In this procedure, FQDN was set as <em>Manager.example.com</em> because in a migrated hosted-engine setup, the FQDN provided for the engine must be identical to that given in the engine setup of the original engine.</p>
    </li>
    <li>
      <p><strong>Creating a Backup of BareMetal-Manager</strong>
Connect to BareMetal-Manager and run the <code>engine-backup</code> command with the <em><code>--mode=backup</code></em>, <em><code>--file=[FILE]</code></em>, and <em><code>--log=[LogFILE]</code></em> parameters to specify the backup mode, the name of the backup file created and used for the backup, and the name of the log file to be created to store the backup log.</p>

<pre class="highlight plaintext"><code># engine-backup --mode=backup --file=[FILE] --log=[LogFILE]&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Copying the Backup File to HostedEngine-VM</strong>
On BareMetal-Manager, secure copy the backup file to HostedEngine-VM. In the following example, <em>[Manager.example.com]</em> is the FQDN for HostedEngine-VM, and <em>/backup/</em> is any designated folder or path. If the designated folder or path does not exist, you must connect to HostedEngine-VM and create it before secure copying the backup from BareMetal-Manager.</p>

<pre class="highlight plaintext"><code># scp -p backup1 [Manager.example.com:/backup/]&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Restoring the Backup File on HostedEngine-VM</strong>
The <code>engine-backup --mode=restore</code> command does not create a database; you are required to create one on HostedEngine-VM before restoring the backup you created on BareMetal-Manager. Connect to HostedEngine-VM and create the database, as detailed in <a href="#Preparing_a_Postgres_Database_Server_for_use_with_Red_Hat_Enterprise_Virtualization_Manager">Section 1.3.4, “Preparing a PostgreSQL Database for Use with oVirt”</a>.</p>

      <p><strong>Note</strong></p>

      <p>The procedure in <a href="#Preparing_a_Postgres_Database_Server_for_use_with_Red_Hat_Enterprise_Virtualization_Manager">Section 1.3.4, “Preparing a PostgreSQL Database for Use with oVirt”</a> creates a database that is not empty, which will result in the following error when you attempt to restore the backup:</p>

<pre class="highlight plaintext"><code>FATAL: Database is not empty&#x000A;</code></pre>

      <p>Create an empty database using the following command in psql:</p>

<pre class="highlight plaintext"><code>postgres=# create database [database name] owner [user name]&#x000A;</code></pre>

      <p>After the empty database has been created, restore the BareMetal-Manager backup using the <code>engine-backup</code> command with the <em><code>--mode=restore</code></em> <em><code>--file=[FILE]</code></em> <em><code>--log=[Restore.log]</code></em> parameters to specify the restore mode, the name of the file to be used to restore the database, and the name of the logfile to store the restore log. This restores the files and the database but does not start the service.</p>

      <p>To specify a different database configuration, use the <em><code>--change-db-credentials</code></em> parameter to activate alternate credentials. Use the <code>engine-backup --help</code> command on oVirt for a list of credential parameters.</p>

<pre class="highlight plaintext"><code># engine-backup --mode=restore --file=[FILE] --log=[Restore.log] --change-db-credentials --db-host=[X.X.X.X] --db-user=[engine] --db-password=[password] --db-name=[engine]&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring HostedEngine-VM</strong>
Configure the engine on HostedEngine-VM. This identifies the existing files and database.</p>

<pre class="highlight plaintext"><code># engine-setup&#x000A;&#x000A;[ INFO  ] Stage: Initializing&#x000A;[ INFO  ] Stage: Environment setup&#x000A;Configuration files: ['/etc/ovirt-engine-setup.conf.d/10-packaging.conf', '/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf']&#x000A;Log file: /var/log/ovirt-engine/setup/ovirt-engine-setup-20140304075238.log&#x000A;Version: otopi-1.1.2 (otopi-1.1.2-1.el6ev)&#x000A;[ INFO  ] Stage: Environment packages setup&#x000A;[ INFO  ] Yum Downloading: rhel-65-zstream/primary_db 2.8 M(70%)&#x000A;[ INFO  ] Stage: Programs detection&#x000A;[ INFO  ] Stage: Environment setup&#x000A;[ INFO  ] Stage: Environment customization&#x000A;&#x000A;          --== PACKAGES ==--&#x000A;&#x000A;[ INFO  ] Checking for product updates...&#x000A;[ INFO  ] No product updates found&#x000A;&#x000A;          --== NETWORK CONFIGURATION ==--&#x000A;&#x000A;Setup can automatically configure the firewall on this system.&#x000A;Note: automatic configuration of the firewall may overwrite current settings.&#x000A;Do you want Setup to configure the firewall? (Yes, No) [Yes]: &#x000A;[ INFO  ] iptables will be configured as firewall manager.&#x000A;&#x000A;          --== DATABASE CONFIGURATION ==--&#x000A;&#x000A;          --== OVIRT ENGINE CONFIGURATION ==--&#x000A;&#x000A;          Skipping storing options as database already prepared&#x000A;&#x000A;          --== PKI CONFIGURATION ==--&#x000A;&#x000A;          PKI is already configured&#x000A;&#x000A;          --== APACHE CONFIGURATION ==--&#x000A;&#x000A;          --== SYSTEM CONFIGURATION ==--&#x000A;&#x000A;          --== END OF CONFIGURATION ==--&#x000A;&#x000A;[ INFO  ] Stage: Setup validation&#x000A;[WARNING] Less than 16384MB of memory is available&#x000A;[ INFO  ] Cleaning stale zombie tasks&#x000A;&#x000A;          --== CONFIGURATION PREVIEW ==--&#x000A;&#x000A;          Database name                      : engine&#x000A;          Database secured connection        : False&#x000A;          Database host                      : X.X.X.X&#x000A;          Database user name                 : engine&#x000A;          Database host name validation      : False&#x000A;          Database port                      : 5432&#x000A;          NFS setup                          : True&#x000A;          Firewall manager                   : iptables&#x000A;          Update Firewall                    : True&#x000A;          Configure WebSocket Proxy          : True&#x000A;          Host FQDN                          : Manager.example.com&#x000A;          NFS mount point                    : /var/lib/exports/iso&#x000A;          Set application as default page    : True&#x000A;          Configure Apache SSL               : True&#x000A;&#x000A;          Please confirm installation settings (OK, Cancel) [OK]: &#x000A;</code></pre>

      <p>Confirm the settings. Upon completion, the setup provides an SSH fingerprint and an internal Certificate Authority hash.</p>
    </li>
    <li>
      <p><strong>Synchronizing the Host and oVirt</strong>
Return to Host-HE1 and continue the <code>hosted-engine</code> deployment script by selecting option 1:</p>

<pre class="highlight plaintext"><code>(1) Continue setup - engine installation is complete&#x000A;&#x000A;[ INFO  ] Engine replied: DB Up!Welcome to Health Status!&#x000A;[ INFO  ] Waiting for the host to become operational in the engine. This may take several minutes...&#x000A;[ INFO  ] Still waiting for VDSM host to become operational...&#x000A;[ INFO  ] The VDSM Host is now operational&#x000A;          Please shutdown the VM allowing the system to launch it as a monitored service.&#x000A;          The system will wait until the VM is down.&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Shutting Down HostedEngine-VM</strong>
Shutdown HostedEngine-VM.</p>

<pre class="highlight plaintext"><code># shutdown now&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Setup Confirmation</strong>
Return to Host-HE1 to confirm it has detected that HostedEngine-VM is down.</p>

<pre class="highlight plaintext"><code>[ INFO  ] Enabling and starting HA services&#x000A;          Hosted Engine successfully set up&#x000A;[ INFO  ] Stage: Clean up&#x000A;[ INFO  ] Stage: Pre-termination&#x000A;[ INFO  ] Stage: Termination&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>Your oVirt engine has been migrated to a hosted-engine setup. oVirt is now operating on a virtual machine on Host-HE1, called HostedEngine-VM in the environment. As HostedEngine-VM is highly available, it is migrated to other hosts in the environment when applicable.</p>

  <h3 id="installing-additional-hosts-to-a-self-hosted-environment">Installing Additional Hosts to a Self-Hosted Environment</h3>

  <p><strong>Summary</strong></p>

  <p>Adding additional nodes to a self-hosted environment is very similar to deploying the original host, though heavily truncated as the script detects the environment.</p>

  <p>As with the original host, additional hosts require Red Hat Enterprise Linux 6.5 with subscriptions to the appropriate oVirt channels.</p>

  <p>All steps in this procedure are to be conducted as the <code>root</code> user.</p>

  <p>⁠</p>

  <p><strong>Procedure 2.3. Adding the host</strong></p>

  <ol>
    <li>
      <p>Install the ovirt-hosted-engine-setup package.
    # yum install ovirt-hosted-engine-setup</p>
    </li>
    <li>
      <p>Configure the host with the deployment command.
    # hosted-engine –deploy</p>
    </li>
    <li>
      <p><strong>Configuring Storage</strong>
Specify the storage type and the full address, using either the Fully Qualified Domain Name (FQDN) or IP address, and path name of the shared storage domain used in the self-hosted environment.</p>

<pre class="highlight plaintext"><code>Please specify the storage you would like to use (nfs3, nfs4)[nfs3]:&#x000A;Please specify the full shared storage connection path to use (example: host:/path): storage.example.com:/hosted_engine/nfs&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Detecting the Self-Hosted Engine</strong>
The <code>hosted-engine</code> script detects that the shared storage is being used and asks if this is an additional host setup. You are then prompted for the host ID, which must be an integer not already assigned to an additional host in the environment.</p>

<pre class="highlight plaintext"><code>The specified storage location already contains a data domain. Is this an additional host setup (Yes, No)[Yes]? &#x000A;[ INFO  ] Installing on additional host&#x000A;Please specify the Host ID [Must be integer, default: 2]: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the System</strong>
The <code>hosted-engine</code> script uses the answer file generated by the original hosted-engine setup. To achieve this, the script requires the FQDN or IP address and the password of the <code>root</code> user of that host so as to access and secure-copy the answer file to the additional host.</p>

<pre class="highlight plaintext"><code>[WARNING] A configuration file must be supplied to deploy Hosted Engine on an additional host.&#x000A;The answer file may be fetched from the first host using scp.&#x000A;If you do not want to download it automatically you can abort the setup answering no to the following question.&#x000A;Do you want to scp the answer file from the first host? (Yes, No)[Yes]:       &#x000A;Please provide the FQDN or IP of the first host:           &#x000A;Enter 'root' user password for host Host-HE1.example.com: &#x000A;[ INFO  ] Answer file successfully downloaded&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuring the Hosted Engine</strong>
Specify the name for the additional host to be identified in the oVirt environment, and the password for the <code>admin@internal</code> user.</p>

<pre class="highlight plaintext"><code>Enter the name which will be used to identify this host inside the Administrator Portal [hosted_engine_2]:           &#x000A;Enter 'admin@internal' user password that will be used for accessing the Administrator Portal: &#x000A;Confirm 'admin@internal' user password: &#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configuration Preview</strong>
Before proceeding, the <code>hosted-engine</code> script displays the configuration values you have entered, and prompts for confirmation to proceed with these values.</p>

<pre class="highlight plaintext"><code>Bridge interface                   : eth1&#x000A;Engine FQDN                        : HostedEngine-VM.example.com&#x000A;Bridge name                        : rhevm&#x000A;SSH daemon port                    : 22&#x000A;Firewall manager                   : iptables&#x000A;Gateway address                    : X.X.X.X&#x000A;Host name for web application      : hosted_engine_2&#x000A;Host ID                            : 2&#x000A;Image size GB                      : 25&#x000A;Storage connection                 : storage.example.com:/hosted_engine/nfs&#x000A;Console type                       : vnc&#x000A;Memory size MB                     : 4096&#x000A;MAC address                        : 00:16:3e:05:95:50&#x000A;Boot type                          : disk&#x000A;Number of CPUs                     : 2&#x000A;CPU Type                           : model_Penryn&#x000A;&#x000A;Please confirm installation settings (Yes, No)[No]: &#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>After confirmation, the script completes installation of the host and adds it to the environment.</p>

  <h3 id="maintaining-the-self-hosted-engine">Maintaining the Self-Hosted Engine</h3>

  <p>Setting the engine to global maintenance enables you to start, stop, and modify the engine without interference from the high-availability agents. This must be applied to the engine for any setup or upgrade operations that require the engine to be stopped, for instance the installation of the rhevm-dwh and rhevm-reports packages necessary for the <strong>Reports Portal</strong>.</p>

<pre class="highlight plaintext"><code># hosted-engine --set-maintenance --mode=global&#x000A;</code></pre>

  <p>To resume the high-availability function of the engine, turn off global maintenance:</p>

<pre class="highlight plaintext"><code># hosted-engine --set-maintenance --mode=none&#x000A;</code></pre>

  <p>Both of these commands are to be conducted as the <code>root</code> user.</p>

  <h3 id="upgrading-the-self-hosted-engine">Upgrading the Self-Hosted Engine</h3>

  <p><strong>Error</strong></p>

  <p>Topic 30615 failed Injection processing and is not included in this build.</p>

  <p>Please review the compiler error for <a href="#TagErrorXRef30615">Topic ID 30615</a> for more detailed information.</p>

  <h3 id="upgrading-additional-hosts-in-a-self-hosted-environment">Upgrading Additional Hosts in a Self-Hosted Environment</h3>

  <p><strong>Summary</strong></p>

  <p>It is recommended that all hosts in your self-hosted environment are upgraded at the same time. This prevents version 3.3 hosts from going into a <strong>Non Operational</strong> state. If this is not practical in your environment, follow this procedure to upgrade any additional hosts.</p>

  <p>Ensure the host is not hosting oVirt virtual machine before beginning the procedure.</p>

  <p>All commands in this procedure are as the <code>root</code> user.</p>

  <p>⁠</p>

  <p><strong>Procedure 2.4. Upgrading Additional Hosts</strong></p>

  <ol>
    <li>
      <p>Log into the host and set the maintenance mode to <code>local</code>.
    # hosted-engine –set-maintenance –mode=local</p>
    </li>
    <li>Access oVirt Administration Portal. Select the host and put it into maintenance mode by clicking the <strong>Maintenance</strong> button.</li>
    <li>
      <p>Log into and update the host.
    # yum update</p>
    </li>
    <li>
      <p>Restart VDSM on the host.
    # service vdsmd restart</p>
    </li>
    <li>
      <p>Restart <code>ovirt-ha-broker</code> and <code>ovirt-ha-agent</code> on the host.
    # service ovirt-ha-broker restart</p>

<pre class="highlight plaintext"><code># service ovirt-ha-agent restart&#x000A;</code></pre>
    </li>
    <li>
      <p>Turn off the hosted-engine maintenance mode on the host.
    # hosted-engine –set-maintenance –mode=none</p>
    </li>
    <li>Access oVirt Administration Portal. Select the host and activate it by clicking the <strong>Activate</strong> button.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have updated an additional host in your self-hosted environment to oVirt 3.4.</p>

  <h2 id="chapter-3-history-and-reports">⁠Chapter 3. History and Reports</h2>

  <h3 id="workflow-progress---data-collection-setup-and-reports-installation">Workflow Progress - Data Collection Setup and Reports Installation</h3>

  <p><img alt="" title="images/1192.png" src="/images/images/1192.png" /></p>

  <h3 id="data-collection-setup-and-reports-installation-overview">Data Collection Setup and Reports Installation Overview</h3>

  <p>oVirt optionally includes a comprehensive management history database, which can be utilized by any application to extract a range of information at the data center, cluster, and host levels. As the database structure changes over time a number of database views are also included to provide a consistent structure to consuming applications. A view is a virtual table composed of the result set of a database query. The definition of a view is stored in the database as a <code>SELECT</code> statement. The result set of the <code>SELECT</code> statement populates the virtual table returned by the view. If the optional comprehensive management history database has been enabled, the history tables and their associated views are stored in the <code>ovirt_engine_history</code> database.</p>

  <p>In addition to the history database oVirt Reports functionality is also available as an optional component. oVirt Reports provides a customized implementation of JasperServer and JasperReports. JasperServer is a component of JasperReports, an open source reporting tool capable of being embedded in Java-based applications. It produces reports which can be rendered to screen, printed, or exported to a variety of formats including PDF, Excel, CSV, Word, RTF, Flash, ODT and ODS. Reports built in oVirt Reports are accessed via a web interface. In addition to a range of pre-configured reports and dashboards for monitoring the system, you are also able to create your own ad hoc reports.</p>

  <p>Before proceeding with Red Hat Virtualization Manager Reports installation you must first have installed oVirt.</p>

  <p>oVirt Reports functionality depends on the presence of the history database, which is installed separately. Both the history database and oVirt Reports are optional components. They are not installed by default when you install oVirt.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> Detailed user, administration, and installation guides for JasperReports can be found in <code>/usr/share/jasperreports-server-pro/docs/</code></p>

  </div>
  <p>### Installing and Configuring the History Database and oVirt Reports</p>

  <p><strong>Summary</strong></p>

  <p>Use of the history database and reports is optional. To use the reporting capabilities of oVirt, you must install and configure rhevm-dwh and rhevm-reports.</p>

  <p>⁠</p>

  <p><strong>Procedure 3.1. Installing and Configuring the History Database and oVirt Reports</strong></p>

  <ol>
    <li>
      <p>Install the rhevm-dwh package. This package must be installed on the system on which oVirt is installed.
    # yum install rhevm-dwh</p>
    </li>
    <li>
      <p>Install the rhevm-reports package. This package must be installed on the system on which oVirt is installed.
    # yum install rhevm-reports</p>
    </li>
    <li>
      <p>Run the <code>engine-setup</code> command on the system hosting oVirt and follow the prompts to install Data Warehouse and Reports:
    –== PRODUCT OPTIONS ==–</p>

<pre class="highlight plaintext"><code>Install Data Warehouse on this host (Yes, No) [Yes]: &#x000A;Install Reports on this host (Yes, No) [Yes]:&#x000A;</code></pre>
    </li>
    <li>
      <p>The command will prompt you to answer the following questions about the DWH database:
    –== DATABASE CONFIGURATION ==–</p>

<pre class="highlight plaintext"><code>Where is the DWH database located? (Local, Remote) [Local]: &#x000A;Setup can configure the local postgresql server automatically for the DWH to run. This may conflict with existing applications.&#x000A;Would you like Setup to automatically configure postgresql and create DWH database, or prefer to perform that manually? (Automatic, Manual) [Automatic]: &#x000A;Where is the Reports database located? (Local, Remote) [Local]: &#x000A;Setup can configure the local postgresql server automatically for the Reports to run. This may conflict with existing applications.&#x000A;Would you like Setup to automatically configure postgresql and create Reports database, or prefer to perform that manually? (Automatic, Manual) [Automatic]:&#x000A;</code></pre>

      <p>Press <strong>Enter</strong> to choose the highlighted defaults, or type your alternative preference and then press <strong>Enter</strong>.</p>
    </li>
    <li>
      <p>The command will then prompt you to set the password for oVirt Reports administrative users (<code>admin</code> and <code>superuser</code>). Note that the reports system maintains its own set of credentials which are separate to those used for oVirt.
    Reports power users password:</p>

      <p>You will be prompted to enter the password a second time to confirm it.</p>
    </li>
    <li>
      <p>For oVirt Reports installation to take effect, the <code>ovirt-engine</code> service must be restarted. The <code>engine-setup</code> command prompts you:
    During execution engine service will be stopped (OK, Cancel) [OK]:</p>

      <p>Type <strong>OK</strong> and then press <strong>Enter</strong> to proceed. The <code>ovirt-engine</code> service will restart automatically later in the command.</p>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The <code>ovirt_engine_history</code> database has been created. oVirt is configured to log information to this database for reporting purposes. oVirt Reports has been installed successfully. Access oVirt Reports at <code>http://[demo.redhat.com]/ovirt-engine-reports</code>, replacing <code>[demo.redhat.com]</code> with the fully-qualified domain name of oVirt. If during oVirt installation you selected a non-default HTTP port then append <code>:</code><em>[port]</em> to the URL, replacing <em>[port]</em> with the port that you chose.</p>

  <p>Use the user name <code>admin</code> and the password you set during reports installation to log in for the first time. Note that the first time you log into oVirt Reports, a number of web pages are generated, and as a result your initial attempt to login may take some time to complete.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> Previously, the <code>admin</code> user name was <code>rhevm-admin</code>. If you are performing a clean installation, the user name is now <code>admin</code>. In you are performing an upgrade, the user name will remain <code>rhevm-admin</code>.</p>

  </div>
  <p>## ⁠Chapter 4. Introduction to Hosts</p>

  <h3 id="workflow-progress---installing-virtualization-hosts">Workflow Progress - Installing Virtualization Hosts</h3>

  <p><img alt="" title="images/1193.png" src="/images/images/1193.png" /></p>

  <h3 id="introduction-to-virtualization-hosts">Introduction to Virtualization Hosts</h3>

  <p>oVirt supports both virtualization hosts which run the oVirt Node, and those which run Red Hat Enterprise Linux. Both types of virtualization host are able to coexist in the same oVirt environment.</p>

  <p>Prior to installing virtualization hosts you should ensure that:</p>

  <ul>
    <li>all virtualization hosts meet the hardware requirements, and</li>
    <li>you have successfully completed installation of oVirt.</li>
  </ul>

  <p>Additionally you may have chosen to install oVirt Reports. This is not mandatory and is not required to commence installing virtualization hosts. Once you have completed the above tasks you are ready to install virtualization hosts.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> It is recommended that you install at least two virtualization hosts and attach them to the oVirt environment. Where you attach only one virtualization host you will be unable to access features such as migration which require redundant hosts.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Important:</strong> oVirt Node is a closed system. Use a Red Hat Enterprise Linux host if additional rpms are required for your environment.</p>

  </div>
  <p>## ⁠Chapter 5. oVirt Node Hosts</p>

  <h3 id="ovirt-node-installation-overview">oVirt Node Installation Overview</h3>

  <p>Before commencing Hypervisor installation you must be aware that:</p>

  <ul>
    <li>oVirt Node <em>must</em> be installed on a physical server. It must not be installed in a Virtual Machine.</li>
    <li>The installation process will reconfigure the selected storage device and destroy all data. Therefore, ensure that any data to be retained is successfully backed up before proceeding.</li>
    <li>All Hypervisors in an environment must have unique hostnames and IP addresses, in order to avoid network conflicts.</li>
    <li>Instructions for using Network (PXE) Boot to install the Hypervisor are contained in the <em>Red Hat Enterprise Linux - Hypervisor Deployment Guide</em>, available at <a href="https://access.redhat.com/site/documentation/en-US/"><a href="https://access.redhat.com/site/documentation/en-US/">https://access.redhat.com/site/documentation/en-US/</a></a>.</li>
    <li>oVirt Nodes can use Storage Attached Networks (SANs) and other network storage for storing virtualized guest images. However, a local storage device is required for installing and booting the Hypervisor.</li>
  </ul>

  <div class="alert alert-info">
    <p><strong>Note:</strong> oVirt Node installations can be automated or conducted without interaction. This type of installation is only recommended for advanced users. See the <em>Red Hat Enterprise Virtualization - Installation Guide</em> for more information.</p>

  </div>
  <p>### Installing oVirt Node Disk Image</p>

  <p><strong>Summary</strong></p>

  <p>Before you can set up a oVirt Node, you must download the packages containing oVirt Node disk image and tools for writing that disk image to USB storage devices or preparing that disk image for deployment via PXE.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.1. Installing oVirt Node Disk Image</strong></p>

  <ol>
    <li>Enable the <code>oVirt Node (v.6 x86_64)</code> repository:
      <ul>
        <li>
          <p>With RHN Classic:
    # rhn-channel –add –channel=rhel-x86_64-server-6-rhevh</p>
        </li>
        <li>
          <p>With Subscription Manager, attach a <code>Red Hat Enterprise Virtualization</code> entitlement and run the following command:
    # subscription-manager repos –enable=rhel-6-server-rhevh-rpms</p>
        </li>
      </ul>
    </li>
    <li>
      <p>Run the following command to install the rhev-hypervisor6 package:
    # yum install rhev-hypervisor6</p>
    </li>
    <li>Run the following command to install the livecd-tools package:
    # yum install livecd-tools</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have installed oVirt Node disk image and the <strong>livecd-iso-to-disk</strong> and <strong>livecd-iso-to-pxeboot</strong> utilities. By default, oVirt Node disk image is located in the <code>/usr/share/rhev-hypervisor/</code> directory.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> Red Hat Enterprise Linux 6.2 and later allows more than one version of the ISO image to be installed at one time. As such, <code>/usr/share/rhev-hypervisor/rhev-hypervisor.iso</code> is now a symbolic link to a uniquely-named version of the Hypervisor ISO image, such as <code>/usr/share/rhev-hypervisor/rhev-hypervisor-6.4-20130321.0.el6ev.iso</code>. Different versions of the image can now be installed alongside each other, allowing administrators to run and maintain a cluster on a previous version of the Hypervisor while upgrading another cluster for testing. Additionally, the symbolic link <code>/usr/share/rhev-hypervisor/rhevh-latest-6.iso</code>, is created. This links also targets the most recently installed version of the oVirt ISO image.</p>

  </div>
  <p>### Preparing Installation Media</p>

  <h4 id="preparing-a-usb-storage-device"> Preparing a USB Storage Device</h4>

  <p>You can write oVirt Node disk image to a USB storage device such as a flash drive or external hard drive. You can then use that USB device to start the machine on which oVirt Node will be installed and install oVirt Node operating system.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> Not all systems support booting from a USB storage device. Ensure the BIOS on the system on which you will install oVirt Node supports this feature.</p>

  </div>
  <p>####  Preparing USB Installation Media Using livecd-iso-to-disk</p>

  <p><strong>Summary</strong></p>

  <p>You can use the <strong>livecd-iso-to-disk</strong> utility included in the livecd-tools package to write a hypervisor or other disk image to a USB storage device. You can then use that USB storage device to start systems that support booting via USB and install the oVirt Node.</p>

  <p>The basic syntax for the <strong>livecd-iso-to-disk</strong> utility is as follows:</p>

<pre class="highlight plaintext"><code># livecd-iso-to-disk [image] [device]&#x000A;</code></pre>

  <p>The <em>[device]</em> parameter is the path to the USB storage device on which to write the disk image. The <em>[image]</em> parameter is the path and file name of the disk image to write to the USB storage device. By default, oVirt Node disk image is located at <code>/usr/share/rhev-hypervisor/rhev-hypervisor.iso</code> on the machine on which oVirt is installed. The <strong>livecd-iso-to-disk</strong> utility requires devices to be formatted with the <code>FAT</code> or <code>EXT3</code> file system.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> USB storage devices are sometimes formatted without a partition table. In this case, use a generic identifier for the storage device such as <code>/dev/sdb</code>. When a USB storage device is formatted with a partition table, use the path name to the device, such as <code>/dev/sdb1</code>.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 5.2. Preparing USB Installation Media Using livecd-iso-to-disk</strong></p>

  <ol>
    <li>
      <p>Run the following command to ensure you have the latest version of oVirt Node disk image:
    # yum update rhev-hypervisor6</p>
    </li>
    <li>
      <p>Use the <strong>livecd-iso-to-disk</strong> utility to write the disk image to a USB storage device.
⁠</p>

      <p><strong>Example 5.1. Use of livecd-iso-to-disk</strong></p>

      <p>This example demonstrates the use of <strong>livecd-iso-to-disk</strong> to write a oVirt Node disk image to a USB storage device named <code>/dev/sdc</code> and make that USB storage device bootable.</p>

<pre class="highlight plaintext"><code># livecd-iso-to-disk --format --reset-mbr /usr/share/rhev-hypervisor/rhev-hypervisor.iso /dev/sdc&#x000A;Verifying image...&#x000A;/usr/share/rhev-hypervisor/rhev-hypervisor.iso:   eccc12a0530b9f22e5ba62b848922309&#x000A;Fragment sums: 8688f5473e9c176a73f7a37499358557e6c397c9ce2dafb5eca5498fb586&#x000A;Fragment count: 20&#x000A;Press [Esc] to abort check.&#x000A;Checking: 100.0%&#x000A;&#x000A;The media check is complete, the result is: PASS.&#x000A;&#x000A;It is OK to use this media.&#x000A;&#x000A;WARNING: THIS WILL DESTROY ANY DATA ON /dev/sdc!!!&#x000A;Press Enter to continue or ctrl-c to abort&#x000A;&#x000A;/dev/sdc: 2 bytes were erased at offset 0x000001fe (dos): 55 aa&#x000A;Waiting for devices to settle...&#x000A;mke2fs 1.42.7 (21-Jan-2013)&#x000A;Filesystem label=LIVE&#x000A;OS type: Linux&#x000A;Block size=4096 (log=2)&#x000A;Fragment size=4096 (log=2)&#x000A;Stride=0 blocks, Stripe width=0 blocks&#x000A;488640 inodes, 1953280 blocks&#x000A;97664 blocks (5.00%) reserved for the super user&#x000A;First data block=0&#x000A;Maximum filesystem blocks=2000683008&#x000A;60 block groups&#x000A;32768 blocks per group, 32768 fragments per group&#x000A;8144 inodes per group&#x000A;Superblock backups stored on blocks: &#x000A;        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632&#x000A;&#x000A;Allocating group tables: done                            &#x000A;Writing inode tables: done                            &#x000A;Creating journal (32768 blocks): done&#x000A;Writing superblocks and filesystem accounting information: done &#x000A;&#x000A;Copying live image to target device.&#x000A;squashfs.img&#x000A;   163360768 100%  184.33MB/s    0:00:00 (xfer#1, to-check=0/1)&#x000A;&#x000A;sent 163380785 bytes  received 31 bytes  108920544.00 bytes/sec&#x000A;total size is 163360768  speedup is 1.00&#x000A;osmin.img&#x000A;        4096 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)&#x000A;&#x000A;sent 4169 bytes  received 31 bytes  8400.00 bytes/sec&#x000A;total size is 4096  speedup is 0.98&#x000A;Updating boot config file&#x000A;Installing boot loader&#x000A;/media/tgttmp.q6aZdS/syslinux is device /dev/sdc&#x000A;Target device is now set up with a Live image!&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have written a oVirt Node disk image to a USB storage device. You can now use that USB storage device to start a system and install oVirt Node operating system.</p>

  <h4 id="preparing-usb-installation-media-using-dd"> Preparing USB Installation Media Using dd</h4>

  <p>The <strong>dd</strong> utility can also be used to write a oVirt Node disk image to a USB storage device. The <strong>dd</strong> utility is available from the coreutils package, and versions of the <strong>dd</strong> utility are available on a wide variety of Linux and Unix operating systems. Windows users can obtain the <strong>dd</strong> utility by installing Red Hat Cygwin, a free Linux-like environment for Windows.</p>

  <p>The basic syntax for the <strong>dd</strong> utility is as follows:</p>

<pre class="highlight plaintext"><code># dd if=[image] of=[device]&#x000A;</code></pre>

  <p>The <em>[device]</em> parameter is the path to the USB storage device on which the disk image will be written. The <em>[image]</em> parameter is the path and file name of the disk image to write to the USB storage device. By default, oVirt Node disk image is located at <code>/usr/share/rhev-hypervisor/rhev-hypervisor.iso</code> on the machine on which the rhev-hypervisor6 package is installed. The <strong>dd</strong> command does not make assumptions as to the format of the device because it performs a low-level copy of the raw data in the selected image.</p>

  <h4 id="preparing-usb-installation-media-using-dd-on-linux-systems"> Preparing USB Installation Media Using dd on Linux Systems</h4>

  <p><strong>Summary</strong></p>

  <p>You can use the <strong>dd</strong> utility to write a oVirt Node disk image to a USB storage device.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.3. Preparing USB Installation Media using dd on Linux Systems</strong></p>

  <ol>
    <li>
      <p>Run the following command to ensure you have the latest version of oVirt Node disk image:
    # yum update rhev-hypervisor6</p>
    </li>
    <li>
      <p>Use the <strong>dd</strong> utility to write the disk image to a USB storage device.
⁠</p>

      <p><strong>Example 5.2. Use of dd</strong></p>

      <p>This example uses a USB storage device named <code>/dev/sdc</code>.</p>

<pre class="highlight plaintext"><code># dd if=/usr/share/rhev-hypervisor/rhev-hypervisor.iso of=/dev/sdc&#x000A;243712+0 records in&#x000A;243712+0 records out&#x000A;124780544 bytes (125 MB) copied, 56.3009 s, 2.2 MB/s&#x000A;</code></pre>

      <p><strong>Warning</strong></p>

      <p>The <strong>dd</strong> utility will overwrite all data on the device specified by the <em><code>of</code></em> parameter. Ensure you have specified the correct device and that the device contains no valuable data before using the <strong>dd</strong> utility.</p>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have written a oVirt Node disk image to a USB storage device.</p>

  <h4 id="preparing-optical-hypervisor-installation-media"> Preparing Optical Hypervisor Installation Media</h4>

  <p><strong>Summary</strong></p>

  <p>You can write a oVirt Node disk image to a CD-ROM or DVD with the <strong>wodim</strong> utility. The <strong>wodim</strong> utility is provided by the wodim package.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.4. Preparing Optical Hypervisor Installation Media</strong></p>

  <ol>
    <li>
      <p>Run the following command to install the wodim package and dependencies:
    # yum install wodim</p>
    </li>
    <li>Insert a blank CD-ROM or DVD into your CD or DVD writer.</li>
    <li>
      <p>Run the following command to write oVirt Node disk image to the disc:
    wodim dev=[device] [image]</p>

      <p>⁠</p>

      <p><strong>Example 5.3. Use of the wodim Utility</strong></p>

      <p>This example uses the first CD-RW (<code>/dev/cdrw</code>) device available and the default hypervisor image location.</p>

<pre class="highlight plaintext"><code># wodim dev=/dev/cdrw /usr/share/rhev-hypervisor/rhev-hypervisor.iso&#x000A;</code></pre>
    </li>
  </ol>

  <div class="alert alert-info">
    <p><strong>Important:</strong> The Hypervisor uses a program (<strong>isomd5sum</strong>) to verify the integrity of the installation media every time the hypervisor is booted. If media errors are reported in the boot sequence you have a bad CD-ROM. Follow the procedure above to create a new CD-ROM or DVD.</p>

  </div>
  <p><strong>Result</strong></p>

  <p>You have written a oVirt Node disk image to a CD-ROM or DVD.</p>

  <h3 id="installation">Installation</h3>

  <h4 id="booting-the-hypervisor-from-usb-installation-media"> Booting the Hypervisor from USB Installation Media</h4>

  <p><strong>Summary</strong></p>

  <p>Booting a hypervisor from a USB storage device is similar to booting other live USB operating systems. Follow this procedure to boot a machine using USB installation media.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.5. Booting the Hypervisor from USB Installation Media</strong></p>

  <ol>
    <li>Enter the BIOS menu to enable USB storage device booting if not already enabled.
      <ol>
        <li>Enable USB booting if this feature is disabled.</li>
        <li>Set booting USB storage devices to be first boot device.</li>
        <li>Shut down the system.</li>
      </ol>
    </li>
    <li>Insert the USB storage device that contains the hypervisor boot image.</li>
    <li>Restart the system.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The hypervisor boot process commences automatically.</p>

  <h4 id="booting-the-hypervisor-from-optical-installation-media"> Booting the Hypervisor from Optical Installation Media</h4>

  <p><strong>Summary</strong></p>

  <p>Booting the Hypervisor from optical installation media requires the system to have a correctly defined BIOS boot configuration.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.6. Booting the Hypervisor from Optical Installation Media</strong></p>

  <ol>
    <li>
      <p>Ensure that the system's BIOS is configured to boot from the CD-ROM or DVD-ROM drive first. For many systems this is the default.
<strong>Note</strong></p>

      <p>Refer to your manufacturer's manuals for further information on modifying the system's BIOS boot configuration.</p>
    </li>
    <li>Insert the Hypervisor CD-ROM in the CD-ROM or DVD-ROM drive.</li>
    <li>Reboot the system.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The Hypervisor boot screen will be displayed.</p>

  <h4 id="starting-the-installation-program">3. Starting the Installation Program</h4>

  <p><strong>Summary</strong></p>

  <p>When you start a system using the prepared boot media, the first screen that displays is the boot menu. From here, you can start the installation program for installing the hypervisor.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.7. Starting the Installation Program</strong></p>

  <ol>
    <li>
      <p>From the boot splash screen, press any key to open the boot menu.
⁠</p>

      <p><img alt="The boot splash screen counts down for 30 seconds before automatically booting the system." title="The boot splash screen counts down for 30 seconds before automatically booting the system." src="/images/images/5133.png" /></p>

      <p><strong>Figure 5.1. The boot splash screen</strong></p>
    </li>
    <li>
      <p>From the boot menu, use the directional keys to select <strong>Install or Upgrade</strong>, <strong>Install (Basic Video)</strong>, or <strong>Install or Upgrade with Serial Console</strong>.
⁠</p>

      <p><img alt="The boot menu screen displays all predefined boot options, as well as providing the option to edit them." title="The boot menu screen displays all predefined boot options, as well as providing the option to edit them." src="/images/images/5134.png" /></p>

      <p><strong>Figure 5.2. The boot menu</strong></p>

      <p>The full list of options in the boot menu is as follows:</p>

      <dl>
        <dt>
<strong>Install or Upgrade</strong>

</dt>
        <dd>
          <p>Install or upgrade the hypervisor.</p>

        </dd>
        <dt>
<strong>Install (Basic Video)</strong>

</dt>
        <dd>
          <p>Install or upgrade the Hypervisor in basic video mode.</p>

        </dd>
        <dt>
<strong>Install or Upgrade with Serial Console</strong>

</dt>
        <dd>
          <p>Install or upgrade the hypervisor while redirecting the console to a serial device attached to <code>/dev/ttyS0</code>.</p>

        </dd>
        <dt>
<strong>Reinstall</strong>

</dt>
        <dd>
          <p>Reinstall the hypervisor.</p>

        </dd>
        <dt>
<strong>Reinstall (Basic Video)</strong>

</dt>
        <dd>
          <p>Reinstall the hypervisor in basic video mode.</p>

        </dd>
        <dt>
<strong>Reinstall with Serial Console</strong>

</dt>
        <dd>
          <p>Reinstall the hypervisor while redirecting the console to a serial device attached to <code>/dev/ttyS0</code>.</p>

        </dd>
        <dt>
<strong>Uninstall</strong>

</dt>
        <dd>
          <p>Uninstall the hypervisor.</p>

        </dd>
        <dt>
<strong>Boot from Local Drive</strong>

</dt>
        <dd>
          <p>Boot the operating system installed on the first local drive.</p>

        </dd>
      </dl>
    </li>
    <li>
      <p>Press the <strong>Enter</strong> key.</p>
    </li>
  </ol>

  <div class="alert alert-info">
    <p><strong>Note:</strong> From the boot menu, you can also press the <strong>Tab</strong> key to edit the kernel parameters. Kernel parameters must be separated by a space, and once you have entered the preferred kernel parameters, you can boot the system using those kernel parameters by pressing the <strong>Enter</strong> key. To clear any changes you have made to the kernel parameters and return to the boot menu, press the <strong>Esc</strong> key. For a list of supported kernel parameters, see the <em>Red Hat Enterprise Linux - Hypervisor Deployment Guide</em>.</p>

  </div>
  <p><strong>Result</strong></p>

  <p>You have started the hypervisor installation program.</p>

  <h4 id="hypervisor-menu-actions"> Hypervisor Menu Actions</h4>

  <ul>
    <li>The directional keys (<strong>Up</strong>, <strong>Down</strong>, <strong>Left</strong>, <strong>Right</strong>) are used to select different controls on the screen. Alternatively the <strong>Tab</strong> key cycles through the controls on the screen which are enabled.</li>
    <li>Text fields are represented by a series of underscores (<strong>_</strong>). To enter data in a text field select it and begin entering data.</li>
    <li>Buttons are represented by labels which are enclosed within a pair of angle brackets (<strong>&lt;</strong> and <strong>&gt;</strong>). To activate a button ensure it is selected and press <strong>Enter</strong> or <strong>Space</strong>.</li>
    <li>Boolean options are represented by an asterisk (<strong>*</strong>) or a space character enclosed within a pair of square brackets (<strong>[</strong> and <strong>]</strong>). When the value contained within the brackets is an asterisk then the option is set, otherwise it is not. To toggle a Boolean option on or off press <strong>Space</strong> while it is selected.</li>
  </ul>

  <h4 id="installing-the-hypervisor"> Installing the Hypervisor</h4>

  <p><strong>Summary</strong></p>

  <p>There are two methods for installing oVirt Nodes:</p>

  <ul>
    <li>Interactive installation.</li>
    <li>Unattended installation.</li>
  </ul>

  <p>This section outlines the procedure for installing a Hypervisor interactively. For information on unattended installation, see the <em>Red Hat Enterprise Linux - Hypervisor Deployment Guide</em>.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.8. Installing the Hypervisor Interactively</strong></p>

  <ol>
    <li>Use the prepared boot media to boot the machine on which the Hypervisor is to be installed.</li>
    <li>Select <strong>Install Hypervisor</strong> and press <strong>Enter</strong> to begin the installation process.</li>
    <li>
      <p>The first screen that appears allows you to configure the appropriate keyboard layout for your locale. Use the arrow keys to highlight the appropriate option and press <strong>Enter</strong> to save your selection.
⁠</p>

      <p><strong>Example 5.4. Keyboard Layout Configuration</strong></p>

<pre class="highlight plaintext"><code>Keyboard Layout Selection&#x000A;&#x000A;Available Keyboard Layouts&#x000A;Swiss German (latin1)&#x000A;Turkish&#x000A;U.S. English&#x000A;U.S. International&#x000A;...&#x000A;&#x000A;(Hit enter to select a layout)&#x000A;&#x000A;&amp;lt;Quit&amp;gt;     &amp;lt;Back&amp;gt;     &amp;lt;Continue&amp;gt;&#x000A;</code></pre>
    </li>
    <li>The installation script automatically detects all disks attached to the system. This information is used to assist with selection of the boot and installation disks that the Hypervisor will use. Each entry displayed on these screens indicates the <strong>Location</strong>, <strong>Device Name</strong>, and <strong>Size</strong> of the disks.
      <ol>
        <li>
          <p><strong>Boot Disk</strong>
The first disk selection screen is used to select the disk from which the Hypervisor will boot. The Hypervisor's boot loader will be installed to the Master Boot Record (MBR) of the disk that is selected on this screen. The Hypervisor attempts to automatically detect the disks attached to the system and presents the list from which to choose the boot device. Alternatively, you can manually select a device by specifying a block device name using the <strong>Other Device</strong> option.</p>

          <p><strong>Important</strong></p>

          <p>The selected disk must be identified as a boot device and appear in the boot order either in the system's BIOS or in a pre-existing boot loader.</p>

          <ul>
            <li><strong>Automatically Detected Device Selection</strong>
              <ol>
                <li>Select the entry for the disk the Hypervisor is to boot from in the list and press <strong>Enter</strong>.</li>
                <li>Select the disk and press <strong>Enter</strong>. This action saves the boot device selection and starts the next step of installation.</li>
              </ol>
            </li>
            <li><strong>Manual Device Selection</strong>
              <ol>
                <li>Select <strong>Other device</strong> and press <strong>Enter</strong>.</li>
                <li>
                  <p>When prompted to <strong>Please select the disk to use for booting RHEV-H</strong>, enter the name of the block device from which the Hypervisor should boot.
⁠</p>

                  <p><strong>Example 5.5. Other Device Selection</strong></p>

<pre class="highlight plaintext"><code>Please select the disk to use for booting RHEV-H&#x000A;/dev/sda&#x000A;</code></pre>
                </li>
                <li>Press <strong>Enter</strong>. This action saves the boot device selection and starts the next step of installation.</li>
              </ol>
            </li>
          </ul>
        </li>
        <li>
          <p>The disk or disks selected for installation will be those to which the Hypervisor itself is installed. The Hypervisor attempts to automatically detect the disks attached to the system and presents the list from which installation devices are chosen.
<strong>Warning</strong></p>

          <p>All data on the selected storage devices will be destroyed.</p>

          <ol>
            <li>Select each disk on which the Hypervisor is to be installed and press <strong>Space</strong> to toggle it to enabled. Where other devices are to be used for installation, either solely or in addition to those which are listed automatically, use <strong>Other Device</strong>.</li>
            <li>Select the <strong>Continue</strong> button and press <strong>Enter</strong> to continue.</li>
            <li>
              <p>Where the <strong>Other Device</strong> option was specified, a further prompt will appear. Enter the name of each additional block device to use for Hypervisor installation, separated by a comma. Once all required disks have been selected, select the **<continue>** button and press **Enter**.
⁠</continue></p>

              <p><strong>Example 5.6. Other Device Selection</strong></p>

<pre class="highlight plaintext"><code>Please enter one or more disks to use for installing RHEV-H. Multiple devices can be separated by comma.&#x000A;Device path:   /dev/mmcblk0,/dev/mmcblk1______________&#x000A;</code></pre>
            </li>
          </ol>

          <p>Once the installation disks have been selected, the next stage of the installation starts.</p>
        </li>
      </ol>
    </li>
    <li>The next screen allows you to configure storage for the Hypervisor.
      <ol>
        <li>Select or clear the <strong>Fill disk with Data partition</strong> check box. Clearing this text box displays a field showing the remaining space on the drive and allows you to specify the amount of space to be allocated to data storage.</li>
        <li>Enter the preferred values for <strong>Swap</strong>, <strong>Config</strong>, and <strong>Logging</strong>.</li>
        <li>If you selected the <strong>Fill disk with Data partition</strong> check box, the <strong>Data</strong> field is automatically set to <code>0</code>. If the check box was cleared, you can enter a whole number up to the value of the <strong>Remaining Space</strong> field. Entering a value of <code>-1</code> fills all remaining space.</li>
      </ol>
    </li>
    <li>The Hypervisor requires a password be set to protect local console access to the <code>admin</code> user. The installation script prompts you to enter the preferred password in both the <strong>Password</strong> and <strong>Confirm Password</strong> fields. Use a strong password. Strong passwords comprise a mix of uppercase, lowercase, numeric, and punctuation characters. They are six or more characters long and do not contain dictionary words. Once a strong password has been entered, select **<install>** and press **Enter** to install the Hypervisor on the selected disks.</install></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>Once installation is complete, the message <code>RHEV Hypervisor Installation Finished Successfully</code> will be displayed. Select the **<reboot>** button and press **Enter** to reboot the system.</reboot></p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> Remove the boot media and change the boot device order to prevent the installation sequence restarting after the system reboots.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Note:</strong> oVirt Nodes are able to use Storage Area Networks (SANs) and other network storage for storing virtualized guest images. Hypervisors can be installed on SANs, provided that the Host Bus Adapter (HBA) permits configuration as a boot device in BIOS.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Note:</strong> Hypervisors are able to use multipath devices for installation. Multipath is often used for SANs or other networked storage. Multipath is enabled by default at install time. Any block device which responds to <code>scsi_id</code> functions with multipath. Devices where this is not the case include USB storage and some older ATA disks.</p>

  </div>
  <p>### Configuration</p>

  <h4 id="logging-into-the-hypervisor"> Logging Into the Hypervisor</h4>

  <p><strong>Summary</strong></p>

  <p>You can log into the hypervisor console locally to configure the hypervisor.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.9. Logging Into the Hypervisor</strong></p>

  <ol>
    <li>Start the machine on which oVirt Node operating system is installed.</li>
    <li>Enter the user name <code>admin</code> and press <strong>Enter</strong>.</li>
    <li>Enter the password you set during installation and press <strong>Enter</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have successfully logged into the hypervisor console as the <code>admin</code> user.</p>

  <h4 id="the-status-screen"> The Status Screen</h4>

  <p>The <strong>Status</strong> screen provides an overview of the state of the Hypervisor such as the current status of networking, the location in which logs and reports are stored, and the number of virtual machines that are active on that hypervisor. The <strong>Status</strong> screen also provides the following buttons for viewing further details regarding the Hypervisor and for changing the state of the Hypervisor:</p>

  <ul>
    <li>**<view host="" key="">**: Displays the RSA host key fingerprint and host key of the Hypervisor.</view></li>
    <li>**<view cpu="" details="">**: Displays details on the CPU used by the Hypervisor such as the CPU name and type.</view></li>
    <li>**<lock>**: Locks the Hypervisor. The user name and password must be entered to unlock the Hypervisor.</lock></li>
    <li>**<log off="">**: Logs off the current user.</log></li>
    <li>**<restart>**: Restarts the Hypervisor.</restart></li>
    <li>**<power off="">**: Turns the Hypervisor off.</power></li>
  </ul>

  <h4 id="the-network-screen">The Network Screen</h4>

  <h5 id="the-network-screen-1">The Network Screen</h5>

  <p>The <strong>Network</strong> screen is used to configure the host name of the hypervisor and the DNS servers, NTP servers and network interfaces that the hypervisor will use. The <strong>Network</strong> screen also provides a number of buttons for testing and configuring network interfaces:</p>

  <ul>
    <li>**<ping>**: Allows you to ping a given IP address by specifying the address to ping and the number of times to ping that address.</ping></li>
    <li>**<create bond="">**: Allows you to create bonds between network interfaces.</create></li>
  </ul>

  <h5 id="configuring-the-host-name">Configuring the Host Name</h5>

  <p><strong>Summary</strong></p>

  <p>You can change the host name used to identify the hypervisor.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.10. Configuring the Host Name</strong></p>

  <ol>
    <li>Select the <strong>Hostname</strong> field on the <strong>Network</strong> screen and enter the new host name.</li>
    <li>Select **<save>** and press **Enter** to save the changes.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have changed the host name used to identify the hypervisor.</p>

  <h5 id="configuring-domain-name-servers">Configuring Domain Name Servers</h5>

  <p><strong>Summary</strong></p>

  <p>You can specify up to two domain name servers that the hypervisor will use to resolve network addresses.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.11. Configuring Domain Name Servers</strong></p>

  <ol>
    <li>To set or change the primary DNS server, select the <strong>DNS Server 1</strong> field and enter the IP address of the new primary DNS server.</li>
    <li>To set or change the secondary DNS server, select the <strong>DNS Server 2</strong> field and enter the IP address of the new secondary DNS server.</li>
    <li>Select **<save>** and press **Enter** to save the changes.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have specified the primary and secondary domain name servers that the hypervisor will use to resolve network addresses.</p>

  <h5 id="configuring-network-time-protocol-servers">Configuring Network Time Protocol Servers</h5>

  <p><strong>Summary</strong></p>

  <p>You can specify up to two network time protocol servers that the hypervisor will use to synchronize its system clock.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> You must specify the same time servers as oVirt to ensure all system clocks throughout the oVirt environment are synchronized.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 5.12. Configuring Network Time Protocol Servers</strong></p>

  <ol>
    <li>To set or change the primary NTP server, select the <strong>NTP Server 1</strong> field and enter the IP address or host name of the new primary NTP server.</li>
    <li>To set or change the secondary NTP server, select the <strong>NTP Server 2</strong> field and enter the IP address or host name of the new secondary NTP server.</li>
    <li>Select **<save>** and press **Enter** to save changes to the NTP configuration.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have specified the primary and secondary NTP servers that the hypervisor will use to synchronize its system clock.</p>

  <h5 id="configuring-network-interfaces">Configuring Network Interfaces</h5>

  <p><strong>Summary</strong></p>

  <p>After you have installed oVirt Node operating system, all network interface cards attached to the hypervisor are initially in an unconfigured state. You must configure at least one network interface to connect the hypervisor with oVirt.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.13. Configuring Network Interfaces</strong></p>

  <ol>
    <li>
      <p>Select a network interfaces from the list beneath <strong>Available System NICs</strong> and press <strong>Enter</strong> to configure that network interface.
<strong>Note</strong></p>

      <p>To identify the physical network interface card associated with the selected network interface, select **<flash lights="" to="" identify="">** and press **Enter**.</flash></p>
    </li>
    <li>Configure a dynamic or static IP address:
      <ul>
        <li>
          <p><strong>Configuring a Dynamic IP Address</strong>
Select <strong>DHCP</strong> under <strong>IPv4 Settings</strong> and press the space bar to enable this option.</p>
        </li>
        <li>
          <p><strong>Configuring a Static IP Address</strong></p>
          <ul>
            <li>Select <strong>Static</strong> under <strong>IPv4 Settings</strong> and press the space bar to enable this option.</li>
            <li>Specify the <strong>IP Address</strong>, <strong>Netmask</strong>, and <strong>Gateway</strong> that the hypervisor will use.</li>
          </ul>

          <p>⁠</p>

          <p><strong>Example 5.7. Static IPv4 Networking Configuration</strong></p>

<pre class="highlight plaintext"><code>IPv4 Settings&#x000A;( ) Disabled     ( ) DHCP     (*) Static&#x000A;IP Address: 192.168.122.100_  Netmask: 255.255.255.0___&#x000A;Gateway     192.168.1.1_____&#x000A;</code></pre>
        </li>
      </ul>

      <p><strong>Note</strong></p>

      <p>oVirt does not currently support IPv6 networking. IPv6 networking must remain set to <strong>Disabled</strong>.</p>
    </li>
    <li>Enter a VLAN identifer in the <strong>VLAN ID</strong> field to configure a VLAN for the device.</li>
    <li>Select the <strong>Use Bridge</strong> option and press the space bar to enable this option.</li>
    <li>Select the **<save>** button and press **Enter** to save the network configuration.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The progress of configuration is displayed on screen. When configuration is complete, press the <strong>Enter</strong> key to close the progress window and return to the <strong>Network</strong> screen. The network interface is now listed as <strong>Configured</strong>.</p>

  <h4 id="the-security-screen">4. The Security Screen</h4>

  <p><strong>Summary</strong></p>

  <p>You can configure security-related options for the hypervisor such as SSH password authentication, AES-NI encryption, and the password of the <code>admin</code> user.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.14. Configuring Security</strong></p>

  <ol>
    <li>Select the <strong>Enable SSH password authentication</strong> option and press the space bar to enable SSH authentication.</li>
    <li>Select the <strong>Disable AES-NI</strong> option and press the space bar to disable the use of AES-NI for encryption.</li>
    <li>Optionally, enter the number of bytes by which to pad blocks in AES-NI encryption if AES-NI encryption is enabled.</li>
    <li>Enter a new password for the <code>admin</code> user in the <strong>Password</strong> field and <strong>Confirm Password</strong> to change the password used to log into the hypervisor console.</li>
    <li>Select **<save>** and press **Enter**.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have updated the security-related options for the hypervisor.</p>

  <h4 id="the-keyboard-screen"> The Keyboard Screen</h4>

  <p><strong>Summary</strong></p>

  <p>The <strong>Keyboard</strong> screen allows you to configure the keyboard layout used inside the hypervisor console.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.15. Configuring the Hypervisor Keyboard Layout</strong></p>

  <ol>
    <li>
      <p>Select a keyboard layout from the list provided.
    Keyboard Layout Selection</p>

<pre class="highlight plaintext"><code>Choose the Keyboard Layout you would like to apply to this system.&#x000A;&#x000A;Current Active Keyboard Layout: U.S. English&#x000A;Available Keyboard Layouts&#x000A;Swiss German (latin1)&#x000A;Turkish&#x000A;U.S. English&#x000A;U.S. International&#x000A;Ukranian&#x000A;...&#x000A;&#x000A;&amp;lt;Save&amp;gt;&#x000A;</code></pre>
    </li>
    <li>
      <p>Select <strong>Save</strong> and press <strong>Enter</strong> to save the selection.</p>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have successfully configured the keyboard layout.</p>

  <h4 id="the-snmp-screen"> The SNMP Screen</h4>

  <p><strong>Summary</strong></p>

  <p>The <strong>SNMP</strong> screen allows you to enable and configure a password for simple network management protocol.</p>

<pre class="highlight plaintext"><code>Enable SNMP       [ ]&#x000A;&#x000A;SNMP Password&#x000A;Password:          _______________&#x000A;Confirm Password:  _______________&#x000A;&#x000A;&amp;lt;Save&amp;gt;     &amp;lt;Reset&amp;gt;&#x000A;</code></pre>

  <p>⁠</p>

  <p><strong>Procedure 5.16. Configuring Simple Network Management Protocol</strong></p>

  <ol>
    <li>Select the <strong>Enable SNMP</strong> option and press the space bar to enable SNMP.</li>
    <li>Enter a password in the <strong>Password</strong> and <strong>Confirm Password</strong> fields.</li>
    <li>Select **<save>** and press **Enter**.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have enabled SNMP and configured a password that the hypervisor will use in SNMP communication.</p>

  <h4 id="the-cim-screen"> The CIM Screen</h4>

  <p><strong>Summary</strong></p>

  <p>The <strong>CIM</strong> screen allows you to configure a common information model for attaching the hypervisor to a pre-existing CIM management infrastructure and monitor virtual machines that are running on the hypervisor.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.17. Configuring Hypervisor Common Information Model</strong></p>

  <ol>
    <li>
      <p>Select the <strong>Enable CIM</strong> option and press the space bar to enable CIM.
    Enable CIM     [ ]</p>
    </li>
    <li>Enter a password in the <strong>Password</strong> field and <strong>Confirm Password</strong> field.</li>
    <li>Select <strong>Save</strong> and press <strong>Enter</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured the Hypervisor to accept CIM connections authenticated using a password. Use this password when adding the Hypervisor to your common information model object manager.</p>

  <h4 id="the-logging-screen"> The Logging Screen</h4>

  <p><strong>Summary</strong></p>

  <p>The <strong>Logging</strong> screen allows you to configure logging-related options such as a daemon for automatically exporting log files generated by the hypervisor to a remote server.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.18. Configuring Logging</strong></p>

  <ol>
    <li>In the <strong>Logrotate Max Log Size</strong> field, enter the maximum size in kilobytes that log files can reach before they are rotated by <strong>logrotate</strong>. The default value is <code>1024</code>.</li>
    <li>Optionally, configure <strong>rsyslog</strong> to transmit log files to a remote <code>syslog</code> daemon:
      <ol>
        <li>Enter the remote <strong>rsyslog</strong> server address in the <strong>Server Address</strong> field.</li>
        <li>Enter the remote <strong>rsyslog</strong> server port in the <strong>Server Port</strong> field. The default port is <code>514</code>.</li>
      </ol>
    </li>
    <li>Optionally, configure <strong>netconsole</strong> to transmit kernel messages to a remote destination:
      <ol>
        <li>Enter the <strong>Server Address</strong>.</li>
        <li>Enter the <strong>Server Port</strong>. The default port is <code>6666</code>.</li>
      </ol>
    </li>
    <li>Select **<save>** and press **Enter**.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured logging for the hypervisor.</p>

  <h4 id="the-kdump-screen"> The Kdump Screen</h4>

  <p><strong>Summary</strong></p>

  <p>The <strong>Kdump</strong> screen allows you to specify a location in which kernel dumps will be stored in the event of a system failure. There are four options - <strong>Disable</strong>, which disables kernel dumping, <strong>Local</strong>, which stores kernel dumps on the local system, and <strong>SSH</strong> and <strong>NFS</strong>, which allow you to export kernel dumps to a remote location.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.19. Configuring Kernel Dumps</strong></p>

  <ol>
    <li>Select an option for storing kernel dumps:
      <ul>
        <li><strong>Local</strong>
          <ol>
            <li>Select the <strong>Local</strong> option and press the space bar to store kernel dumps on the local system.</li>
          </ol>
        </li>
        <li><strong>SSH</strong>
          <ol>
            <li>Select the <strong>SSH</strong> option and press the space bar to export kernel dumps via SSH.</li>
            <li>Enter the location in which kernel dumps will be stored in the <strong>SSH Location (root@example.com)</strong> field.</li>
          </ol>
        </li>
        <li><strong>NFS</strong>
          <ol>
            <li>Select the <strong>NFS</strong> option and press the space bar to export kernel dumps to an NFS share.</li>
            <li>Enter the location in which kernel dumps will be stored in the <strong>NFS Location (example.com:/var/crash)</strong> field.</li>
          </ol>
        </li>
      </ul>
    </li>
    <li>Select **<save>** and press **Enter**.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured a location in which kernel dumps will be stored in the event of a system failure.</p>

  <h4 id="the-remote-storage-screen">10. The Remote Storage Screen</h4>

  <p><strong>Summary</strong></p>

  <p>You can use the <strong>Remote Storage</strong> screen to specify a remote iSCSI initiator or NFS share to use as storage.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.20. Configuring Remote Storage</strong></p>

  <ol>
    <li>
      <p>Enter an initiator name in the <strong>iSCSI Initiator Name</strong> field or the path to the NFS share in the <strong>NFSv4 Domain (example.redhat.com)</strong> field.
⁠</p>

      <p><strong>Example 5.8. iSCSI Initiator Name</strong></p>

<pre class="highlight plaintext"><code>iSCSI Initiator Name:&#x000A;iqn.1994-05.com.redhat:5189835eeb40_____&#x000A;</code></pre>

      <p>⁠</p>

      <p><strong>Example 5.9. NFS Path</strong></p>

<pre class="highlight plaintext"><code>NFSv4 Domain (example.redhat.com):&#x000A;example.redhat.com_____________________&#x000A;</code></pre>
    </li>
    <li>
      <p>Select **<save>** and press **Enter**.</save></p>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured remote storage.</p>

  <h4 id="configuring-hypervisor-management-server">11. Configuring Hypervisor Management Server</h4>

  <p><strong>Summary</strong></p>

  <p>You can attach the Hypervisor to oVirt immediately if the address of oVirt is available. If oVirt has not yet been installed, you must instead set a password. This allows the Hypervisor to be added from the Administration Portal once oVirt has been installed. Both modes of configuration are supported from the <strong>oVirt Engine</strong> screen in the Hypervisor user interface.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> Setting a password on the <strong>oVirt Engine</strong> configuration screen sets the <code>root</code> password on the Hypervisor and enables SSH password authentication. Once the Hypervisor has successfully been added to oVirt, disabling SSH password authentication is recommended.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 5.21. Configuring a Hypervisor Management Server</strong></p>

  <ol>
    <li>
      <ul>
        <li><strong>Configuration Using a Management Server Address</strong>
          <ol>
            <li>Enter the IP address or fully qualified domain name of oVirt in the <strong>Management Server</strong> field.</li>
            <li>Enter the management server port in the <strong>Management Server Port</strong> field. The default value is <code>443</code>. If a different port was selected during oVirt installation, specify it here, replacing the default value.</li>
            <li>Select the <strong>Retrieve Certificate</strong> option to verify that the fingerprint of the certificate retrieved from the specified management server is correct. The value that the certificate fingerprint is compared against is returned at the end of oVirt installation.</li>
            <li>Leave the <strong>Password</strong> and <strong>Confirm Password</strong> fields blank. These fields are not required if the address of the management server is known.</li>
          </ol>
        </li>
        <li><strong>Configuration Using a Password</strong>
          <ol>
            <li>Enter a password in the <strong>Password</strong> field. It is recommended that you use a strong password. Strong passwords contain a mix of uppercase, lowercase, numeric and punctuation characters. They are six or more characters long and do not contain dictionary words.</li>
            <li>Re-enter the password in the <strong>Confirm Password</strong> field.</li>
            <li>Leave the <strong>Management Server</strong> and <strong>Management Server Port</strong> fields blank. As long as a password is set, allowing the Hypervisor to be added to oVirt later, these fields are not required.</li>
          </ol>
        </li>
      </ul>
    </li>
    <li><strong>Save Configuration</strong>
To save the configuration select **<save>** and press **Enter**.</save></li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The <strong>oVirt Engine</strong> configuration has been updated.</p>

  <h3 id="adding-hypervisors-to-ovirt">Adding Hypervisors to oVirt</h3>

  <h4 id="using-the-hypervisor"> Using the Hypervisor</h4>

  <p>If the Hypervisor was configured with the address of oVirt, the Hypervisor reboots and is automatically registered with oVirt. oVirt interface displays the Hypervisor under the <strong>Hosts</strong> tab. To prepare the Hypervisor for use, it must be approved using oVirt.</p>

  <p>If the Hypervisor was configured without the address of oVirt, it must be added manually. To add the Hypervisor manually, you must have both the IP address of the machine upon which it was installed and the password that was set on the <strong>oVirt Engine</strong> screen during configuration.</p>

  <h4 id="approving-a-hypervisor"> Approving a Hypervisor</h4>

  <p><strong>Summary</strong></p>

  <p>It is not possible to run virtual machines on a Hypervisor until the addition of it to the environment has been approved in oVirt.</p>

  <p>⁠</p>

  <p><strong>Procedure 5.22. Approving a Hypervisor</strong></p>

  <ol>
    <li>Log in to oVirt Administration Portal.</li>
    <li>From the <strong>Hosts</strong> tab, click on the host to be approved. The host should currently be listed with the status of <strong>Pending Approval</strong>.</li>
    <li>Click the <strong>Approve</strong> button. The <strong>Edit and Approve Hosts</strong> dialog displays. You can use the dialog to set a name for the host, fetch its SSH fingerprint before approving it, and configure power management, where the host has a supported power management card. For information on power management configuration, refer to <a href="#Host_Power_Management_settings_explained">Section 7.6.2, “Host Power Management Settings Explained”</a>.</li>
    <li>Click <strong>OK</strong>. If you have not configured power management you will be prompted to confirm that you wish to proceed without doing so, click <strong>OK</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The status in the <strong>Hosts</strong> tab changes to <strong>Installing</strong>, after a brief delay the host status changes to <strong>Up</strong>.</p>

  <h2 id="chapter-6-red-hat-enterprise-linux-hosts">⁠Chapter 6. Red Hat Enterprise Linux Hosts</h2>

  <h3 id="red-hat-enterprise-linux-hosts">Red Hat Enterprise Linux Hosts</h3>

  <p>You can use a standard Red Hat Enterprise Linux 6 installation on capable hardware as a host. oVirt supports hosts running Red Hat Enterprise Linux 6 Server AMD64/Intel 64 version.</p>

  <p>Adding a host can take some time, as the following steps are completed by the platform: virtualization checks, installation of packages, creation of bridge and a reboot of the host. Use the Details pane to monitor the hand-shake process as the host and management system establish a connection.</p>

  <h2 id="chapter-7-configuring-hosts">⁠Chapter 7. Configuring Hosts</h2>

  <h3 id="installing-red-hat-enterprise-linux">Installing Red Hat Enterprise Linux</h3>

  <p><strong>Summary</strong></p>

  <p>You must install Red Hat Enterprise Linux 6.5 Server on a system to use it as a virtualization host in a oVirt 3.4 environment.</p>

  <p>⁠</p>

  <p><strong>Procedure 7.1. Installing Red Hat Enterprise Linux</strong></p>

  <ol>
    <li>
      <p><strong>Download and Install Red Hat Enterprise Linux 6.5 Server</strong>
Download and Install Red Hat Enterprise Linux 6.5 Server on the target virtualization host, referring to the <em>Red Hat Enterprise Linux 6 Installation Guide</em> for detailed instructions. Only the Base package group is required to use the virtualization host in a oVirt environment.</p>

      <p><strong>Important</strong></p>

      <p>If you intend to use directory services for authentication on the Red Hat Enterprise Linux host then you must ensure that the authentication files required by the <code>useradd</code> command are locally accessible. The vdsm package, which provides software that is required for successful connection to oVirt, will not install correctly if these files are not locally accessible.</p>
    </li>
    <li>
      <p><strong>Ensure Network Connectivity</strong>
Following successful installation of Red Hat Enterprise Linux 6.5 Server, ensure that there is network connectivity between your new Red Hat Enterprise Linux host and the system on which your oVirt is installed.</p>

      <ol>
        <li>
          <p>Attempt to ping oVirt:
    # ping address of manager</p>
        </li>
        <li>
          <ul>
            <li>
              <p>If oVirt can successfully be contacted, this displays:
    ping manager.example.redhat.com
    PING manager.example.redhat.com (192.168.0.1) 56(84) bytes of data.
    64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=0.415 ms
    64 bytes from 192.168.0.1: icmp_seq=2 ttl=64 time=0.419 ms
    64 bytes from 192.168.0.1: icmp_seq=3 ttl=64 time=1.41 ms
    64 bytes from 192.168.0.1: icmp_seq=4 ttl=64 time=0.487 ms
    64 bytes from 192.168.0.1: icmp_seq=5 ttl=64 time=0.409 ms
    64 bytes from 192.168.0.1: icmp_seq=6 ttl=64 time=0.372 ms
    64 bytes from 192.168.0.1: icmp_seq=7 ttl=64 time=0.464 ms</p>

<pre class="highlight plaintext"><code>--- manager.example.redhat.com ping statistics ---&#x000A;7 packets transmitted, 7 received, 0% packet loss, time 6267ms&#x000A;</code></pre>
            </li>
            <li>
              <p>If oVirt cannot be contacted, this displays:
    ping: unknown host manager.usersys.redhat.com</p>

              <p>You must configure the network so that the host can contact oVirt. First, disable <strong>NetworkManager</strong>. Then configure the networking scripts so that the host will acquire an ip address on boot.</p>

              <ol>
                <li>
                  <p>Disable <strong>NetworkManager</strong>.
    # service NetworkManager stop
    # chkconfig NetworkManager disable</p>
                </li>
                <li>
                  <p>Edit <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>. Find this line:
    ONBOOT=no</p>

                  <p>Change that line to this:</p>

<pre class="highlight plaintext"><code>ONBOOT=yes&#x000A;</code></pre>
                </li>
                <li>Reboot the host machine.</li>
                <li>
                  <p>Ping oVirt again:
    # ping address of manager</p>

                  <p>If the host still cannot contact oVirt, it is possible that your host machine is not acquiring an IP address from DHCP. Confirm that DHCP is properly configured and that your host machine is properly configured to acquire an IP address from DHCP.</p>

                  <p>If oVirt can successfully be contacted, this displays:</p>

<pre class="highlight plaintext"><code>ping manager.example.redhat.com&#x000A;PING manager.example.redhat.com (192.168.0.1) 56(84) bytes of data.&#x000A;64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=0.415 ms&#x000A;64 bytes from 192.168.0.1: icmp_seq=2 ttl=64 time=0.419 ms&#x000A;64 bytes from 192.168.0.1: icmp_seq=3 ttl=64 time=1.41 ms&#x000A;64 bytes from 192.168.0.1: icmp_seq=4 ttl=64 time=0.487 ms&#x000A;64 bytes from 192.168.0.1: icmp_seq=5 ttl=64 time=0.409 ms&#x000A;64 bytes from 192.168.0.1: icmp_seq=6 ttl=64 time=0.372 ms&#x000A;64 bytes from 192.168.0.1: icmp_seq=7 ttl=64 time=0.464 ms&#x000A;&#x000A;--- manager.example.redhat.com ping statistics ---&#x000A;7 packets transmitted, 7 received, 0% packet loss, time 6267ms&#x000A;</code></pre>
                </li>
              </ol>
            </li>
          </ul>
        </li>
      </ol>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have installed Red Hat Enterprise Linux 6.5 Server. You must complete additional configuration tasks before adding the virtualization host to your oVirt environment.</p>

  <h3 id="configuring-the-virtualization-host-firewall">Configuring the Virtualization Host Firewall</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt requires a number of network ports to be open to support virtual machines and remote management of the virtualization host from oVirt. You must follow this procedure to open the required network ports before attempting to add the virtualization host to oVirt.</p>

  <p>The steps in the following procedure configure the default firewall in Red Hat Enterprise Linux, <code>iptables</code>, to allow traffic on the required network ports. This procedure replaces the host's existing firewall configuration with one that contains only the ports required by oVirt. If you have existing firewall rules with which this configuration must be merged, then you must do so by manually editing the rules defined in the <code>iptables</code> configuration file, <code>/etc/sysconfig/iptables</code>.</p>

  <p>All commands in this procedure must be run as the <code>root</code> user.</p>

  <p>⁠</p>

  <p><strong>Procedure 7.2. Configuring the Virtualization Host Firewall</strong></p>

  <ol>
    <li>
      <p><strong>Remove existing rules from the firewall configuration</strong>
Remove any existing firewall rules using the <em><code>--flush</code></em> parameter to the <code>iptables</code> command.</p>

<pre class="highlight plaintext"><code># iptables --flush&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Add new firewall rules to configuration</strong>
Add the firewall rules required by oVirt using the <em><code>--append</code></em> parameter to the <code>iptables</code> command. The prompt character (<strong>#</strong>) has been intentionally omitted from this list of commands to allow easy copying of the content to a script file or command prompt.</p>

<pre class="highlight plaintext"><code>iptables --append INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT&#x000A;iptables --append INPUT -p icmp -j ACCEPT&#x000A;iptables --append INPUT -i lo -j ACCEPT&#x000A;iptables --append INPUT -p tcp --dport 22 -j ACCEPT&#x000A;iptables --append INPUT -p tcp --dport 16514 -j ACCEPT&#x000A;iptables --append INPUT -p tcp --dport 54321 -j ACCEPT&#x000A;iptables --append INPUT -p tcp -m multiport --dports 5900:6923 -j ACCEPT&#x000A;iptables --append INPUT -p tcp -m multiport --dports 49152:49216 -j ACCEPT&#x000A;iptables --append INPUT -j REJECT --reject-with icmp-host-prohibited&#x000A;iptables --append FORWARD -m physdev ! --physdev-is-bridged -j REJECT \&#x000A;--reject-with icmp-host-prohibited&#x000A;</code></pre>

      <p><strong>Note</strong></p>

      <p>The provided <code>iptables</code> commands add firewall rules to accept network traffic on a number of ports. These include:</p>

      <ul>
        <li>Port <code>22</code> for <strong>SSH</strong>.</li>
        <li>Ports <code>5900</code> to <code>6923</code> for guest console connections.</li>
        <li>Port <code>16514</code> for <strong>libvirt</strong> virtual machine migration traffic.</li>
        <li>Ports <code>49152</code> to <code>49216</code> for VDSM virtual machine migration traffic.</li>
        <li>Port <code>54321</code> for oVirt.</li>
      </ul>
    </li>
    <li>
      <p><strong>Save the updated firewall configuration</strong>
Run the following command to save the updated firewall configuration:</p>

<pre class="highlight plaintext"><code># service iptables save&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Enable iptables service</strong>
Ensure the <code>iptables</code> service is configured to start on boot and has been restarted, or is started for the first time if it was not already running.</p>

<pre class="highlight plaintext"><code># chkconfig iptables on&#x000A;# service iptables restart&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured the virtualization host's firewall to allow the network traffic required by oVirt.</p>

  <h3 id="configuring-virtualization-host-sudo">Configuring Virtualization Host sudo</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt uses <strong>sudo</strong> to perform operations as the <code>root</code> on the host. The default Red Hat Enterprise Linux configuration, stored in <code>/etc/sudoers</code>, contains values that allow this. If this file has been modified since Red Hat Enterprise Linux installation, then these values may have been removed. This procedure verifies that the required entry still exists in the configuration, and adds the required entry if it is not present.</p>

  <p>⁠</p>

  <p><strong>Procedure 7.3. Configuring Virtualization Host sudo</strong></p>

  <ol>
    <li>
      <p><strong>Log in</strong>
Log in to the virtualization host as the <code>root</code> user.</p>
    </li>
    <li>
      <p><strong>Run visudo</strong>
Run the <code>visudo</code> command to open the <code>/etc/sudoers</code> file.</p>

<pre class="highlight plaintext"><code># visudo&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Edit sudoers file</strong>
Read the configuration file, and verify that it contains these lines:</p>

<pre class="highlight plaintext"><code># Allow root to run any commands anywhere &#x000A;root    ALL=(ALL)   ALL&#x000A;</code></pre>

      <p>If the file does not contain these lines, add them and save the file using the VIM <code>:w</code> command.</p>
    </li>
    <li>
      <p><strong>Exit editor</strong>
Exit <code>visudo</code> using the VIM <code>:q</code> command.</p>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured <strong>sudo</strong> to allow use by the <code>root</code> user.</p>

  <h3 id="configuring-virtualization-host-ssh">Configuring Virtualization Host SSH</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt accesses virtualization hosts via SSH. To do this it logs in as the <code>root</code> user using an encrypted key for authentication. You must follow this procedure to ensure that SSH is configured to allow this.</p>

  <p><strong>Warning</strong></p>

  <p>The first time oVirt is connected to the host it will install an authentication key. In the process it will overwrite any existing keys contained in the <code>/root/.ssh/authorized_keys</code> file.</p>

  <p>⁠</p>

  <p><strong>Procedure 7.4. Configuring virtualization host SSH</strong></p>

  <p>All commands in this procedure must be run as the <code>root</code> user.</p>

  <ol>
    <li>
      <p><strong>Install the SSH server (openssh-server)</strong>
Install the openssh-server package using <code>yum</code>.</p>

<pre class="highlight plaintext"><code># yum install openssh-server&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Edit SSH server configuration</strong>
Open the SSH server configuration, <code>/etc/ssh/sshd_config</code>, in a text editor. Search for the <em><code>PermitRootLogin</code></em>.</p>

      <ul>
        <li>If <em><code>PermitRootLogin</code></em> is set to <code>yes</code>, or is not set at all, no further action is required.</li>
        <li>If <em><code>PermitRootLogin</code></em> is set to <code>no</code>, then you must change it to <code>yes</code>.</li>
      </ul>

      <p>Save any changes that you have made to the file, and exit the text editor.</p>
    </li>
    <li>
      <p><strong>Enable the SSH server</strong>
Configure the SSH server to start at system boot using the <code>chkconfig</code> command.</p>

<pre class="highlight plaintext"><code># chkconfig --level 345 sshd on&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Start the SSH server</strong>
Start the SSH, or restart it if it is already running, using the <code>service</code> command.</p>

<pre class="highlight plaintext"><code># service sshd restart&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have configured the virtualization host to allow <code>root</code> access over SSH.</p>

  <h3 id="adding-a-red-hat-enterprise-linux-host">Adding a Red Hat Enterprise Linux Host</h3>

  <p><strong>Summary</strong></p>

  <p>A Red Hat Enterprise Linux host is based on a standard "basic" installation of Red Hat Enterprise Linux. The physical host must be set up before you can add it to the oVirt environment.</p>

  <p>oVirt logs into the host to perform virtualization capability checks, install packages, create a network bridge, and reboot the host. The process of adding a new host can take up to 10 minutes.</p>

  <p>⁠</p>

  <p><strong>Procedure 7.5. Adding a Red Hat Enterprise Linux Host</strong></p>

  <ol>
    <li>Click the <strong>Hosts</strong> resource tab to list the hosts in the results list.</li>
    <li>Click <strong>New</strong> to open the <strong>New Host</strong> window.</li>
    <li>Use the drop-down menus to select the <strong>Data Center</strong> and <strong>Host Cluster</strong> for the new host.</li>
    <li>Enter the <strong>Name</strong>, <strong>Address</strong>, and <strong>SSH Port</strong> of the new host.</li>
    <li>Select an authentication method to use with the host.
      <ul>
        <li>Enter the root user's password to use password authentication.</li>
        <li>Copy the key displayed in the <strong>SSH PublicKey</strong> field to <code>/root/.ssh/authorized_keys</code> on the host to use public key authentication.</li>
      </ul>
    </li>
    <li>You have now completed the mandatory steps to add a Red Hat Enterprise Linux host. Click the <strong>Advanced Parameters</strong> button to expand the advanced host settings.
      <ol>
        <li>Optionally disable automatic firewall configuration.</li>
        <li>Optionally add a host SSH fingerprint to increase security. You can add it manually, or fetch it automatically.</li>
      </ol>
    </li>
    <li>You can configure the <strong>Power Management</strong> and <strong>SPM</strong> using the applicable tabs now; however, as these are not fundamental to adding a Red Hat Enterprise Linux host, they are not covered in this procedure.</li>
    <li>Click <strong>OK</strong> to add the host and close the window.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The new host displays in the list of hosts with a status of <code>Installing</code>. When installation is complete, the status updates to <code>Reboot</code>. The host must be activated for the status to change to <code>Up</code>.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> You can view the progress of the installation in the details pane.</p>

  </div>
  <p>### Explanation of Settings and Controls in the New Host and Edit Host Windows</p>

  <h4 id="host-general-settings-explained"> Host General Settings Explained</h4>

  <p>These settings apply when editing the details of a host or adding new Red Hat Enterprise Linux hosts and Foreman host provider hosts.</p>

  <p>The <strong>General</strong> settings table contains the information required on the <strong>General</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>

  <p>⁠</p>

  <p><strong>Table 7.1. General settings</strong></p>

  <table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Field Name</p></th>
<th align="left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Data Center</strong></p></td>
<td align="left"><p>The data center to which the host belongs. oVirt Node hosts cannot be added to Gluster-enabled clusters.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Host Cluster</strong></p></td>
<td align="left"><p>The cluster to which the host belongs.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Use External Providers</strong></p></td>
<td align="left"><p>Select or clear this check box to view or hide options for adding hosts provided by external providers. Upon selection, a drop-down list of external providers that have been added to oVirt displays. The following options are also available:</p>
<ul>
<li><strong>Provider search filter</strong> - A text field that allows you to search for hosts provided by the selected external provider. This option is provider-specific; see provider documentation for details on forming search queries for specific providers. Leave this field blank to view all available hosts.</li>
<li><strong>External Hosts</strong> - A drop-down list that is populated with the name of hosts provided by the selected external provider. The entries in this list are filtered in accordance with any search queries that have been input in the <strong>Provider search filter</strong>.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Name</strong></p></td>
<td align="left"><p>The name of the cluster. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Comment</strong></p></td>
<td align="left"><p>A field for adding plain text, human-readable comments regarding the host.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Address</strong></p></td>
<td align="left"><p>The IP address, or resolvable hostname of the host.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Password</strong></p></td>
<td align="left"><p>The password of the host's root user. This can only be given when you add the host; it cannot be edited afterwards.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>SSH PublicKey</strong></p></td>
<td align="left"><p>Copy the contents in the text box to the <code>/root/.known_hosts</code> file on the host to use oVirt's ssh key instead of using a password to authenticate with the host.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Automatically configure host firewall</strong></p></td>
<td align="left"><p>When adding a new host, oVirt can open the required ports on the host's firewall. This is enabled by default. This is an <strong>Advanced Parameter</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>SSH Fingerprint</strong></p></td>
<td align="left"><p>You can <strong>fetch</strong> the host's SSH fingerprint, and compare it with the fingerprint you expect the host to return, ensuring that they match. This is an <strong>Advanced Parameter</strong>.</p></td>
</tr>
</tbody>
</table>

  <h4 id="host-power-management-settings-explained"> Host Power Management Settings Explained</h4>

  <p>The <strong>Power Management</strong> settings table contains the information required on the <strong>Power Management</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> windows.</p>

  <p>⁠</p>

  <p><strong>Table 7.2. Power Management Settings</strong></p>

  <table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Field Name</p></th>
<th align="left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Primary/ Secondary</strong></p></td>
<td align="left"><p>Prior to oVirt 3.2, a host with power management configured only recognized one fencing agent. Fencing agents configured on version 3.1 and earlier, and single agents, are treated as primary agents. The secondary option is valid when a second agent is defined.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Concurrent</strong></p></td>
<td align="left"><p>Valid when there are two fencing agents, for example for dual power hosts in which each power switch has two agents connected to the same power switch.</p>
<ul>
<li>If this check box is selected, both fencing agents are used concurrently when a host is fenced. This means that both fencing agents have to respond to the Stop command for the host to be stopped; if one agent responds to the Start command, the host will go up.</li>
<li>If this check box is not selected, the fencing agents are used sequentially. This means that to stop or start a host, the primary agent is used first, and if it fails, the secondary agent is used.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Address</strong></p></td>
<td align="left"><p>The address to access your host's power management device. Either a resolvable hostname or an IP address.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>User Name</strong></p></td>
<td align="left"><p>User account with which to access the power management device. You can set up a user on the device, or use the default user.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Password</strong></p></td>
<td align="left"><p>Password for the user accessing the power management device.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Type</strong></p></td>
<td align="left"><p>The type of power management device in your host. Choose one of the following:</p>
<ul>
<li><strong>apc</strong> - APC MasterSwitch network power switch. Not for use with APC 5.x power switch devices.</li>
<li><strong>apc_snmp</strong> - Use with APC 5.x power switch devices.</li>
<li><strong>bladecenter</strong> - IBM Bladecentre Remote Supervisor Adapter.</li>
<li><strong>cisco_ucs</strong> - Cisco Unified Computing System.</li>
<li><strong>drac5</strong> - Dell Remote Access Controller for Dell computers.</li>
<li><strong>drac7</strong> - Dell Remote Access Controller for Dell computers.</li>
<li><strong>eps</strong> - ePowerSwitch 8M+ network power switch.</li>
<li><strong>hpblade</strong> - HP BladeSystem.</li>
<li><strong>ilo</strong>, <strong>ilo2</strong>, <strong>ilo3</strong>, <strong>ilo4</strong> - HP Integrated Lights-Out.</li>
<li><strong>ipmilan</strong> - Intelligent Platform Management Interface and Sun Integrated Lights Out Management devices.</li>
<li><strong>rsa</strong> - IBM Remote Supervisor Adaptor.</li>
<li><strong>rsb</strong> - Fujitsu-Siemens RSB management interface.</li>
<li><strong>wti</strong> - WTI Network PowerSwitch.</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Port</strong></p></td>
<td align="left"><p>The port number used by the power management device to communicate with the host.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Options</strong></p></td>
<td align="left"><p>Power management device specific options. Enter these as 'key=value' or 'key'. See the documentation of your host's power management device for the options available.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Secure</strong></p></td>
<td align="left"><p>Tick this check box to allow the power management device to connect securely to the host. This can be done via ssh, ssl, or other authentication protocols depending on and supported by the power management agent.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Source</strong></p></td>
<td align="left"><p>Specifies whether the host will search within its <strong>cluster</strong> or <strong>data center</strong> for a fencing proxy. Use the <strong>Up</strong> and <strong>Down</strong> buttons to change the sequence in which the resources are used.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Disable policy control of power management</strong></p></td>
<td align="left"><p>Power management is controlled by the <strong>Cluster Policy</strong> of the host's <strong>cluster</strong>. If power management is enabled and the defined low utilization value is reached, oVirt will power down the host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. Tick this check box to disable policy control.</p></td>
</tr>
</tbody>
</table>

  <h4 id="spm-priority-settings-explained">3. SPM Priority Settings Explained</h4>

  <p>The <strong>SPM</strong> settings table details the information required on the <strong>SPM</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>

  <p>⁠</p>

  <p><strong>Table 7.3. SPM settings</strong></p>

  <table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Field Name</p></th>
<th align="left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>SPM Priority</strong></p></td>
<td align="left"><p>Defines the likelihood that the host will be given the role of Storage Pool Manager(SPM). The options are <strong>Low</strong>, <strong>Normal</strong>, and <strong>High</strong> priority. Low priority means that there is a reduced likelihood of the host being assigned the role of SPM, and High priority means there is an increased likelihood. The default setting is Normal.</p></td>
</tr>
</tbody>
</table>

  <h4 id="host-console-settings-explained">4. Host Console Settings Explained</h4>

  <p>The <strong>Console</strong> settings table details the information required on the <strong>Console</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>

  <p>⁠</p>

  <p><strong>Table 7.4. Console settings</strong></p>

  <table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Field Name</p></th>
<th align="left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Override display address</strong></p></td>
<td align="left"><p>Select this check box to override the display addresses of the host. This feature is useful in a case where the hosts are defined by internal IP and are behind a NAT firewall. When a user connects to a virtual machine from outside of the internal network, instead of returning the private address of the host on which the virtual machine is running, the machine returns a public IP or FQDN (which is resolved in the external network to the public IP).</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Display address</strong></p></td>
<td align="left"><p>The display address specified here will be used for all virtual machines running on this host. The address must be in the format of a fully qualified domain name or IP.</p></td>
</tr>
</tbody>
</table>

  <h2 id="chapter-8-configuring-data-centers">⁠Chapter 8. Configuring Data Centers</h2>

  <h3 id="workflow-progress---planning-your-data-center">Workflow Progress - Planning Your Data Center</h3>

  <p><img alt="" title="images/1194.png" src="/images/images/1194.png" /></p>

  <h3 id="planning-your-data-center">Planning Your Data Center</h3>

  <p>Successful planning is essential for a highly available, scalable oVirt environment.</p>

  <p>Although it is assumed that your solution architect has defined the environment before installation, the following considerations must be made when designing the system.</p>

  <p>CPU</p>

  <p>Virtual Machines must be distributed across hosts so that enough capacity is available to handle higher than average loads during peak processing. Average target utilization will be 50% of available CPU.</p>

  <p>Memory</p>

  <p>The oVirt page sharing process overcommits up to 150% of physical memory for virtual machines. Therefore, allow for an approximately 30% overcommit.</p>

  <p>Networking</p>

  <p>When designing the network, it is important to ensure that the volume of traffic produced by storage, remote connections and virtual machines is taken into account. As a general rule, allow approximately 50 MBps per virtual machine.</p>

  <p>It is best practice to separate disk I/O traffic from end-user traffic, as this reduces the load on the Ethernet connection and reduces security vulnerabilities by isolating data from the visual stream. For Ethernet networks, it is suggested that bonds (802.3ad) are utilized to aggregate server traffic types.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> It is possible to connect both the storage and Hypervisors via a single high performance switch. For this configuration to be effective, the switch must be able to provide 30 GBps on the backplane.</p>

  </div>
  <p>High Availability</p>

  <p>The system requires at least two hosts to achieve high availability. This redundancy is useful when performing maintenance or repairs.</p>

  <h3 id="data-centers-in-ovirt">Data Centers in oVirt</h3>

  <p>The data center is the highest level container for all physical and logical resources within a managed virtual environment. The data center is a collection of clusters of hosts. It owns the logical network (that is, the defined subnets for management, guest network traffic, and storage network traffic) and the storage pool.</p>

  <p>oVirt contains a <code>Default</code> data center at installation. You can create new data centers that will also be managed from the single Administration Portal. For example, you may choose to have different data centers for different physical locations, business units, or for reasons of security. It is recommended that you do not remove the <code>Default</code> data center; instead, set up new appropriately named data centers.</p>

  <p>The system administrator, as the superuser, can manage all aspects of the platform, that is, data centers, storage domains, users, roles, and permissions, by default; however, more specific administrative roles and permissions can be assigned to other users. For example, the enterprise may need a Data Center administrator for a specific data center, or a particular cluster may need an administrator. All system administration roles for physical resources have a hierarchical permission system. For example, a data center administrator will automatically have permission to manage all the objects in that data center - including storage domains, clusters, and hosts.</p>

  <h3 id="creating-a-new-data-center">Creating a New Data Center</h3>

  <p><strong>Summary</strong></p>

  <p>This procedure creates a data center in your virtualization environment. The data center requires a functioning cluster, host, and storage domain to operate.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> The storage <strong>Type</strong> can be edited until the first storage domain is added to the data center. Once a storage domain has been added, the storage <strong>Type</strong> cannot be changed.</p>

    <p>If you set the <strong>Compatibility Version</strong> as <strong>3.1</strong>, it cannot be changed to <strong>3.0</strong> at a later time; version regression is not allowed.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 8.1. Creating a New Data Center</strong></p>

  <ol>
    <li>Select the <strong>Data Centers</strong> resource tab to list all data centers in the results list.</li>
    <li>Click <strong>New</strong> to open the <strong>New Data Center</strong> window.</li>
    <li>Enter the <strong>Name</strong> and <strong>Description</strong> of the data center.</li>
    <li>Select the storage <strong>Type</strong>, <strong>Compatibility Version</strong>, and <strong>Quota Mode</strong> of the data center from the drop-down menus.</li>
    <li>Click <strong>OK</strong> to create the data center and open the <strong>New Data Center - Guide Me</strong> window.</li>
    <li>The <strong>Guide Me</strong> window lists the entities that need to be configured for the data center. Configure these entities or postpone configuration by clicking the <strong>Configure Later</strong> button; configuration can be resumed by selecting the data center and clicking the <strong>Guide Me</strong> button.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The new data center is added to the virtualization environment. It will remain <strong>Uninitialized</strong> until a cluster, host, and storage domain are configured for it; use <strong>Guide Me</strong> to configure these entities.</p>

  <h3 id="changing-the-data-center-compatibility-version">Changing the Data Center Compatibility Version</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt data centers have a compatibility version. The compatibility version indicates the version of oVirt that the data center is intended to be compatible with. All clusters in the data center must support the desired compatibility level.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> To change the data center compatibility version, you must have first updated all the clusters in your data center to a level that supports your desired compatibility level.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 8.2. Changing the Data Center Compatibility Version</strong></p>

  <ol>
    <li>Log in to the Administration Portal as the administrative user. By default this is the <code>admin</code> user.</li>
    <li>Click the <strong>Data Centers</strong> tab.</li>
    <li>Select the data center to change from the list displayed. If the list of data centers is too long to filter visually then perform a search to locate the desired data center.</li>
    <li>Click the <strong>Edit</strong> button.</li>
    <li>Change the <strong>Compatibility Version</strong> to the desired value.</li>
    <li>Click <strong>OK</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have updated the compatibility version of the data center.</p>

  <p><strong>Warning</strong></p>

  <p>Upgrading the compatibility will also upgrade all of the storage domains belonging to the data center. If you are upgrading the compatibility version from below 3.1 to a higher version, these storage domains will become unusable with versions older than 3.1.</p>

  <h2 id="chapter-9-configuring-clusters">⁠Chapter 9. Configuring Clusters</h2>

  <h3 id="clusters-in-ovirt">Clusters in oVirt</h3>

  <p>A cluster is a collection of physical hosts that share similar characteristics and work together to provide computing resources in a highly available manner. In oVirt the cluster must contain physical hosts that share the same storage domains and have the same type of CPU. Because virtual machines can be migrated across hosts in the same cluster, the cluster is the highest level at which power and load-sharing policies can be defined. The oVirt platform contains a <code>Default</code> cluster in the <code>Default</code> data center at installation time.</p>

  <p>Every cluster in the system must belong to a data center, and every host in the system must belong to a cluster. This enables the system to dynamically allocate a virtual machine to any host in the cluster, according to policies defined on the <strong>Cluster</strong> tab, thus maximizing memory and disk space, as well as virtual machine uptime.</p>

  <p>At any given time, after a virtual machine runs on a specific host in the cluster, the virtual machine can be migrated to another host in the cluster using <strong>Migrate</strong>. This can be very useful when a host must be shut down for maintenance. The migration to another host in the cluster is transparent to the user, and the user continues working as usual. Note that a virtual machine cannot be migrated to a host outside the cluster.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> oVirt 3.1 supports the use of clusters to manage Gluster storage bricks, in addition to virtualization hosts. To begin managing Gluster storage bricks, create a cluster with the <strong>Enable Gluster Service</strong> option selected. For further information on Gluster storage bricks, see the <em>Red Hat Storage Administration Guide</em>, available at <a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Storage/"><a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Storage/">https://access.redhat.com/site/documentation/en-US/Red_Hat_Storage/</a></a>.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Note:</strong> oVirt supports <strong>Memory Optimization</strong> by enabling and tuning Kernel Same-page Merging (KSM) on the virtualization hosts in the cluster. For more information on KSM, see the <em>Red Hat Enterprise Linux 6 Virtualization Administration Guide</em>.</p>

  </div>
  <p>### Creating a New Cluster</p>

  <p><strong>Summary</strong></p>

  <p>A data center can contain multiple clusters, and a cluster can contain multiple hosts. All hosts in a cluster must be of the same CPU type (Intel or AMD). It is recommended that you create your hosts before you create your cluster to ensure CPU type optimization. However, you can configure the hosts at a later time using the <strong>Guide Me</strong> button.</p>

  <p>⁠</p>

  <p><strong>Procedure 9.1. Creating a New Cluster</strong></p>

  <ol>
    <li>Select the <strong>Clusters</strong> resource tab.</li>
    <li>Click <strong>New</strong> to open the <strong>New Cluster</strong> window.</li>
    <li>Select the <strong>Data Center</strong> the cluster will belong to from the drop-down list.</li>
    <li>Enter the <strong>Name</strong> and <strong>Description</strong> of the cluster.</li>
    <li>Select the <strong>CPU Name</strong> and <strong>Compatibility Version</strong> from the drop-down lists. It is important to match the CPU processor family with the minimum CPU processor type of the hosts you intend to attach to the cluster, otherwise the host will be non-operational.</li>
    <li>Select either the <strong>Enable Virt Service</strong> or <strong>Enable Gluster Service</strong> radio button to define whether the cluster will be populated with virtual machine hosts or with Gluster-enabled nodes. Note that you cannot add oVirt Node hosts to a Gluster-enabled cluster.</li>
    <li>Click the <strong>Optimization</strong> tab to select the memory page sharing threshold for the cluster, and optionally enable CPU thread handling and memory ballooning on the hosts in the cluster.</li>
    <li>Click the <strong>Cluster Policy</strong> tab to optionally configure a cluster policy, scheduler optimization settings, enable trusted service for hosts in the cluster, and enable HA Reservation.</li>
    <li>Click the <strong>Resilience Policy</strong> tab to select the virtual machine migration policy.</li>
    <li>Click the <strong>Console</strong> tab to optionally override the global SPICE proxy, if any, and specify the address of a SPICE proxy for hosts in the cluster.</li>
    <li>Click <strong>OK</strong> to create the cluster and open the <strong>New Cluster - Guide Me</strong> window.</li>
    <li>The <strong>Guide Me</strong> window lists the entities that need to be configured for the cluster. Configure these entities or postpone configuration by clicking the <strong>Configure Later</strong> button; configuration can be resumed by selecting the cluster and clicking the <strong>Guide Me</strong> button.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The new cluster is added to the virtualization environment.</p>

  <h3 id="changing-the-cluster-compatibility-version">Changing the Cluster Compatibility Version</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt clusters have a compatibility version. The cluster compatibility version indicates the features of oVirt supported by all of the hosts in the cluster. The cluster compatibility is set according to the version of the least capable host operating system in the cluster.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> To change the cluster compatibility version, you must have first updated all the hosts in your cluster to a level that supports your desired compatibility level.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 9.2. Changing the Cluster Compatibility Version</strong></p>

  <ol>
    <li>Log in to the Administration Portal as the administrative user. By default this is the <code>admin</code> user.</li>
    <li>Click the <strong>Clusters</strong> tab.</li>
    <li>Select the cluster to change from the list displayed. If the list of clusters is too long to filter visually then perform a search to locate the desired cluster.</li>
    <li>Click the <strong>Edit</strong> button.</li>
    <li>Change the <strong>Compatibility Version</strong> to the desired value.</li>
    <li>Click <strong>OK</strong> to open the <strong>Change Cluster Compatibility Version</strong> confirmation window.</li>
    <li>Click <strong>OK</strong> to confirm.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have updated the compatibility version of the cluster. Once you have updated the compatibility version of all clusters in a data center, then you are also able to change the compatibility version of the data center itself.</p>

  <p><strong>Warning</strong></p>

  <p>Upgrading the compatibility will also upgrade all of the storage domains belonging to the data center. If you are upgrading the compatibility version from below 3.1 to a higher version, these storage domains will become unusable with versions older than 3.1.</p>

  <h2 id="chapter-10-configuring-networking">⁠Chapter 10. Configuring Networking</h2>

  <h3 id="workflow-progress---network-setup">⁠10.1. Workflow Progress - Network Setup</h3>

  <p><img alt="" title="images/1195.png" src="/images/images/1195.png" /></p>

  <h3 id="networking-in-ovirt">⁠10.2. Networking in oVirt</h3>

  <p>oVirt uses networking to support almost every aspect of operations. Storage, host management, user connections, and virtual machine connectivity, for example, all rely on a well planned and configured network to deliver optimal performance. Setting up networking is a vital prerequisite for a oVirt environment because it is much simpler to plan for your projected networking requirements and implement your network accordingly than it is to discover your networking requirements through use and attempt to alter your network configuration retroactively.</p>

  <p>It is however possible to deploy a oVirt environment with no consideration given to networking at all. Simply ensuring that each physical machine in the environment has at least one <em>Network Interface Controller</em> (NIC) is enough to begin using oVirt. While it is true that this approach to networking will provide a functional environment, it will not provide an optimal environment. As network usage varies by task or action, grouping related tasks or functions into specialized networks can improve performance while simplifying the troubleshooting of network issues.</p>

  <p>oVirt separates network traffic by defining logical networks. Logical networks define the path that a selected network traffic type must take through the network. They are created to isolate network traffic by functionality or virtualize a physical topology.</p>

  <p>The <code>rhevm</code> logical network is created by default and labeled as the <strong>Management</strong>. The <code>rhevm</code> logical network is intended for management traffic between oVirt and virtualization hosts. You are able to define additional logical networks to segregate:</p>

  <ul>
    <li>Display related network traffic.</li>
    <li>General virtual machine network traffic.</li>
    <li>Storage related network traffic.</li>
  </ul>

  <p>For optimal performance it is recommended that these traffic types be separated using logical networks. Logical networks may be supported using physical devices such as NICs or logical devices, such as network bonds. It is not necessary to have one device for each logical network as multiple logical networks are able to share a single device. This is accomplished using Virtual LAN (VLAN) tagging to isolate network traffic. To make use of this facility VLAN tagging must also be supported at the switch level.</p>

  <p>The limits that apply to the number of logical networks that you may define in a oVirt environment are:</p>

  <ul>
    <li>The number of logical networks attached to a host is limited to the number of available network devices combined with the maximum number of Virtual LANs (VLANs) which is 4096.</li>
    <li>The number of logical networks in a cluster is limited to the number of logical networks that can be attached to a host as networking must be the same for all hosts in a cluster.</li>
    <li>The number of logical networks in a data center is limited only by the number of clusters it contains in combination with the number of logical networks permitted per cluster.</li>
  </ul>

  <div class="alert alert-info">
    <p><strong>Note:</strong> From oVirt 3.3, network traffic for migrating virtual machines has been separated from network traffic for communication between oVirt and hosts. This prevents hosts from becoming non-responsive when importing or migrating virtual machines.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Note:</strong> A familiarity with the network concepts and their use is highly recommended when planning and setting up networking in a oVirt environment. This document does not describe the concepts, protocols, requirements or general usage of networking. It is recommended that you read your network hardware vendor's guides for more information on managing networking.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Important:</strong> Additional care must be taken when modifying the properties of the <code>rhevm</code> network. Incorrect changes to the properties of the <code>rhevm</code> network may cause hosts to become temporarily unreachable.</p>

  </div>
  <div class="alert alert-info">
    <p><strong>Important:</strong> If you plan to use oVirt nodes to provide any services, remember that the services will stop if the oVirt environment stops operating.</p>

  </div>
  <p>This applies to all services, but you should be fully aware of the hazards of running the following on oVirt:</p>

  <ul>
    <li>Directory Services</li>
    <li>DNS</li>
    <li>Storage</li>
  </ul>

  <h3 id="creating-logical-networks">⁠10.3. Creating Logical Networks</h3>

  <h4 id="creating-a-new-logical-network-in-a-data-center-or-cluster">⁠10.3.1. Creating a New Logical Network in a Data Center or Cluster</h4>

  <p><strong>Summary</strong></p>

  <p>Create a logical network and define its use in a data center, or in clusters in a data center.</p>

  <p>⁠</p>

  <p><strong>Procedure 10.1. Creating a New Logical Network in a Data Center or Cluster</strong></p>

  <ol>
    <li>Use the <strong>Data Centers</strong> or <strong>Clusters</strong> resource tabs, tree mode, or the search function to find and select a data center or cluster in the results list.</li>
    <li>Click the <strong>Logical Networks</strong> tab of the details pane to list the existing logical networks.</li>
    <li>From the <strong>Data Centers</strong> details pane, click <strong>New</strong> to open the <strong>New Logical Network</strong> window. From the <strong>Clusters</strong> details pane, click <strong>Add Network</strong> to open the <strong>New Logical Network</strong> window.</li>
    <li>Enter a <strong>Name</strong>, <strong>Description</strong> and <strong>Comment</strong> for the logical network.</li>
    <li>In the <strong>Export</strong> section, select the <strong>Create on external provider</strong> check box to create the logical network on an external provider. Select the external provider from the <strong>External Provider</strong> drop-down menu.</li>
    <li>In the <strong>Network Parameters</strong> section, select the <strong>Enable VLAN tagging</strong>, <strong>VM network</strong> and <strong>Override MTU</strong> to enable these options.</li>
    <li>Enter a new label or select an existing label for the logical network in the <strong>Network Label</strong> text field.</li>
    <li>From the <strong>Cluster</strong> tab, select the clusters to which the network will be assigned. You can also specify whether the logical network will be a required network.</li>
    <li>If the <strong>Create on external provider</strong> check box is selected, the <strong>Subnet</strong> tab will be visible. From the <strong>Subnet</strong> tab enter a <strong>Name</strong>, <strong>CIDR</strong> and select an <strong>IP Version</strong> for the subnet that the logical network will provide.</li>
    <li>From the <strong>Profiles</strong> tab, add vNIC profiles to the logical network as required.</li>
    <li>Click <strong>OK</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have defined a logical network as a resource required by a cluster or clusters in the data center. If you entered a label for the logical network, it will be automatically added to all host network interfaces with that label.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> When creating a new logical network or making changes to an existing logical network that is used as a display network, any running virtual machines that use that network must be rebooted before the network becomes available or the changes are applied.</p>

  </div>
  <p>### ⁠10.4. Editing Logical Networks</p>

  <h4 id="editing-host-network-interfaces-and-assigning-logical-networks-to-hosts">⁠10.4.1. Editing Host Network Interfaces and Assigning Logical Networks to Hosts</h4>

  <p><strong>Summary</strong></p>

  <p>You can change the settings of physical host network interfaces, move the management network from one physical host network interface to another, and assign logical networks to physical host network interfaces.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> You cannot assign logical networks offered by external providers to physical host network interfaces; such networks are dynamically assigned to hosts as they are required by virtual machines.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 10.2. Editing Host Network Interfaces and Assigning Logical Networks to Hosts</strong></p>

  <ol>
    <li>Use the <strong>Hosts</strong> resource tab, tree mode, or the search function to find and select the host in the results.</li>
    <li>Click the <strong>Network Interfaces</strong> tab in the details pane.</li>
    <li>
      <p>Click the <strong>Setup Host Networks</strong> button to open the <strong>Setup Host Networks</strong> window.
⁠</p>

      <p><img alt="The Setup Host Networks window" title="The Setup Host Networks window" src="/images/images/4768.png" /></p>

      <p><strong>Figure 10.1. The Setup Host Networks window</strong></p>
    </li>
    <li>Attach a logical network to a physical host network interface by selecting and dragging the logical network into the <strong>Assigned Logical Networks</strong> area next to the physical host network interface. Alternatively, right-click the logical network and select a network interface from the drop-down menu.</li>
    <li>Configure the logical network:
      <ol>
        <li>Hover your cursor over an assigned logical network and click the pencil icon to open the <strong>Edit Management Network</strong> window.</li>
        <li>Select a <strong>Boot Protocol</strong> from:
          <ul>
            <li><strong>None</strong>,</li>
            <li><strong>DHCP</strong>, or</li>
            <li><strong>Static</strong>. If you selected <strong>Static</strong>, enter the <strong>IP</strong>, <strong>Subnet Mask</strong>, and the <strong>Gateway</strong>.</li>
          </ul>
        </li>
        <li>Click <strong>OK</strong>.</li>
        <li>If your logical network definition is not synchronized with the network configuration on the host, select the <strong>Sync network</strong> check box.</li>
      </ol>
    </li>
    <li>Select the <strong>Verify connectivity between Host and Engine</strong> check box to check network connectivity; this action will only work if the host is in maintenance mode.</li>
    <li>Select the <strong>Save network configuration</strong> check box to make the changes persistent when the environment is rebooted.</li>
    <li>Click <strong>OK</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have assigned logical networks to and configured a physical host network interface.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> If not all network interface cards for the host are displayed, click the <strong>Refresh Capabilities</strong> button to update the list of network interface cards available for that host.</p>

  </div>
  <p>#### ⁠10.4.2. Logical Network General Settings Explained</p>

  <p>The table below describes the settings for the <strong>General</strong> tab of the <strong>New Logical Network</strong> and <strong>Edit Logical Network</strong> window.</p>

  <p>⁠</p>

  <p><strong>Table 10.1. New Logical Network and Edit Logical Network Settings</strong></p>

  <table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Field Name</p></th>
<th align="left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Name</strong></p></td>
<td align="left"><p>The name of the logical network. This text field has a 15-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Description</strong></p></td>
<td align="left"><p>The description of the logical network. This text field has a 40-character limit.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Comment</strong></p></td>
<td align="left"><p>A field for adding plain text, human-readable comments regarding the logical network.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Create on external provider</strong></p></td>
<td align="left"><p>Allows you to create the logical network to an OpenStack Networking instance that has been added to oVirt as an external provider. <strong>External Provider</strong> - Allows you to select the external provider on which the logical network will be created.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Enable VLAN tagging</strong></p></td>
<td align="left"><p>VLAN tagging is a security feature that gives all network traffic carried on the logical network a special characteristic. VLAN-tagged traffic cannot be read by interfaces that do not also have that characteristic. Use of VLANs on logical networks also allows a single network interface to be associated with multiple, differently VLAN-tagged logical networks. Enter a numeric value in the text entry field if VLAN tagging is enabled.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>VM Network</strong></p></td>
<td align="left"><p>Select this option if only virtual machines use this network. If the network is used for traffic that does not involve virtual machines, such as storage communications, do not select this check box.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Override MTU</strong></p></td>
<td align="left"><p>Set a custom maximum transmission unit for the logical network. You can use this to match the maximum transmission unit supported by your new logical network to the maximum transmission unit supported by the hardware it interfaces with. Enter a numeric value in the text entry field if <strong>Override MTU</strong> is selected.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Network Label</strong></p></td>
<td align="left"><p>Allows you to specify a new label for the network or select from a existing labels already attached to host network interfaces. If you select an existing label, the logical network will be automatically assigned to all host network interfaces with that label.</p></td>
</tr>
</tbody>
</table>

  <h4 id="editing-a-logical-network">⁠10.4.3. Editing a Logical Network</h4>

  <p><strong>Summary</strong></p>

  <p>Edit the settings of a logical network.</p>

  <p>⁠</p>

  <p><strong>Procedure 10.3. Editing a Logical Network</strong></p>

  <ol>
    <li>Use the <strong>Data Centers</strong> resource tab, tree mode, or the search function to find and select the data center of the logical network in the results list.</li>
    <li>Click the <strong>Logical Networks</strong> tab in the details pane to list the logical networks in the data center.</li>
    <li>Select a logical network and click <strong>Edit</strong> to open the <strong>Edit Logical Network</strong> window.</li>
    <li>Edit the necessary settings.</li>
    <li>Click <strong>OK</strong> to save the changes.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have updated the settings of your logical network.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> Multi-host network configuration is available on data centers with 3.1-or-higher compatibility, and automatically applies updated network settings to all of the hosts within the data center to which the network is assigned. Changes can only be applied when virtual machines using the network are down. You cannot rename a logical network that is already configured on a host. You cannot disable the <strong>VM Network</strong> option while virtual machines or templates using that network are running.</p>

  </div>
  <p>#### ⁠10.4.4. Explanation of Settings in the Manage Networks Window</p>

  <p>The table below describes the settings for the <strong>Manage Networks</strong> window.</p>

  <p>⁠</p>

  <p><strong>Table 10.2. Manage Networks Settings</strong></p>

  <table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><p>Field</p></th>
<th align="left"><p>Description/Action</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Assign</strong></p></td>
<td align="left"><p>Assigns the logical network to all hosts in the cluster.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Required</strong></p></td>
<td align="left"><p>A Network marked &quot;required&quot; must remain operational in order for the hosts associated with it to function properly. If a required network ceases to function, any hosts associated with it become non-operational.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>VM Network</strong></p></td>
<td align="left"><p>A logical network marked &quot;VM Network&quot; carries network traffic relevant to the virtual machine network.</p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Display Network</strong></p></td>
<td align="left"><p>A logical network marked &quot;Display Network&quot; carries network traffic relevant to SPICE and to the virtual network controller.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Migration Network</strong></p></td>
<td align="left"><p>A logical network marked &quot;Migration Network&quot; carries virtual machine and storage migration traffic.</p></td>
</tr>
</tbody>
</table>

  <h4 id="using-the-networks-tab">⁠10.4.5. Using the Networks Tab</h4>

  <p>The <strong>Networks</strong> resource tab provides a central location for users to perform network-related operations and search for networks based on each network's property or association with other resources.</p>

  <p>All networks in the oVirt environment display in the results list of the <strong>Networks</strong> tab. The <strong>New</strong>, <strong>Edit</strong> and <strong>Remove</strong> buttons allow you to create, change the properties of, and delete logical networks within data centers.</p>

  <p>Click on each network name and use the <strong>Clusters</strong>, <strong>Hosts</strong>, <strong>Virtual Machines</strong>, <strong>Templates</strong>, and <strong>Permissions</strong> tabs in the details pane to perform functions including:</p>

  <ul>
    <li>Attaching or detaching the networks to clusters and hosts</li>
    <li>Removing network interfaces from virtual machines and templates</li>
    <li>Adding and removing permissions for users to access and manage networks</li>
  </ul>

  <p>These functions are also accessible through each individual resource tab.</p>

  <h3 id="removing-logical-networks">⁠10.5. Removing Logical Networks</h3>

  <h4 id="removing-a-logical-network">⁠10.5.1. Removing a Logical Network</h4>

  <p><strong>Summary</strong></p>

  <p>Remove a logical network from oVirt.</p>

  <p>⁠</p>

  <p><strong>Procedure 10.4. Removing Logical Networks</strong></p>

  <ol>
    <li>Use the <strong>Data Centers</strong> resource tab, tree mode, or the search function to find and select the data center of the logical network in the results list.</li>
    <li>Click the <strong>Logical Networks</strong> tab in the details pane to list the logical networks in the data center.</li>
    <li>Select a logical network and click <strong>Remove</strong> to open the <strong>Remove Logical Network(s)</strong> window.</li>
    <li>Optionally, select the <strong>Remove external network(s) from the provider(s) as well</strong> check box to remove the logical network both from oVirt and from the external provider if the network is provided by an external provider.</li>
    <li>Click <strong>OK</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The logical network is removed from oVirt and is no longer available. If the logical network was provided by an external provider and you elected to remove the logical network from that external provider, it is removed from the external provider and is no longer available on that external provider as well.</p>

  <h2 id="chapter-11-configuring-storage">⁠Chapter 11. Configuring Storage</h2>

  <h3 id="workflow-progress---storage-setup">⁠11.1. Workflow Progress - Storage Setup</h3>

  <p><img alt="" title="images/1197.png" src="/images/images/1197.png" /></p>

  <h3 id="introduction-to-storage-in-ovirt">⁠11.2. Introduction to Storage in oVirt</h3>

  <p>oVirt uses a centralized storage system for virtual machine disk images, ISO files and snapshots. Storage networking can be implemented using:</p>

  <ul>
    <li>Network File System (NFS)</li>
    <li>GlusterFS exports</li>
    <li>Other POSIX compliant file systems</li>
    <li>Internet Small Computer System Interface (iSCSI)</li>
    <li>Local storage attached directly to the virtualization hosts</li>
    <li>Fibre Channel Protocol (FCP)</li>
    <li>Parallel NFS (pNFS)</li>
  </ul>

  <p>Setting up storage is a prerequisite for a new data center because a data center cannot be initialized unless storage domains are attached and activated.</p>

  <p>As a oVirt system administrator, you need to create, configure, attach and maintain storage for the virtualized enterprise. You should be familiar with the storage types and their use. Read your storage array vendor's guides, and refer to the <em>Red Hat Enterprise Linux Storage Administration Guide</em> for more information on the concepts, protocols, requirements or general usage of storage.</p>

  <p>The oVirt platform enables you to assign and manage storage using the Administration Portal's <strong>Storage</strong> tab. The <strong>Storage</strong> results list displays all the storage domains, and the details pane shows general information about the domain.</p>

  <p>oVirt platform has three types of storage domains:</p>

  <ul>
    <li><strong>Data Domain:</strong> A data domain holds the virtual hard disks and OVF files of all the virtual machines and templates in a data center. In addition, snapshots of the virtual machines are also stored in the data domain. The data domain cannot be shared across data centers. Storage domains of multiple types (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center, provided they are all shared, rather than local, domains. You must attach a data domain to a data center before you can attach domains of other types to it.</li>
    <li><strong>ISO Domain:</strong> ISO domains store ISO files (or logical CDs) used to install and boot operating systems and applications for the virtual machines. An ISO domain removes the data center's need for physical media. An ISO domain can be shared across different data centers.</li>
    <li>
      <p><strong>Export Domain:</strong> Export domains are temporary storage repositories that are used to copy and move images between data centers and oVirt environments. Export domains can be used to backup virtual machines. An export domain can be moved between data centers, however, it can only be active in one data center at a time.
<strong>Important</strong></p>

      <p>Support for export storage domains backed by storage on anything other than NFS is being deprecated. While existing export storage domains imported from oVirt 2.2 environments remain supported new export storage domains must be created on NFS storage.</p>
    </li>
  </ul>

  <p>Only commence configuring and attaching storage for your oVirt environment once you have determined the storage needs of your data center(s).</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> To add storage domains you must be able to successfully access the Administration Portal, and there must be at least one host connected with a status of <strong>Up</strong>.</p>

  </div>
  <p>### ⁠11.3. Preparing NFS Storage</p>

  <p><strong>Summary</strong></p>

  <p>These steps must be taken to prepare an NFS file share on a server running Red Hat Enterprise Linux 6 for use with oVirt.</p>

  <p>⁠</p>

  <p><strong>Procedure 11.1. Preparing NFS Storage</strong></p>

  <ol>
    <li>
      <p><strong>Install nfs-utils</strong>
NFS functionality is provided by the nfs-utils package. Before file shares can be created, check that the package is installed by querying the RPM database for the system:</p>

<pre class="highlight plaintext"><code>$ rpm -qi nfs-utils&#x000A;</code></pre>

      <p>If the nfs-utils package is installed then the package information will be displayed. If no output is displayed then the package is not currently installed. Install it using <code>yum</code> while logged in as the <code>root</code> user:</p>

<pre class="highlight plaintext"><code># yum install nfs-utils&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Configure Boot Scripts</strong>
To ensure that NFS shares are always available when the system is operational both the <code>nfs</code> and <code>rpcbind</code> services must start at boot time. Use the <code>chkconfig</code> command while logged in as <code>root</code> to modify the boot scripts.</p>

<pre class="highlight plaintext"><code># chkconfig --add rpcbind&#x000A;# chkconfig --add nfs&#x000A;# chkconfig rpcbind on&#x000A;# chkconfig nfs on&#x000A;</code></pre>

      <p>Once the boot script configuration has been done, start the services for the first time.</p>

<pre class="highlight plaintext"><code># service rpcbind start&#x000A;# service nfs start&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Create Directory</strong>
Create the directory you wish to share using NFS.</p>

<pre class="highlight plaintext"><code># mkdir /exports/iso&#x000A;</code></pre>

      <p>Replace <em>/exports/iso</em> with the name, and path of the directory you wish to use.</p>
    </li>
    <li>
      <p><strong>Export Directory</strong>
To be accessible over the network using NFS the directory must be exported. NFS exports are controlled using the <code>/etc/exports</code> configuration file. Each export path appears on a separate line followed by a tab character and any additional NFS options. Exports to be attached to oVirt must have the read, and write, options set.</p>

      <p>To grant read, and write access to <code>/exports/iso</code> using NFS for example you add the following line to the <code>/etc/exports</code> file.</p>

<pre class="highlight plaintext"><code>/exports/iso       *(rw)&#x000A;</code></pre>

      <p>Again, replace <em>/exports/iso</em> with the name, and path of the directory you wish to use.</p>
    </li>
    <li>
      <p><strong>Reload NFS Configuration</strong>
For the changes to the <code>/etc/exports</code> file to take effect the service must be told to reload the configuration. To force the service to reload the configuration run the following command as <code>root</code>:</p>

<pre class="highlight plaintext"><code># service nfs reload&#x000A;</code></pre>
    </li>
    <li>
      <p><strong>Set Permissions</strong>
The NFS export directory must be configured for read write access and must be owned by vdsm:kvm. If these users do not exist on your external NFS server use the following command, assuming that <code>/exports/iso</code> is the directory to be used as an NFS share.</p>

<pre class="highlight plaintext"><code># chown -R 36:36 /exports/iso&#x000A;</code></pre>

      <p>The permissions on the directory must be set to allow read and write access to the owner, and read and execute access to the group and other users. The owner will also have execute access to the directory. The permissions are set using the <code>chmod</code> command. The following command arguments set the required permissions on the <code>/exports/iso</code> directory.</p>

<pre class="highlight plaintext"><code># chmod 0755 /exports/iso&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The NFS file share has been created, and is ready to be attached by oVirt.</p>

  <h3 id="attaching-nfs-storage">⁠11.4. Attaching NFS Storage</h3>

  <p><strong>Summary</strong></p>

  <p>An NFS type <strong>Storage Domain</strong> is a mounted NFS share that is attached to a data center. It is used to provide storage for virtualized guest images and ISO boot media. Once NFS storage has been exported it must be attached to oVirt using the Administration Portal.</p>

  <p>NFS data domains can be added to NFS data centers. You can add NFS, ISO, and export storage domains to data centers of any type.</p>

  <p>⁠</p>

  <p><strong>Procedure 11.2. Attaching NFS Storage</strong></p>

  <ol>
    <li>Click the <strong>Storage</strong> resource tab to list the existing storage domains.</li>
    <li>
      <p>Click <strong>New Domain</strong> to open the <strong>New Domain</strong> window.
⁠</p>

      <p><img alt="NFS Storage" title="NFS Storage" src="/images/images/1097.png" /></p>

      <p><strong>Figure 11.1. NFS Storage</strong></p>
    </li>
    <li>Enter the <strong>Name</strong> of the storage domain.</li>
    <li>Select the <strong>Data Center</strong>, <strong>Domain Function / Storage Type</strong>, and <strong>Use Host</strong> from the drop-down menus. If applicable, select the <strong>Format</strong> from the drop-down menu.</li>
    <li>Enter the <strong>Export Path</strong> to be used for the storage domain. The export path should be in the format of <code>192.168.0.10:/data or domain.example.com:/data</code></li>
    <li>
      <p>Click <strong>Advanced Parameters</strong> to enable further configurable settings. It is recommended that the values of these parameters not be modified.
<strong>Important</strong></p>

      <p>All communication to the storage domain is from the selected host and not directly from oVirt. At least one active host must be attached to the chosen Data Center before the storage is configured.</p>
    </li>
    <li>Click <strong>OK</strong> to create the storage domain and close the window.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The new NFS data domain is displayed on the <strong>Storage</strong> tab with a status of <code>Locked</code> while the disk prepares. It is automatically attached to the data center upon completion.</p>

  <h3 id="adding-iscsi-storage">⁠11.5. Adding iSCSI Storage</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt platform supports iSCSI storage by creating a storage domain from a volume group made of pre-existing LUNs. Neither volume groups nor LUNs can be attached to more than one storage domain at a time.</p>

  <p>For information regarding the setup and configuration of iSCSI on Red Hat Enterprise Linux, see the <em>Red Hat Enterprise Linux Storage Administration Guide</em>.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> You can only add an iSCSI storage domain to a data center that is set up for iSCSI storage type.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 11.3. Adding iSCSI Storage</strong></p>

  <ol>
    <li>Click the <strong>Storage</strong> resource tab to list the existing storage domains in the results list.</li>
    <li>Click the <strong>New Domain</strong> button to open the <strong>New Domain</strong> window.</li>
    <li>
      <p>Enter the <strong>Name</strong> of the new storage domain.
⁠</p>

      <p><img alt="New iSCSI Domain" title="New iSCSI Domain" src="/images/images/5590.png" /></p>

      <p><strong>Figure 11.2. New iSCSI Domain</strong></p>
    </li>
    <li>Use the <strong>Data Center</strong> drop-down menu to select an iSCSI data center. If you do not yet have an appropriate iSCSI data center, select <code>(none)</code>.</li>
    <li>Use the drop-down menus to select the <strong>Domain Function / Storage Type</strong> and the <strong>Format</strong>. The storage domain types that are not compatible with the chosen data center are not available.</li>
    <li>
      <p>Select an active host in the <strong>Use Host</strong> field. If this is not the first data domain in a data center, you must select the data center's SPM host.
<strong>Important</strong></p>

      <p>All communication to the storage domain is via the selected host and not directly from oVirt. At least one active host must exist in the system, and be attached to the chosen data center, before the storage is configured.</p>
    </li>
    <li>
      <p>oVirt is able to map either iSCSI targets to LUNs, or LUNs to iSCSI targets. The <strong>New Domain</strong> window automatically displays known targets with unused LUNs when iSCSI is selected as the storage type. If the target that you are adding storage from is not listed then you can use target discovery to find it, otherwise proceed to the next step.
<strong>iSCSI Target Discovery</strong></p>

      <ol>
        <li>
          <p>Click <strong>Discover Targets</strong> to enable target discovery options. When targets have been discovered and logged in to, the <strong>New Domain</strong> window automatically displays targets with LUNs unused by the environment.
<strong>Note</strong></p>

          <p>LUNs used externally to the environment are also displayed.</p>

          <p>You can use the <strong>Discover Targets</strong> options to add LUNs on many targets, or multiple paths to the same LUNs.</p>
        </li>
        <li>Enter the fully qualified domain name or IP address of the iSCSI host in the <strong>Address</strong> field.</li>
        <li>Enter the port to connect to the host on when browsing for targets in the <strong>Port</strong> field. The default is <code>3260</code>.</li>
        <li>If the Challenge Handshake Authentication Protocol (CHAP) is being used to secure the storage, select the <strong>User Authentication</strong> check box. Enter the <strong>CHAP user name</strong> and <strong>CHAP password</strong>.</li>
        <li>Click the <strong>Discover</strong> button.</li>
        <li>Select the target to use from the discovery results and click the <strong>Login</strong> button. Alternatively, click the <strong>Login All</strong> to log in to all of the discovered targets.</li>
      </ol>
    </li>
    <li>Click the <strong>+</strong> button next to the desired target. This will expand the entry and display all unused LUNs attached to the target.</li>
    <li>Select the check box for each LUN that you are using to create the storage domain.</li>
    <li>Click <strong>OK</strong> to create the storage domain and close the window.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The new iSCSI storage domain displays on the storage tab. This can take up to 5 minutes.</p>

  <h3 id="adding-fcp-storage">⁠11.6. Adding FCP Storage</h3>

  <p><strong>Summary</strong></p>

  <p>oVirt platform supports SAN storage by creating a storage domain from a volume group made of pre-existing LUNs. Neither volume groups nor LUNs can be attached to more than one storage domain at a time.</p>

  <p>oVirt system administrators need a working knowledge of Storage Area Networks (SAN) concepts. SAN usually uses Fibre Channel Protocol (FCP) for traffic between hosts and shared external storage. For this reason, SAN may occasionally be referred to as FCP storage.</p>

  <p>For information regarding the setup and configuration of FCP or multipathing on Red Hat Enterprise Linux, please refer to the <em>Storage Administration Guide</em> and <em>DM Multipath Guide</em>.</p>

  <div class="alert alert-info">
    <p><strong>Note:</strong> You can only add an FCP storage domain to a data center that is set up for FCP storage type.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 11.4. Adding FCP Storage</strong></p>

  <ol>
    <li>Click the <strong>Storage</strong> resource tab to list all storage domains in the virtualized environment.</li>
    <li>Click <strong>New Domain</strong> to open the <strong>New Domain</strong> window.</li>
    <li>
      <p>Enter the <strong>Name</strong> of the storage domain
⁠</p>

      <p><img alt="Adding FCP Storage" title="Adding FCP Storage" src="/images/images/5591.png" /></p>

      <p><strong>Figure 11.3. Adding FCP Storage</strong></p>
    </li>
    <li>Use the <strong>Data Center</strong> drop-down menu to select an FCP data center. If you do not yet have an appropriate FCP data center, select <code>(none)</code>.</li>
    <li>Use the drop-down menus to select the <strong>Domain Function / Storage Type</strong> and the <strong>Format</strong>. The storage domain types that are not compatible with the chosen data center are not available.</li>
    <li>
      <p>Select an active host in the <strong>Use Host</strong> field. If this is not the first data domain in a data center, you must select the data center's SPM host.
<strong>Important</strong></p>

      <p>All communication to the storage domain is via the selected host and not directly from oVirt. At least one active host must exist in the system, and be attached to the chosen data center, before the storage is configured.</p>
    </li>
    <li>The <strong>New Domain</strong> window automatically displays known targets with unused LUNs when <strong>Data / Fibre Channel</strong> is selected as the storage type. Select the <strong>LUN ID</strong> check box to select all of the available LUNs.</li>
    <li>Click <strong>OK</strong> to create the storage domain and close the window.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The new FCP data domain displays on the <strong>Storage</strong> tab. It will remain with a <code>Locked</code> status while it is being prepared for use. When ready, it is automatically attached to the data center.</p>

  <h3 id="preparing-local-storage">⁠11.7. Preparing Local Storage</h3>

  <p><strong>Summary</strong></p>

  <p>A local storage domain can be set up on a host. When you set up host to use local storage, the host automatically gets added to a new data center and cluster that no other hosts can be added to. Multiple host clusters require that all hosts have access to all storage domains, which is not possible with local storage. Virtual machines created in a single host cluster cannot be migrated, fenced or scheduled.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> On oVirt Nodes the only path permitted for use as local storage is <code>/data/images</code>. This directory already exists with the correct permissions on Hypervisor installations. The steps in this procedure are only required when preparing local storage on Red Hat Enterprise Linux virtualization hosts.</p>

  </div>
  <p>⁠</p>

  <p><strong>Procedure 11.5. Preparing Local Storage</strong></p>

  <ol>
    <li>
      <p>On the virtualization host, create the directory to be used for the local storage.
    # mkdir -p /data/images</p>
    </li>
    <li>
      <p>Ensure that the directory has permissions allowing read/write access to the <code>vdsm</code> user (UID 36) and <code>kvm</code> group (GID 36).
    # chown 36:36 /data /data/images</p>

<pre class="highlight plaintext"><code># chmod 0755 /data /data/images&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>Your local storage is ready to be added to the oVirt environment.</p>

  <h3 id="adding-local-storage">⁠11.8. Adding Local Storage</h3>

  <p><strong>Summary</strong></p>

  <p>Storage local to your host has been prepared. Now use oVirt to add it to the host.</p>

  <p>Adding local storage to a host in this manner causes the host to be put in a new data center and cluster. The local storage configuration window combines the creation of a data center, a cluster, and storage into a single process.</p>

  <p>⁠</p>

  <p><strong>Procedure 11.6. Adding Local Storage</strong></p>

  <ol>
    <li>Use the <strong>Hosts</strong> resource tab, tree mode, or the search function to find and select the host in the results list.</li>
    <li>Click <strong>Maintenance</strong> to open the <strong>Maintenance Host(s)</strong> confirmation window.</li>
    <li>Click <strong>OK</strong> to initiate maintenance mode.</li>
    <li>
      <p>Click <strong>Configure Local Storage</strong> to open the <strong>Configure Local Storage</strong> window.
⁠</p>

      <p><img alt="Configure Local Storage Window" title="Configure Local Storage Window" src="/images/images/5592.png" /></p>

      <p><strong>Figure 11.4. Configure Local Storage Window</strong></p>
    </li>
    <li>Click the <strong>Edit</strong> buttons next to the <strong>Data Center</strong>, <strong>Cluster</strong>, and <strong>Storage</strong> fields to configure and name the local storage domain.</li>
    <li>Set the path to your local storage in the text entry field.</li>
    <li>If applicable, select the <strong>Optimization</strong> tab to configure the memory optimization policy for the new local storage cluster.</li>
    <li>Click <strong>OK</strong> to save the settings and close the window.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>Your host comes online in a data center of its own.</p>

  <h3 id="posix-compliant-file-system-storage-in-ovirt">⁠11.9. POSIX Compliant File System Storage in oVirt</h3>

  <p>oVirt 3.1 and higher supports the use of POSIX (native) file systems for storage. POSIX file system support allows you to mount file systems using the same mount options that you would normally use when mounting them manually from the command line. This functionality is intended to allow access to storage not exposed using NFS, iSCSI, or FCP.</p>

  <p>Any POSIX compliant filesystem used as a storage domain in oVirt <strong>MUST</strong> support sparse files and direct I/O. The Common Internet File System (CIFS), for example, does not support direct I/O, making it incompatible with oVirt.</p>

  <div class="alert alert-info">
    <p><strong>Important:</strong> Do <em>not</em> mount NFS storage by creating a POSIX compliant file system Storage Domain. Always create an NFS Storage Domain instead.</p>

  </div>
  <p>### ⁠11.10. Attaching POSIX Compliant File System Storage</p>

  <p><strong>Summary</strong></p>

  <p>You want to use a POSIX compliant file system that is not exposed using NFS, iSCSI, or FCP as a storage domain.</p>

  <p>⁠</p>

  <p><strong>Procedure 11.7. Attaching POSIX Compliant File System Storage</strong></p>

  <ol>
    <li>Click the <strong>Storage</strong> resource tab to list the existing storage domains in the results list.</li>
    <li>
      <p>Click <strong>New Domain</strong> to open the <strong>New Domain</strong> window.
⁠</p>

      <p><img alt="POSIX Storage" title="POSIX Storage" src="/images/images/5597.png" /></p>

      <p><strong>Figure 11.5. POSIX Storage</strong></p>
    </li>
    <li>Enter the <strong>Name</strong> for the storage domain.</li>
    <li>Select the <strong>Data Center</strong> to be associated with the storage domain. The Data Center selected must be of type <strong>POSIX (POSIX compliant FS)</strong>. Alternatively, select <code>(none)</code>.</li>
    <li>Select <code>Data / POSIX compliant FS</code> from the <strong>Domain Function / Storage Type</strong> drop-down menu. If applicable, select the <strong>Format</strong> from the drop-down menu.</li>
    <li>Select a host from the <strong>Use Host</strong> drop-down menu. Only hosts within the selected data center will be listed. The host that you select will be used to connect the storage domain.</li>
    <li>Enter the <strong>Path</strong> to the POSIX file system, as you would normally provide it to the <code>mount</code> command.</li>
    <li>Enter the <strong>VFS Type</strong>, as you would normally provide it to the <code>mount</code> command using the <em><code>-t</code></em> argument. See <code>man mount</code> for a list of valid VFS types.</li>
    <li>Enter additional <strong>Mount Options</strong>, as you would normally provide them to the <code>mount</code> command using the <em><code>-o</code></em> argument. The mount options should be provided in a comma-separated list. See <code>man mount</code> for a list of valid mount options.</li>
    <li>Click <strong>OK</strong> to attach the new Storage Domain and close the window.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>You have used a supported mechanism to attach an unsupported file system as a storage domain.</p>

  <h3 id="enabling-gluster-processes-on-red-hat-storage-nodes">⁠11.11. Enabling Gluster Processes on Red Hat Storage Nodes</h3>

  <p><strong>Summary</strong></p>

  <p>This procedure explains how to allow Gluster processes on Red Hat Storage Nodes.</p>

  <ol>
    <li>In the Navigation Pane, select the <strong>Clusters</strong> tab.</li>
    <li>Select <strong>New</strong>.</li>
    <li>
      <p>Select the "Enable Gluster Service" radio button. Provide the address, SSH fingerprint, and password as necessary. The address and password fields can be filled in only when the <strong>Import existing Gluster configuration</strong> check box is selected.
⁠</p>

      <p><img alt="Description" title="Description" src="/images/images/4539.png" /></p>

      <p><strong>Figure 11.6. Selecting the "Enable Gluster Service" Radio Button</strong></p>
    </li>
    <li>Click <strong>OK</strong>.</li>
  </ol>

  <p><strong>Result</strong></p>

  <p>It is now possible to add Red Hat Storage nodes to the Gluster cluster, and to mount Gluster volumes as storage domains. <strong>iptables</strong> rules no longer block storage domains from being added to the cluster.</p>

  <h3 id="populating-the-iso-storage-domain">⁠11.12. Populating the ISO Storage Domain</h3>

  <p><strong>Summary</strong></p>

  <p>An ISO storage domain is attached to a data center, ISO images must be uploaded to it. oVirt provides an ISO uploader tool that ensures that the images are uploaded into the correct directory path, with the correct user permissions.</p>

  <p>The creation of ISO images from physical media is not described in this document. It is assumed that you have access to the images required for your environment.</p>

  <p>⁠</p>

  <p><strong>Procedure 11.8. Populating the ISO Storage Domain</strong></p>

  <ol>
    <li>Copy the required ISO image to a temporary directory on the system running oVirt.</li>
    <li>Log in to the system running oVirt as the <code>root</code> user.</li>
    <li>
      <p>Use the <code>engine-iso-uploader</code> command to upload the ISO image. This action will take some time, the amount of time varies depending on the size of the image being uploaded and available network bandwidth.
⁠</p>

      <p><strong>Example 11.1. ISO Uploader Usage</strong></p>

      <p>In this example the ISO image <code>RHEL6.iso</code> is uploaded to the ISO domain called <code>ISODomain</code> using NFS. The command will prompt for an administrative user name and password. The user name must be provided in the form <em>user name</em>@<em>domain</em>.</p>

<pre class="highlight plaintext"><code># engine-iso-uploader --iso-domain=ISODomain upload RHEL6.iso&#x000A;</code></pre>
    </li>
  </ol>

  <p><strong>Result</strong></p>

  <p>The ISO image is uploaded and appears in the ISO storage domain specified. It is also available in the list of available boot media when creating virtual machines in the data center which the storage domain is attached to.</p>

  <h3 id="virtio-and-guest-tool-image-files">⁠11.13. VirtIO and Guest Tool Image Files</h3>

  <p>The virtio-win ISO and Virtual Floppy Drive (VFD) images, which contain the VirtIO drivers for Windows virtual machines, and the rhev-tools-setup ISO, which contains the oVirt Guest Tools for Windows virtual machines, are copied to an ISO storage domain upon installation and configuration of the domain.</p>

  <p>These image files provide software that can be installed on virtual machines to improve performance and usability. The most recent virtio-win and rhev-tools-setup files can be accessed via the following symbolic links on the file system of oVirt:</p>

  <ul>
    <li><code>/usr/share/virtio-win/virtio-win.iso</code></li>
    <li><code>/usr/share/virtio-win/virtio-win_x86.vfd</code></li>
    <li><code>/usr/share/virtio-win/virtio-win_amd64.vfd</code></li>
    <li><code>/usr/share/rhev-guest-tools-iso/rhev-tools-setup.iso</code></li>
  </ul>

  <p>These image files must be manually uploaded to ISO storage domains that were not created locally by the installation process. Use the <code>engine-iso-uploader</code> command to upload these images to your ISO storage domain. Once uploaded, the image files can be attached to and used by virtual machines.</p>

  <h3 id="uploading-the-virtio-and-guest-tool-image-files-to-an-iso-storage-domain">⁠11.14. Uploading the VirtIO and Guest Tool Image Files to an ISO Storage Domain</h3>

  <p>The example below demonstrates the command to upload the <code>virtio-win.iso</code>, <code>virtio-win_x86.vfd</code>, <code>virtio-win_amd64.vfd</code>, and <code>rhev-tools-setup.iso</code> image files to the <code>ISODomain</code>.</p>

  <p>⁠</p>

  <p><strong>Example 11.2. Uploading the VirtIO and Guest Tool Image Files</strong></p>

<pre class="highlight plaintext"><code># engine-iso-uploader --iso-domain=[ISODomain] upload /usr/share/virtio-win/virtio-win.iso /usr/share/virtio-win/virtio-win_x86.vfd /usr/share/virtio-win/virtio-win_amd64.vfd /usr/share/rhev-guest-tools-iso/rhev-tools-setup.iso&#x000A;</code></pre>

  <p><a href="#idm268262237872">Compiler Glossary</a></p>

  <p>⁠</p>

  <p><strong>Topic ID 30615</strong></p>

  <ul>
    <li>INFO: Upgrading the Self-Hosted Engine</li>
    <li>INFO: <a href="http://skynet.usersys.redhat.com:8080/pressgang-ccms-ui/#SearchResultsAndTopicView;query;topicIds=30615">Topic URL</a></li>
    <li>
      <p>ERROR: This topic has invalid Injection Points. The processed XML is
    &lt;section id="Upgrading_the_Self-Hosted_Engine" remap="TID_30615"&gt;
        &lt;title&gt;Upgrading the Self-Hosted Engine&lt;/title&gt;
        &lt;formalpara&gt;
            &lt;title&gt;Summary&lt;/title&gt;
            &lt;para&gt;
                Upgrade your oVirt hosted-engine environment from version 3.3 to 3.4.
            &lt;/para&gt;
        &lt;/formalpara&gt;
        &lt;para&gt;
            This procedure upgrades two hosts, referred to in this procedure as Host A and Host B, and a Manager virtual machine. For the purposes of this procedure, Host B is hosting oVirt virtual machine.
        &lt;/para&gt;
        &lt;para&gt;
            It is recommended that all hosts in the environment be upgraded at the same time, before oVirt virtual machine is upgraded and the &lt;guilabel&gt;Compatibility Version&lt;/guilabel&gt; of the cluster is updated to &lt;guilabel&gt;3.4&lt;/guilabel&gt;. This avoids any version 3.3 hosts from going into a &lt;guilabel&gt;Non Operational&lt;/guilabel&gt; state.
        &lt;/para&gt;
        &lt;para&gt;
            All commands in this procedure are as the &lt;literal&gt;root&lt;/literal&gt; user.
        &lt;/para&gt;
        &lt;procedure&gt;
            &lt;title&gt;Upgrading the Self-Hosted Engine&lt;/title&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Log into either host and set the maintenance mode to &lt;literal&gt;global&lt;/literal&gt; to disable the high-availability agents.
                &lt;/para&gt;
                &lt;screen&gt;# hosted-engine –set-maintenance –mode=global&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Access oVirt Administration Portal. Select Host A and put it into maintenance mode by clicking the &lt;guibutton&gt;Maintenance&lt;/guibutton&gt; button.
                &lt;/para&gt;
                &lt;important&gt;
                    &lt;para&gt;
                        The host that you put into maintenance mode and upgrade must not be the host currently hosting oVirt virtual machine.
                    &lt;/para&gt;
                &lt;/important&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Log into and update Host A.
                &lt;/para&gt;
                &lt;screen&gt;# yum update&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Restart VDSM on Host A.
                &lt;/para&gt;
                &lt;screen&gt;# service vdsmd restart&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Restart &lt;literal&gt;ovirt-ha-broker&lt;/literal&gt; and &lt;literal&gt;ovirt-ha-agent&lt;/literal&gt; on Host A.
                &lt;/para&gt;
                &lt;screen&gt;# service ovirt-ha-broker restart&lt;/screen&gt;
                &lt;screen&gt;# service ovirt-ha-agent restart&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Log into either host and turn off the hosted-engine maintenance mode so that oVirt virtual machine can migrate to the other host.
                &lt;/para&gt;
                &lt;screen&gt;# hosted-engine –set-maintenance –mode=none&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Access oVirt Administration Portal. Select Host A and activate it by clicking the &lt;guibutton&gt;Activate&lt;/guibutton&gt; button.
                &lt;/para&gt;
            &lt;/step&gt; 
            &lt;!–     &lt;step&gt;
                &lt;para&gt;
                    Use the &lt;guilabel&gt;Hosts&lt;/guilabel&gt; resource tab to select Host B and put it into maintenance mode by clicking the &lt;guibutton&gt;Maintenance&lt;/guibutton&gt; button. oVirt virtual machine will migrate to Host A.
                &lt;/para&gt;
            &lt;/step&gt; –&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Log into Host B and set the maintenance mode to &lt;literal&gt;global&lt;/literal&gt; to disable the high-availability agents. 
                    &lt;screen&gt;# hosted-engine –set-maintenance –mode=global&lt;/screen&gt;
                &lt;/para&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Update Host B.
                &lt;/para&gt;
                &lt;screen&gt;# yum update&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Restart VDSM on Host B.
                &lt;/para&gt;
                &lt;screen&gt;# service vdsmd restart&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Restart &lt;literal&gt;ovirt-ha-broker&lt;/literal&gt; and &lt;literal&gt;ovirt-ha-agent&lt;/literal&gt; on Host B.
                &lt;/para&gt;
                &lt;screen&gt;# service ovirt-ha-broker restart&lt;/screen&gt;
                &lt;screen&gt;# service ovirt-ha-agent restart&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Turn off the hosted-engine maintenance mode on Host B.
                &lt;/para&gt;
                &lt;screen&gt;# hosted-engine –set-maintenance –mode=none&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Access oVirt Administration Portal. Select Host B and activate it by clicking the &lt;guibutton&gt;Activate&lt;/guibutton&gt; button.
                &lt;/para&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Log into oVirt virtual machine and update the engine as per the instructions in &lt;!– Inject: 30126 –&gt;.
                &lt;/para&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Access oVirt Administration Portal.
                &lt;/para&gt;
                &lt;stepalternatives&gt;
                    &lt;step&gt;
                        &lt;para&gt;
                            Select the &lt;guilabel&gt;Default&lt;/guilabel&gt; cluster and click &lt;guibutton&gt;Edit&lt;/guibutton&gt; to open the &lt;guilabel&gt;Edit Cluster&lt;/guilabel&gt; window.
                        &lt;/para&gt;
                    &lt;/step&gt;
                    &lt;step&gt;
                        &lt;para&gt;
                            Use the &lt;guilabel&gt;Compatibility Version&lt;/guilabel&gt; drop-down menu to select &lt;guilabel&gt;3.4&lt;/guilabel&gt;. Click &lt;guibutton&gt;OK&lt;/guibutton&gt; to save the change and close the window.
                        &lt;/para&gt;
                    &lt;/step&gt;
                &lt;/stepalternatives&gt;
            &lt;/step&gt;
        &lt;/procedure&gt;
        &lt;formalpara&gt;
            &lt;title&gt;Result&lt;/title&gt;
            &lt;para&gt;
                You have upgraded both the hosts and oVirt in your hosted-engine setup to oVirt 3.4.
            &lt;/para&gt;
        &lt;/formalpara&gt;
    &lt;/section&gt;</p>
    </li>
    <li>ERROR: Topic has referenced Topic/Level(s) 30126 in a custom injection point that was not included this book.</li>
  </ul>

  <p>⁠</p>

  <p><strong>Topic ID 25551</strong></p>

  <ul>
    <li>INFO: Installing the Self-Hosted Engine</li>
    <li>INFO: Assigned Writer: aburden Book: RHEV Administration Guide Book: RHEV Installation Guide</li>
    <li>INFO: <a href="http://skynet.usersys.redhat.com:8080/pressgang-ccms-ui/#SearchResultsAndTopicView;query;topicIds=25551">Topic URL</a></li>
    <li>ERROR: Topic has referenced Topic/Level(s) 10008,10007 in a custom injection point that was not included this book.</li>
    <li>ERROR: This topic has invalid Injection Points. The processed XML is
    &lt;section id="Installing_the_Self-Hosted_Engine" remap="TID_25551"&gt;
        &lt;title&gt;Installing the Self-Hosted Engine&lt;/title&gt;
        &lt;formalpara&gt;
            &lt;title&gt;Summary&lt;/title&gt;
            &lt;para&gt;
                Install a oVirt environment that takes advantage of the self-hosted engine feature, in which the engine is installed on a virtual machine within the environment itself.
            &lt;/para&gt;
        &lt;/formalpara&gt;
        &lt;para&gt;
            You must be subscribed to the appropriate Red Hat Network channels to install the packages. For Subscription Manager, these channels are: 
            &lt;itemizedlist&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-6-server-rpms&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-6-server-supplementary-rpms&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-6-server-rhevm-3.4-rpms&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;jb-eap-6-for-rhel-6-server-rpms&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-6-server-rhev-mgmt-agent-rpms&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
            &lt;/itemizedlist&gt; For more information on subscribing to these channels using Subscription Manager, refer to &lt;!– Inject: 10008 –&gt;.
        &lt;/para&gt;
        &lt;para&gt;
            For RHN Classic, these channels are: 
            &lt;itemizedlist&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-x86_64-server-6&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-x86_64-server-supplementary-6&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-x86_64-server-6-rhevm-3.4&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;jbappplatform-6-x86_64-server-6-rpm&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
                &lt;listitem&gt;
                    &lt;para&gt; 
                        &lt;literal&gt;rhel-x86_64-rhev-mgmt-agent-6&lt;/literal&gt;
                    &lt;/para&gt;
                &lt;/listitem&gt;
            &lt;/itemizedlist&gt; For more information on subscribing to these channels using RHN Classic, refer to &lt;!– Inject: 10007 –&gt;.
        &lt;/para&gt;
        &lt;important&gt;
            &lt;para&gt;
                While the &lt;package&gt;ovirt-hosted-engine-setup&lt;/package&gt; package is provided by oVirt channel and can be installed using the standard channels for oVirt, the &lt;package&gt;vdsm&lt;/package&gt; package is a dependency of the &lt;package&gt;ovirt-hosted-engine-setup&lt;/package&gt; package and is provided by the Red Hat Enterprise Virt Management Agent channel, which must be enabled. This channel is &lt;literal&gt;rhel-6-server-rhev-mgmt-agent-rpms&lt;/literal&gt; in Subscription Manager and &lt;literal&gt;rhel-x86_64-rhev-mgmt-agent-6&lt;/literal&gt; in &lt;acronym&gt;RHN&lt;/acronym&gt; Classic.
            &lt;/para&gt;
        &lt;/important&gt;
        &lt;para&gt;
            All steps in this procedure are to be conducted as the &lt;systemitem class="username"&gt;root&lt;/systemitem&gt; user.
        &lt;/para&gt;
        &lt;procedure&gt;
            &lt;title&gt;Installing the Self-Hosted Engine&lt;/title&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Run the following command to ensure that the most up-to-date versions of all installed packages are in use:
                &lt;/para&gt;
                &lt;screen&gt;# yum upgrade&lt;/screen&gt;
            &lt;/step&gt;
            &lt;step&gt;
                &lt;para&gt;
                    Run the following command to install the &lt;package&gt;ovirt-hosted-engine-setup&lt;/package&gt; package and dependencies:
                &lt;/para&gt;
                &lt;screen&gt;# yum install ovirt-hosted-engine-setup&lt;/screen&gt;
            &lt;/step&gt;
        &lt;/procedure&gt;
        &lt;formalpara&gt;
            &lt;title&gt;Result&lt;/title&gt;
            &lt;para&gt;
                You have installed the &lt;package&gt;ovirt-hosted-engine-setup&lt;/package&gt; package and are ready to configure the self-hosted engine.
            &lt;/para&gt;
        &lt;/formalpara&gt;
    &lt;/section&gt;</li>
  </ul>

  <h3 id="compiler-glossary">⁠Compiler Glossary</h3>

  <p>"… is possibly an invalid custom Injection Point."<br />
* The XML comment mentioned has been identified as a possible custom Injection Point, that is incorrectly referenced.</p>

  <p>* To fix this error please ensure that the type is valid, a colon is used to separate the IDs from the type and only topic IDs are used in the ID list.
"This topic contains an invalid element that can't be converted into a DOM Element."<br />
* The topic XML contains invalid elements that cannot be successfully converted in DOM elements.</p>

  <p>* To fix this error please remove or correct any invalid XML elements or entities.
"This topic doesn't have well-formed xml."<br />
* The topic XML is not well-formed XML and maybe missing opening or closing element statements.</p>

  <p>* To fix this error please ensure that all XML elements having an opening and closing statement and all XML reserved characters are represented as XML entities.
"This topic has invalid DocBook XML."<br />
* The topic XML is not valid against the DocBook specification.</p>

  <p>* To fix this error please ensure that all XML elements are valid DocBook elements . Also check to ensure all XML sub elements are valid for the root XML element.
"This topic has invalid Injection Points."<br />
* The topic XML contains Injection Points that cannot be resolved into links.</p>

  <p>* To fix this error please ensure that all the topics referred to by Injection Points are included in the build and/or have adequate relationships.
"This topic has no XML data"<br />
* The topic doesn't have any XML Content to display.</p>

  <p>* To fix this warning, open the topic URL and add some content.</p>

  <p><strong>Revision History</strong></p>

  <p>Revision 1.0-1</p>

  <p>Wed 25 Jun 2014</p>

  <p>Lucy Bopf</p>

  <p><strong>Andrew Burden</strong></p>

<pre class="highlight plaintext"><code>  aburden@redhat.com&#x000A;</code></pre>

  <p><strong>Steve Gordon</strong></p>

<pre class="highlight plaintext"><code>  sgordon@redhat.com&#x000A;</code></pre>

  <p><strong>Tim Hildred</strong></p>

<pre class="highlight plaintext"><code>  thildred@redhat.com&#x000A;</code></pre>

  <p><strong>Cheryn Tan</strong></p>

<pre class="highlight plaintext"><code>  chetan@redhat.com&#x000A;</code></pre>

  <h2 id="legal-notice">Legal Notice</h2>

  <p>Copyright © 2014 Red Hat, Inc.</p>

  <p>This document is licensed by Red Hat under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>. If you distribute this document, or a modified version of it, you must provide attribution to Red Hat, Inc. and provide a link to the original. If the document is modified, all Red Hat trademarks must be removed.</p>

  <p>Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.</p>

  <p>Red Hat, Red Hat Enterprise Linux, the Shadowman logo, JBoss, MetaMatrix, Fedora, the Infinity Logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.</p>

  <p>Linux® is the registered trademark of Linus Torvalds in the United States and other countries.</p>

  <p>Java® is a registered trademark of Oracle and/or its affiliates.</p>

  <p>XFS® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.</p>

  <p>MySQL® is a registered trademark of MySQL AB in the United States, the European Union and other countries.</p>

  <p>Node.js® is an official trademark of Joyent. Red Hat Software Collections is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.</p>

  <p>The OpenStack® Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.</p>

  <p>All other trademarks are the property of their respective owners.</p>

  <table>
    <tbody>
      <tr>
        <td>Initial creation for oVirt Engine test build for Brian Proffitt.</td>
      </tr>
    </tbody>
  </table>
</div>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="/privacy/">Privacy policy</a></li>
<li><a target="_blank" href="/about/">About</a></li>
<li><a target="_blank" href="/disclaimers/">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2015 oVirt
<div class='last-modified'>
Page last modified
Wed 11 Nov 2015 18:11 UTC
</div>
</footer>


<script src="/javascripts/application.js?1447687452" type="text/javascript"></script>

<!-- eloqua -->
<script src='http://www.redhat.com/j/elqNow/elqCfg.js' type='text/javascript'></script>
<script src='http://www.redhat.com/j/elqNow/elqImg.js' type='text/javascript'></script>

</body>
</html>
